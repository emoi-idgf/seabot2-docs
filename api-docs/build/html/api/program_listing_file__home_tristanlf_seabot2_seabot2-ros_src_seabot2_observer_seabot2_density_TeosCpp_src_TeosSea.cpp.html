

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Program Listing for File TeosSea.cpp &mdash; Seabot2 ROS2 API 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/collapsible-lists/css/tree_view.css?v=a885cde7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js?v=73120307"></script>
      <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js?v=660e4f45"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #1D8BC2" >

          
          
          <a href="../index.html" class="icon icon-home">
            Seabot2 ROS2 API
              <img src="../_static/seabot2_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="library_root.html">Seabot2 C++ API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #1D8BC2" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Seabot2 ROS2 API</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Program Listing for File TeosSea.cpp</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/program_listing_file__home_tristanlf_seabot2_seabot2-ros_src_seabot2_observer_seabot2_density_TeosCpp_src_TeosSea.cpp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="program-listing-for-file-teossea-cpp">
<span id="program-listing-file-home-tristanlf-seabot2-seabot2-ros-src-seabot2-observer-seabot2-density-teoscpp-src-teossea-cpp"></span><h1>Program Listing for File TeosSea.cpp<a class="headerlink" href="#program-listing-for-file-teossea-cpp" title="Link to this heading"></a></h1>
<p>↰ <a class="reference internal" href="file__home_tristanlf_seabot2_seabot2-ros_src_seabot2_observer_seabot2_density_TeosCpp_src_TeosSea.cpp.html#file-home-tristanlf-seabot2-seabot2-ros-src-seabot2-observer-seabot2-density-teoscpp-src-teossea-cpp"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">/home/tristanlf/seabot2/seabot2-ros/src/seabot2_observer/seabot2_density/TeosCpp/src/TeosSea.cpp</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;TeosSea.h&quot;</span>

<span class="cm">/*****************************************</span>
<span class="cm">  &quot;TeosSea.cpp&quot; Version 1.06</span>
<span class="cm">  by Randall Kent Whited</span>
<span class="cm">  rkwhited@gmail.com</span>
<span class="cm">  ---------------------------------------</span>
<span class="cm">  All copyrights and all license issues</span>
<span class="cm">  are the same as for previous versions</span>
<span class="cm">******************************************/</span>

<span class="cm">/*****************************************</span>
<span class="cm">  Most C function calls in the original</span>
<span class="cm">  TEOS-10 &quot;gsw_oceanographic_toolbox.c&quot;</span>
<span class="cm">  and &quot;gsw_saar.c&quot; source code file that</span>
<span class="cm">  have been used are in the base-class</span>
<span class="cm">  &quot;TeosBase.cpp&quot; or in the descendant</span>
<span class="cm">  classes &quot;TeosIce.cpp&quot; or &quot;TeosSea.cpp&quot;.</span>
<span class="cm">  ---------------------------------------</span>
<span class="cm">  Methods used by both &quot;TeosIce&quot;,</span>
<span class="cm">  &quot;TeosSea&quot; and &quot;Teos_Matlab&quot; are</span>
<span class="cm">  implemented in the &quot;TeosBase&quot; class.</span>
<span class="cm">*****************************************/</span>

<span class="n">TeosSea</span><span class="o">::</span><span class="n">TeosSea</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">TeosBase</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">try</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">statusOk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">catch</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">statusOk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">badBaseAlloc</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(...)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">statusOk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">TeosSea</span><span class="o">::~</span><span class="n">TeosSea</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">% gsw_adiabatic_lapse_rate_from_CT                     adiabatic lapse rate</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_adiabatic_lapse_rate_from_CT(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the adiabatic lapse rate of sea water from Conservative</span>
<span class="cm">%  Temperature.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  adiabatic_lapse_rate  =  adiabatic lapse rate                   [ K/Pa ]</span>
<span class="cm">%    Note.  The output is in unit of degress Celsius per Pa,</span>
<span class="cm">%      (or equivilently K/Pa) not in units of K/dbar.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%    See Eqn. (2.22.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_adiabatic_lapse_rate_from_ct</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n2</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">pt0</span><span class="p">,</span><span class="w"> </span><span class="n">pr0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>

<span class="w">    </span><span class="n">pt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_pt_from_ct</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_pt_from_t</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">pt0</span><span class="p">,</span><span class="n">pr0</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">n0</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_alpha_on_beta                           alpha/beta (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%    gsw_alpha_on_beta(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates alpha divided by beta, where alpha is the thermal expansion</span>
<span class="cm">%  coefficient and beta is the saline contraction coefficient of seawater</span>
<span class="cm">%  from Absolute Salinity and Conservative Temperature.  This function uses</span>
<span class="cm">%  the computationally-efficient expression for specific volume in terms of</span>
<span class="cm">%  SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that the 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  alpha_on_beta  =  thermal expansion coefficient with respect to</span>
<span class="cm">%                    Conservative Temperature divided by the saline</span>
<span class="cm">%                    contraction coefficient at constant Conservative</span>
<span class="cm">%                    Temperature                           [ kg g^-1 K^-1 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See appendix A.20 and appendix K of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2014: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling.</span>
<span class="cm">%</span>
<span class="cm">% The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_alpha_on_beta</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">v_ct_part</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_part</span><span class="p">;</span>

<span class="w">    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
<span class="w">    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="o">*</span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">*</span><span class="mf">1e-4</span><span class="p">;</span>
<span class="w">    </span><span class="n">v_ct_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_a</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">    </span><span class="n">v_sa_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_b</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">v_ct_part</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">20.0</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">v_sa_part</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">% gsw_alpha_wrt_t_exact                       thermal expansion coefficient</span>
<span class="cm">%                                       with respect to in-situ temperature</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_alpha_wrt_t_exact(SA,t,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the thermal expansion coefficient of seawater with respect to</span>
<span class="cm">%  in-situ temperature.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  t   =  in-situ temperature (ITS-90)                            [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  alpha_wrt_t_exact  =  thermal expansion coefficient              [ 1/K ]</span>
<span class="cm">%                        with respect to in-situ temperature</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  David Jackett, Trevor McDougall and Paul Barker     [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%    See Eqn. (2.18.1) of this TEOS-10 manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_alpha_wrt_t_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_beta_const_t_exact                     saline contraction coefficient</span>
<span class="cm">%                                           at constant in-situ temperature</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_beta_const_t_exact(SA,t,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the saline (i.e. haline) contraction coefficient of seawater</span>
<span class="cm">%  at constant in-situ temperature.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  t   =  in-situ temperature (ITS-90)                            [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  beta_const_t_exact  =  saline contraction coefficient           [ kg/g ]</span>
<span class="cm">%                         at constant in-situ temperature</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  David Jackett, Trevor McDougall and Paul Barker     [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (2.19.1) of this TEOS-10 manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_beta_const_t_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_C_from_SP                                        conductivity from SP</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_C_from_SP(SP,t,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates conductivity, C, from (SP,t,p) using PSS-78 in the range</span>
<span class="cm">%  2 &lt; SP &lt; 42.  If the input Practical Salinity is less than 2 then a</span>
<span class="cm">%  modified form of the Hill et al. (1986) fomula is used for Practical</span>
<span class="cm">%  Salinity.  The modification of the Hill et al. (1986) expression is to</span>
<span class="cm">%  ensure that it is exactly consistent with PSS-78 at SP = 2.</span>
<span class="cm">%</span>
<span class="cm">%  The conductivity ratio returned by this function is consistent with the</span>
<span class="cm">%  input value of Practical Salinity, SP, to 2x10^-14 psu over the full</span>
<span class="cm">%  range of input parameters (from pure fresh water up to SP = 42 psu).</span>
<span class="cm">%  This error of 2x10^-14 psu is machine precision at typical seawater</span>
<span class="cm">%  salinities.  This accuracy is achieved by having four different</span>
<span class="cm">%  polynomials for the starting value of Rtx (the square root of Rt) in</span>
<span class="cm">%  four different ranges of SP, and by using one and a half iterations of</span>
<span class="cm">%  a computationally efficient modified Newton-Raphson technique (McDougall</span>
<span class="cm">%  and Wotherspoon, 2013) to find the root of the equation.</span>
<span class="cm">%</span>
<span class="cm">%  Note that strictly speaking PSS-78 (Unesco, 1983) defines Practical</span>
<span class="cm">%  Salinity in terms of the conductivity ratio, R, without actually</span>
<span class="cm">%  specifying the value of C(35,15,0) (which we currently take to be</span>
<span class="cm">%  42.9140 mS/cm).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SP  =  Practical Salinity  (PSS-78)                         [ unitless ]</span>
<span class="cm">%  t   =  in-situ temperature (ITS-90)                            [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  C  =  conductivity                                             [ mS/cm ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall, Paul Barker and Rich Pawlowicz    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  Hill, K.D., T.M. Dauphinee and D.J. Woods, 1986: The extension of the</span>
<span class="cm">%   Practical Salinity Scale 1978 to low salinities. IEEE J. Oceanic Eng.,</span>
<span class="cm">%   OE-11, 1, 109 - 112.</span>
<span class="cm">%</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See appendix E of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall T. J. and S. J. Wotherspoon, 2013: A simple modification of</span>
<span class="cm">%   Newton&#39;s method to achieve convergence of order 1 + sqrt(2).  Applied</span>
<span class="cm">%   Mathematics Letters, 29, 20-25.</span>
<span class="cm">%</span>
<span class="cm">%  Unesco, 1983: Algorithms for computation of fundamental properties of</span>
<span class="cm">%   seawater. Unesco Technical Papers in Marine Science, 44, 53 pp.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_c_from_sp</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sp</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w">  </span><span class="n">p0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.577801212923119e-3</span><span class="p">,</span><span class="w">      </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.924049429136640e-1</span><span class="p">,</span>
<span class="w">              </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.183871685127932e-5</span><span class="p">,</span><span class="w">      </span><span class="n">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.292156330457999e-3</span><span class="p">,</span>
<span class="w">              </span><span class="n">p4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.568129536470258e-4</span><span class="p">,</span><span class="w">      </span><span class="n">p5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.478995271680869e-6</span><span class="p">,</span>
<span class="w">              </span><span class="n">p6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">9.086442524716395e-4</span><span class="p">,</span><span class="w">      </span><span class="n">p7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.949560839540487e-5</span><span class="p">,</span>
<span class="w">              </span><span class="n">p8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.223058111118377e-6</span><span class="p">,</span><span class="w">     </span><span class="n">p9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.175871639741131e-7</span><span class="p">,</span>
<span class="w">              </span><span class="n">p10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.522895856600089e-5</span><span class="p">,</span><span class="w">    </span><span class="n">p11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.254458513439107e-6</span><span class="p">,</span>
<span class="w">              </span><span class="n">p12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.179992190192848e-7</span><span class="p">,</span><span class="w">     </span><span class="n">p13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.005054226996868e-8</span><span class="p">,</span>
<span class="w">              </span><span class="n">p14</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.923745566122602e-9</span><span class="p">,</span><span class="w">    </span><span class="n">p15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.259550611212616e-6</span><span class="p">,</span>
<span class="w">              </span><span class="n">p16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.631749165091437e-7</span><span class="p">,</span><span class="w">     </span><span class="n">p17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-5.931857989915256e-9</span><span class="p">,</span>
<span class="w">              </span><span class="n">p18</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.693392029005252e-9</span><span class="p">,</span><span class="w">    </span><span class="n">p19</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.571854839274148e-10</span><span class="p">,</span>
<span class="w">              </span><span class="n">p20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.198786822861038e-12</span><span class="p">,</span>
<span class="w">              </span><span class="n">q0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.540896868127855e-5</span><span class="p">,</span><span class="w">      </span><span class="n">q1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.015419291097848e-1</span><span class="p">,</span>
<span class="w">              </span><span class="n">q2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.445310045430192e-5</span><span class="p">,</span><span class="w">     </span><span class="n">q3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.567047628411722e-2</span><span class="p">,</span>
<span class="w">              </span><span class="n">q4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.464756294660119e-4</span><span class="p">,</span><span class="w">      </span><span class="n">q5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.575458304732166e-7</span><span class="p">,</span>
<span class="w">              </span><span class="n">q6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.071449842454419e-3</span><span class="p">,</span><span class="w">      </span><span class="n">q7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">9.081985795339206e-5</span><span class="p">,</span>
<span class="w">              </span><span class="n">q8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.635420818812898e-6</span><span class="p">,</span><span class="w">     </span><span class="n">q9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.249490528450555e-8</span><span class="p">,</span>
<span class="w">              </span><span class="n">q10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.143810377431888e-3</span><span class="p">,</span><span class="w">    </span><span class="n">q11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.066112484281530e-5</span><span class="p">,</span>
<span class="w">              </span><span class="n">q12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">7.482907137737503e-7</span><span class="p">,</span><span class="w">     </span><span class="n">q13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.019321577844724e-8</span><span class="p">,</span>
<span class="w">              </span><span class="n">q14</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-5.755568141370501e-10</span><span class="p">,</span><span class="w">   </span><span class="n">q15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.120748754429459e-4</span><span class="p">,</span>
<span class="w">              </span><span class="n">q16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.420274029674485e-6</span><span class="p">,</span><span class="w">    </span><span class="n">q17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.774829347564670e-8</span><span class="p">,</span>
<span class="w">              </span><span class="n">q18</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.279037686797859e-9</span><span class="p">,</span><span class="w">    </span><span class="n">q19</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.045829202713288e-10</span><span class="p">,</span>
<span class="w">              </span><span class="n">q20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.025109163112005e-12</span><span class="p">,</span>
<span class="w">              </span><span class="n">s0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.432285006604888e-3</span><span class="p">,</span><span class="w">      </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.672940491817403e-1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.640304401023995e-5</span><span class="p">,</span><span class="w">      </span><span class="n">s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.082267090441036e-1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-6.296778883666940e-5</span><span class="p">,</span><span class="w">     </span><span class="n">s5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.542775152303671e-7</span><span class="p">,</span>
<span class="w">              </span><span class="n">s6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.859711038699727e-1</span><span class="p">,</span><span class="w">     </span><span class="n">s7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">7.659006320303959e-4</span><span class="p">,</span>
<span class="w">              </span><span class="n">s8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.794661268817618e-7</span><span class="p">,</span><span class="w">     </span><span class="n">s9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.093368602891911e-9</span><span class="p">,</span>
<span class="w">              </span><span class="n">s10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.001140606840692e-1</span><span class="p">,</span><span class="w">     </span><span class="n">s11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.038712945546608e-3</span><span class="p">,</span>
<span class="w">              </span><span class="n">s12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-6.227915160991074e-6</span><span class="p">,</span><span class="w">    </span><span class="n">s13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.798564479737090e-8</span><span class="p">,</span>
<span class="w">              </span><span class="n">s14</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.343623657549961e-10</span><span class="p">,</span><span class="w">   </span><span class="n">s15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.024345179842964e-2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.981135430579384e-4</span><span class="p">,</span><span class="w">     </span><span class="n">s17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.466087528793912e-6</span><span class="p">,</span>
<span class="w">              </span><span class="n">s18</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.960872795577774e-8</span><span class="p">,</span><span class="w">     </span><span class="n">s19</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.723159418888634e-10</span><span class="p">,</span>
<span class="w">              </span><span class="n">s20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.122200786423241e-12</span><span class="p">,</span>
<span class="w">              </span><span class="n">u0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.180529787390576e-3</span><span class="p">,</span><span class="w">      </span><span class="n">u1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.052097167201052e-3</span><span class="p">,</span>
<span class="w">              </span><span class="n">u2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.666193708310848e-5</span><span class="p">,</span><span class="w">      </span><span class="n">u3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">7.112223828976632e0</span><span class="p">,</span>
<span class="w">              </span><span class="n">u4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.631366777096209e-4</span><span class="p">,</span><span class="w">     </span><span class="n">u5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.336295318742821e-7</span><span class="p">,</span>
<span class="w">              </span><span class="n">u6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.576886793288888e+2</span><span class="p">,</span><span class="w">     </span><span class="n">u7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.840239113483083e-3</span><span class="p">,</span>
<span class="w">              </span><span class="n">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.624279120240952e-6</span><span class="p">,</span><span class="w">      </span><span class="n">u9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.233529799729501e-8</span><span class="p">,</span>
<span class="w">              </span><span class="n">u10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.826482800939545e+3</span><span class="p">,</span><span class="w">     </span><span class="n">u11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.633903983457674e-1</span><span class="p">,</span>
<span class="w">              </span><span class="n">u12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.201096427222349e-5</span><span class="p">,</span><span class="w">    </span><span class="n">u13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.187900959754842e-8</span><span class="p">,</span>
<span class="w">              </span><span class="n">u14</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.442010369809705e-10</span><span class="p">,</span><span class="w">   </span><span class="n">u15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-8.542357182595853e+3</span><span class="p">,</span>
<span class="w">              </span><span class="n">u16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.408635241899082e0</span><span class="p">,</span><span class="w">     </span><span class="n">u17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.660164829963661e-4</span><span class="p">,</span>
<span class="w">              </span><span class="n">u18</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.797409608973845e-7</span><span class="p">,</span><span class="w">     </span><span class="n">u19</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.345074990451475e-10</span><span class="p">,</span>
<span class="w">              </span><span class="n">u20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.285687652694768e-13</span><span class="p">;</span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t68</span><span class="p">,</span><span class="w"> </span><span class="n">ft68</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">rtx</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">dsp_drtx</span><span class="p">,</span><span class="w"> </span><span class="n">sqrty</span><span class="p">,</span><span class="w"> </span><span class="n">part1</span><span class="p">,</span><span class="w"> </span><span class="n">part2</span><span class="p">,</span><span class="w"> </span><span class="n">hill_ratio</span><span class="p">,</span>
<span class="w">                                </span><span class="n">sp_est</span><span class="p">,</span><span class="w"> </span><span class="n">rtx_old</span><span class="p">,</span><span class="w"> </span><span class="n">rt</span><span class="p">,</span><span class="w"> </span><span class="n">aa</span><span class="p">,</span><span class="w"> </span><span class="n">bb</span><span class="p">,</span><span class="w"> </span><span class="n">cc</span><span class="p">,</span><span class="w"> </span><span class="n">dd</span><span class="p">,</span><span class="w"> </span><span class="n">ee</span><span class="p">,</span><span class="w"> </span><span class="n">ra</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">rt_lc</span><span class="p">,</span><span class="w"> </span><span class="n">rtxm</span><span class="p">,</span>
<span class="w">                                </span><span class="n">sp_hill_raw</span><span class="p">;</span>

<span class="w">    </span><span class="n">t68</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="mf">1.00024e0</span><span class="p">;</span>
<span class="w">    </span><span class="n">ft68</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t68</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">15e0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">t68</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">15e0</span><span class="p">));</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">sp</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">9.0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">rtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p0</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">p1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p4</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p7</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">p6</span>
<span class="w">                                             </span><span class="o">+</span><span class="w"> </span><span class="n">p11</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">p10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p16</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">p15</span><span class="p">))))</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">p2</span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">p5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">p12</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">p17</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p8</span><span class="o">*</span><span class="n">x</span>
<span class="w">                                     </span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">p9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">p13</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">p18</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">p14</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p19</span><span class="o">*</span><span class="n">x</span>
<span class="w">                                              </span><span class="o">+</span><span class="w"> </span><span class="n">p20</span><span class="o">*</span><span class="n">t68</span><span class="p">))));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">9.0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">rtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q0</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">q1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">q4</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">q7</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">q6</span>
<span class="w">                                             </span><span class="o">+</span><span class="w"> </span><span class="n">q11</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">q10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">q16</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">q15</span><span class="p">))))</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">q2</span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">q5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">q12</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">q17</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">q8</span><span class="o">*</span><span class="n">x</span>
<span class="w">                                     </span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">q9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">q13</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">q18</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">q14</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">q19</span><span class="o">*</span><span class="n">x</span>
<span class="w">                                              </span><span class="o">+</span><span class="w"> </span><span class="n">q20</span><span class="o">*</span><span class="n">t68</span><span class="p">))));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.003</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.25</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">rtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s0</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s4</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">s3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s7</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">s6</span>
<span class="w">                                             </span><span class="o">+</span><span class="w"> </span><span class="n">s11</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">s10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s16</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">s15</span><span class="p">))))</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">s2</span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">s5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">s12</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">s17</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s8</span><span class="o">*</span><span class="n">x</span>
<span class="w">                                     </span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">s9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">s13</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">s18</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">s14</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s19</span><span class="o">*</span><span class="n">x</span>
<span class="w">                                              </span><span class="o">+</span><span class="w"> </span><span class="n">s20</span><span class="o">*</span><span class="n">t68</span><span class="p">))));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.003</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">rtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u0</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">u1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u4</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">u3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u7</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">u6</span>
<span class="w">                                             </span><span class="o">+</span><span class="w"> </span><span class="n">u11</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">u10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u16</span><span class="o">*</span><span class="n">t68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">u15</span><span class="p">))))</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">u2</span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">u5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">u12</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">u17</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u8</span><span class="o">*</span><span class="n">x</span>
<span class="w">                                     </span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">u9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">u13</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">u18</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">u14</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u19</span><span class="o">*</span><span class="n">x</span>
<span class="w">                                              </span><span class="o">+</span><span class="w"> </span><span class="n">u20</span><span class="o">*</span><span class="n">t68</span><span class="p">))));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">dsp_drtx</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">gspc</span><span class="p">.</span><span class="n">a1</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">2e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">a2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">3e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">a3</span>
<span class="w">                                            </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">4e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">a4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">a5</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">ft68</span><span class="o">*</span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">2e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">b2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">3e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">b3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">4e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">b4</span>
<span class="w">                                             </span><span class="o">+</span><span class="w"> </span><span class="mf">5e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">b5</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2.0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400e0</span><span class="o">*</span><span class="p">(</span><span class="n">rtx</span><span class="o">*</span><span class="n">rtx</span><span class="p">);</span>
<span class="w">        </span><span class="n">sqrty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="o">*</span><span class="n">rtx</span><span class="p">;</span>
<span class="w">        </span><span class="n">part1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">1.5e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="n">part2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="p">));</span>
<span class="w">        </span><span class="n">hill_ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_hill_ratio_at_sp2</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="w">        </span><span class="n">dsp_drtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsp_drtx</span>
<span class="w">                      </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a0</span><span class="o">*</span><span class="mf">800e0</span><span class="o">*</span><span class="n">rtx</span><span class="o">*</span><span class="p">(</span><span class="mf">1.5e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2e0</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">part1</span><span class="o">*</span><span class="n">part1</span><span class="p">)</span>
<span class="w">                      </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">b0</span><span class="o">*</span><span class="n">ft68</span><span class="o">*</span><span class="p">(</span><span class="mf">10e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">20e0</span>
<span class="w">                                            </span><span class="o">+</span><span class="w"> </span><span class="mf">30e0</span><span class="o">*</span><span class="n">sqrty</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">part2</span><span class="o">*</span><span class="n">part2</span><span class="p">);</span>
<span class="w">        </span><span class="n">dsp_drtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hill_ratio</span><span class="o">*</span><span class="n">dsp_drtx</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">sp_est</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a0</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a3</span>
<span class="w">                                                 </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a5</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">ft68</span><span class="o">*</span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b2</span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b3</span>
<span class="w">                                                        </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">b5</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp_est</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mf">2.0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400e0</span><span class="o">*</span><span class="p">(</span><span class="n">rtx</span><span class="o">*</span><span class="n">rtx</span><span class="p">);</span>
<span class="w">        </span><span class="n">sqrty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10e0</span><span class="o">*</span><span class="n">rtx</span><span class="p">;</span>
<span class="w">        </span><span class="n">part1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">1.5e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="n">part2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="p">));</span>
<span class="w">        </span><span class="n">sp_hill_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp_est</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a0</span><span class="o">/</span><span class="n">part1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">b0</span><span class="o">*</span><span class="n">ft68</span><span class="o">/</span><span class="n">part2</span><span class="p">;</span>
<span class="w">        </span><span class="n">hill_ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_hill_ratio_at_sp2</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="w">        </span><span class="n">sp_est</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hill_ratio</span><span class="o">*</span><span class="n">sp_hill_raw</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">rtx_old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtx</span><span class="p">;</span>
<span class="w">    </span><span class="n">rtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtx_old</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">sp_est</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sp</span><span class="p">)</span><span class="o">/</span><span class="n">dsp_drtx</span><span class="p">;</span>
<span class="w">    </span><span class="n">rtxm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5e0</span><span class="o">*</span><span class="p">(</span><span class="n">rtx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rtx_old</span><span class="p">);</span>
<span class="w">    </span><span class="n">dsp_drtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a1</span>
<span class="w">                  </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">2e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">a2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">3e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">a3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">4e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">a4</span>
<span class="w">                                          </span><span class="o">+</span><span class="w"> </span><span class="mf">5e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">a5</span><span class="o">*</span><span class="n">rtxm</span><span class="p">)</span><span class="o">*</span><span class="n">rtxm</span><span class="p">)</span><span class="o">*</span><span class="n">rtxm</span><span class="p">)</span><span class="o">*</span><span class="n">rtxm</span>
<span class="w">                  </span><span class="o">+</span><span class="w"> </span><span class="n">ft68</span><span class="o">*</span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">2e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">b2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">3e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">b3</span>
<span class="w">                                            </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">4e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">b4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5e0</span><span class="o">*</span><span class="n">gspc</span><span class="p">.</span><span class="n">b5</span><span class="o">*</span><span class="n">rtxm</span><span class="p">)</span><span class="o">*</span><span class="n">rtxm</span><span class="p">)</span><span class="o">*</span><span class="n">rtxm</span><span class="p">)</span><span class="o">*</span><span class="n">rtxm</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp_est</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mf">2.0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400e0</span><span class="o">*</span><span class="p">(</span><span class="n">rtxm</span><span class="o">*</span><span class="n">rtxm</span><span class="p">);</span>
<span class="w">        </span><span class="n">sqrty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10e0</span><span class="o">*</span><span class="n">rtxm</span><span class="p">;</span>
<span class="w">        </span><span class="n">part1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">1.5e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="n">part2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="p">));</span>
<span class="w">        </span><span class="n">dsp_drtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsp_drtx</span>
<span class="w">                      </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a0</span><span class="o">*</span><span class="mf">800e0</span><span class="o">*</span><span class="n">rtxm</span><span class="o">*</span><span class="p">(</span><span class="mf">1.5e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2e0</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">part1</span><span class="o">*</span><span class="n">part1</span><span class="p">)</span>
<span class="w">                      </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">b0</span><span class="o">*</span><span class="n">ft68</span><span class="o">*</span><span class="p">(</span><span class="mf">10e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">20e0</span>
<span class="w">                                            </span><span class="o">+</span><span class="w"> </span><span class="mf">30e0</span><span class="o">*</span><span class="n">sqrty</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">part2</span><span class="o">*</span><span class="n">part2</span><span class="p">);</span>
<span class="w">        </span><span class="n">hill_ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_hill_ratio_at_sp2</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="w">        </span><span class="n">dsp_drtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hill_ratio</span><span class="o">*</span><span class="n">dsp_drtx</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">rtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtx_old</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">sp_est</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sp</span><span class="p">)</span><span class="o">/</span><span class="n">dsp_drtx</span><span class="p">;</span>
<span class="w">    </span><span class="n">sp_est</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a0</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a3</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a5</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">ft68</span><span class="o">*</span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b3</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">b5</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">)</span><span class="o">*</span><span class="n">rtx</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp_est</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mf">2.0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400e0</span><span class="o">*</span><span class="p">(</span><span class="n">rtx</span><span class="o">*</span><span class="n">rtx</span><span class="p">);</span>
<span class="w">        </span><span class="n">sqrty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10e0</span><span class="o">*</span><span class="n">rtx</span><span class="p">;</span>
<span class="w">        </span><span class="n">part1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">1.5e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="n">part2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="p">));</span>
<span class="w">        </span><span class="n">sp_hill_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp_est</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a0</span><span class="o">/</span><span class="n">part1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">b0</span><span class="o">*</span><span class="n">ft68</span><span class="o">/</span><span class="n">part2</span><span class="p">;</span>
<span class="w">        </span><span class="n">hill_ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_hill_ratio_at_sp2</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="w">        </span><span class="n">sp_est</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hill_ratio</span><span class="o">*</span><span class="n">sp_hill_raw</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">rtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtx</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">sp_est</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sp</span><span class="p">)</span><span class="o">/</span><span class="n">dsp_drtx</span><span class="p">;</span>
<span class="w">    </span><span class="n">rt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtx</span><span class="o">*</span><span class="n">rtx</span><span class="p">;</span>
<span class="w">    </span><span class="n">aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">d3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">d4</span><span class="o">*</span><span class="n">t68</span><span class="p">;</span>
<span class="w">    </span><span class="n">bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t68</span><span class="o">*</span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">d1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">d2</span><span class="o">*</span><span class="n">t68</span><span class="p">);</span>
<span class="w">    </span><span class="n">cc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">e1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">e2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">e3</span><span class="o">*</span><span class="n">p</span><span class="p">));</span>
<span class="w">    </span><span class="n">rt_lc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">c0</span>
<span class="w">              </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">c1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">c2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">c3</span>
<span class="w">                                                </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">c4</span><span class="o">*</span><span class="n">t68</span><span class="p">)</span><span class="o">*</span><span class="n">t68</span><span class="p">)</span><span class="o">*</span><span class="n">t68</span><span class="p">)</span><span class="o">*</span><span class="n">t68</span><span class="p">;</span>
<span class="w">    </span><span class="n">dd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">aa</span><span class="o">*</span><span class="n">rt_lc</span><span class="o">*</span><span class="n">rt</span><span class="p">;</span>
<span class="w">    </span><span class="n">ee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rt_lc</span><span class="o">*</span><span class="n">rt</span><span class="o">*</span><span class="n">aa</span><span class="o">*</span><span class="p">(</span><span class="n">bb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cc</span><span class="p">);</span>
<span class="w">    </span><span class="n">ra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">dd</span><span class="o">*</span><span class="n">dd</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4e0</span><span class="o">*</span><span class="n">ee</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dd</span><span class="p">;</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5e0</span><span class="o">*</span><span class="n">ra</span><span class="o">/</span><span class="n">aa</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_c3515</span><span class="o">*</span><span class="n">r</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_cp_t_exact                                     isobaric heat capacity</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_cp_t_exact(SA,t,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the isobaric heat capacity of seawater.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  t   =  in-situ temperature (ITS-90)                            [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%          ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  cp_t_exact  =  heat capacity of seawater                    [ J/(kg*K) ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  David Jackett, Trevor McDougall and Paul Barker     [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">% The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_cp_t_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="mf">273.15e0</span><span class="p">)</span><span class="o">*</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_CT_from_entropy                         Conservative Temperature with</span>
<span class="cm">%                                                          entropy as input</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%   gsw_CT_from_entropy(SA,entropy)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates Conservative Temperature with entropy as an input variable.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA       =  Absolute Salinity                                   [ g/kg ]</span>
<span class="cm">%  entropy  =  specific entropy                                   [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See appendix  A.10 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_ct_from_entropy</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">entropy</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_pt_from_entropy</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">entropy</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_ct_from_pt</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">pt</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_CT_first_derivatives    first derivatives of Conservative Temperature</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_CT_first_derivatives(SA,pt)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following two derivatives of Conservative Temperature</span>
<span class="cm">%  (1) CT_SA, the derivative with respect to Absolute Salinity at</span>
<span class="cm">%      constant potential temperature (with pr = 0 dbar), and</span>
<span class="cm">%   2) CT_pt, the derivative with respect to potential temperature</span>
<span class="cm">%      (the regular potential temperature which is referenced to 0 dbar)</span>
<span class="cm">%      at constant Absolute Salinity.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  pt  =  potential temperature (ITS-90)                          [ deg C ]</span>
<span class="cm">%         (whose reference pressure is 0 dbar)</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  CT_SA  =  The derivative of Conservative Temperature with respect to</span>
<span class="cm">%            Absolute Salinity at constant potential temperature</span>
<span class="cm">%            (the regular potential temperature which has reference</span>
<span class="cm">%            sea pressure of 0 dbar).</span>
<span class="cm">%            The CT_SA output has units of:                     [ K/(g/kg)]</span>
<span class="cm">%  CT_pt  =  The derivative of Conservative Temperature with respect to</span>
<span class="cm">%            potential temperature (the regular one with pr = 0 dbar)</span>
<span class="cm">%            at constant SA. CT_pt is dimensionless.           [ unitless ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%    See Eqns. (A.12.3a,b) and (A.15.8) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_ct_first_derivatives</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">pt</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ct_sa</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ct_pt</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">abs_pt</span><span class="p">,</span><span class="w"> </span><span class="n">g_sa_mod</span><span class="p">,</span><span class="w"> </span><span class="n">g_sa_t_mod</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y_pt</span><span class="p">;</span>

<span class="w">    </span><span class="n">abs_pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_t0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pt</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ct_pt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="o">*</span><span class="n">ct_pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">abs_pt</span><span class="o">*</span><span class="n">gsw_gibbs_pt0_pt0</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">pt</span><span class="p">))</span><span class="o">/</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_cp0</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ct_sa</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="p">);</span>
<span class="w">    </span><span class="n">y_pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.025</span><span class="o">*</span><span class="n">pt</span><span class="p">;</span>
<span class="w">    </span><span class="n">g_sa_t_mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1187.3715515697959</span>
<span class="w">                     </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">-1480.222530425046</span>
<span class="w">                  </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">2175.341332000392</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">-980.14153344888</span>
<span class="w">                  </span><span class="o">+</span><span class="w"> </span><span class="mf">220.542973797483</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-548.4580073635929</span>
<span class="w">                  </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">592.4012338275047</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-274.2361238716608</span>
<span class="w">                  </span><span class="o">+</span><span class="w"> </span><span class="mf">49.9394019139016</span><span class="o">*</span><span class="n">y_pt</span><span class="p">))))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-258.3988055868252</span>
<span class="w">                  </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-90.2046337756875</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="mf">10.50720794170734</span><span class="p">)))</span>
<span class="w">                       </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">3520.125411988816</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-1351.605895580406</span>
<span class="w">                  </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">731.4083582010072</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-216.60324087531103</span>
<span class="w">                                          </span><span class="o">+</span><span class="w"> </span><span class="mf">25.56203650166196</span><span class="o">*</span><span class="n">y_pt</span><span class="p">))));</span>

<span class="w">    </span><span class="n">g_sa_t_mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="mf">0.025</span><span class="o">*</span><span class="n">g_sa_t_mod</span><span class="p">;</span>

<span class="w">    </span><span class="n">g_sa_mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8645.36753595126</span>
<span class="w">                   </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">-7296.43987145382</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">8103.20462414788</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">2175.341332000392</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-274.2290036817964</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">197.4670779425016</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-68.5590309679152</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">9.98788038278032</span><span class="o">*</span><span class="n">y_pt</span><span class="p">))))</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">-5458.34205214835</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">980.14153344888</span><span class="o">*</span><span class="n">y_pt</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">2247.60742726704</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">340.1237483177863</span><span class="o">*</span><span class="n">x</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="mf">220.542973797483</span><span class="o">*</span><span class="n">y_pt</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-1480.222530425046</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-129.1994027934126</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-30.0682112585625</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">2.626801985426835</span><span class="w"> </span><span class="p">)))))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">1187.3715515697959</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">1760.062705994408</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-450.535298526802</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">182.8520895502518</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_pt</span><span class="o">*</span><span class="p">(</span><span class="mf">-43.3206481750622</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="mf">4.26033941694366</span><span class="o">*</span><span class="n">y_pt</span><span class="p">)))));</span>

<span class="w">    </span><span class="n">g_sa_mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">g_sa_mod</span><span class="p">;</span>

<span class="w">    </span><span class="o">*</span><span class="n">ct_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">g_sa_mod</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">abs_pt</span><span class="o">*</span><span class="n">g_sa_t_mod</span><span class="p">)</span><span class="o">/</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_cp0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_entropy_from_pt                          specific entropy of seawater</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_entropy_from_pt(SA,pt)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates specific entropy of seawater as a function of potential</span>
<span class="cm">%  temperature.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  pt  =  potential temperature (ITS-90)                          [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  entropy  =  specific entropy                                [ J/(kg*K) ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See appendix A.10 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_entropy_from_pt</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">pt</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">pt</span><span class="p">,</span><span class="mf">0.0</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_enthalpy_second_derivatives            second derivatives of enthalpy</span>
<span class="cm">%                                                        (75-term equation)</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_enthalpy_second_derivatives(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following three second-order derivatives of specific</span>
<span class="cm">%  enthalpy (h),using the computationally-efficient expression for</span>
<span class="cm">%  specific volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%   (1) h_SA_SA, second-order derivative with respect to Absolute Salinity</span>
<span class="cm">%       at constant CT &amp; p.</span>
<span class="cm">%   (2) h_SA_CT, second-order derivative with respect to SA &amp; CT at</span>
<span class="cm">%       constant p.</span>
<span class="cm">%   (3) h_CT_CT, second-order derivative with respect to CT at constant SA</span>
<span class="cm">%       and p.</span>
<span class="cm">%</span>
<span class="cm">%  Note that the 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  h_SA_SA  =  The second derivative of specific enthalpy with respect to</span>
<span class="cm">%              Absolute Salinity at constant CT &amp; p.    [ J/(kg (g/kg)^2) ]</span>
<span class="cm">%  h_SA_CT  =  The second derivative of specific enthalpy with respect to</span>
<span class="cm">%              SA and CT at constant p.                  [ J/(kg K(g/kg)) ]</span>
<span class="cm">%  h_CT_CT  =  The second derivative of specific enthalpy with respect to</span>
<span class="cm">%              CT at constant SA and p.                      [ J/(kg K^2) ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., 2003: Potential enthalpy: A conservative oceanic</span>
<span class="cm">%   variable for evaluating heat content and heat fluxes. Journal of</span>
<span class="cm">%   Physical Oceanography, 33, 945-963.</span>
<span class="cm">%    See Eqns. (18) and (22)</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_enthalpy_second_derivatives</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                                </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">h_sa_sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">h_sa_ct</span><span class="p">,</span>
<span class="w">                                                </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">h_ct_ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">dynamic_h_ct_ct_part</span><span class="p">,</span><span class="w"> </span><span class="n">dynamic_h_sa_ct_part</span><span class="p">,</span><span class="w"> </span><span class="n">dynamic_h_sa_sa_part</span><span class="p">,</span><span class="w"> </span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">xs2</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>

<span class="w">    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
<span class="w">    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="o">*</span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">*</span><span class="mf">1e-4</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">h_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">xs2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="n">dynamic_h_sa_sa_part</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h101</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h301</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h401</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">15.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h501</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">24.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h601</span><span class="o">*</span><span class="n">xs</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">h111</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h311</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h411</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">15.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h511</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h121</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h321</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">8.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h421</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h131</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h331</span><span class="o">*</span><span class="n">xs2</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h141</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">h151</span><span class="o">*</span><span class="n">ys</span><span class="p">))))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h102</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h302</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h402</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">15.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h502</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h112</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h312</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="mf">8.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h412</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h122</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h322</span><span class="o">*</span><span class="n">xs2</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h132</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">h142</span><span class="o">*</span><span class="n">ys</span><span class="w"> </span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h403</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h313</span><span class="o">*</span><span class="n">ys</span><span class="p">)</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h103</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h303</span><span class="o">*</span><span class="n">xs2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h113</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h123</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">h133</span><span class="o">*</span><span class="n">ys</span><span class="p">))</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h104</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">h114</span><span class="o">*</span><span class="n">ys</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">h105</span><span class="o">*</span><span class="n">z</span><span class="p">)))));</span>

<span class="w">        </span><span class="o">*</span><span class="n">h_sa_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e8</span><span class="o">*</span><span class="mf">0.25</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">dynamic_h_sa_sa_part</span><span class="o">/</span><span class="n">pow</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">h_sa_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">dynamic_h_sa_ct_part</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h111</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h211</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h311</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h411</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h511</span><span class="o">*</span><span class="n">xs</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h121</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h221</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h321</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">8.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h421</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h131</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h231</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">9.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h331</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h141</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">8.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h241</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h151</span><span class="o">*</span><span class="n">ys</span><span class="w"> </span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h112</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h212</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h312</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h412</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h122</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h222</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h322</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h132</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h232</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h142</span><span class="o">*</span><span class="n">ys</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h113</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h213</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h313</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h123</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h223</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h133</span><span class="o">*</span><span class="n">ys</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">h114</span><span class="o">*</span><span class="n">z</span><span class="p">)));</span>

<span class="w">        </span><span class="o">*</span><span class="n">h_sa_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e8</span><span class="o">*</span><span class="mf">0.025</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">dynamic_h_sa_ct_part</span><span class="o">/</span><span class="n">xs</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">h_ct_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">dynamic_h_ct_ct_part</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h021</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h121</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h221</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h321</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h421</span><span class="o">*</span><span class="n">xs</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h031</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h131</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h231</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h331</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">12.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h041</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">12.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h141</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">12.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h241</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">20.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h051</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">20.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h151</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">30.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h061</span><span class="o">*</span><span class="n">ys</span><span class="p">)))</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h022</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h122</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h222</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h322</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h032</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h132</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h232</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">12.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h042</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">12.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h142</span><span class="o">*</span><span class="n">xs</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="mf">20.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h052</span><span class="o">*</span><span class="n">ys</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h023</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h123</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h223</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h133</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">6.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h033</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="mf">12.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h043</span><span class="o">*</span><span class="n">ys</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">h024</span><span class="o">*</span><span class="n">z</span><span class="p">)));</span>

<span class="w">        </span><span class="o">*</span><span class="n">h_ct_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e8</span><span class="o">*</span><span class="mf">6.25e-4</span><span class="o">*</span><span class="n">dynamic_h_ct_ct_part</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">% gsw_entropy_from_t                           specific entropy of seawater</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_entropy_from_t(SA,t,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates specific entropy of seawater from in-situ temperature.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  t   =  in-situ temperature (ITS-90)                            [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  entropy  =  specific entropy                                [ J/(kg*K) ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  David Jackett, Trevor McDougall and Paul Barker     [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_entropy_from_t</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_latentheat_evap_CT                         latent heat of evaporation</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_latentheat_evap_CT(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates latent heat, or enthalpy, of evaporation at p = 0 (the</span>
<span class="cm">%  surface).  It is defined as a function of Absolute Salinity, SA, and</span>
<span class="cm">%  Conservative Temperature, CT, and is valid in the ranges</span>
<span class="cm">%  0 &lt; SA &lt; 42 g/kg and 0 &lt; CT &lt; 40 deg C.  The errors range between</span>
<span class="cm">%  -0.4 and 0.6 J/kg.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  latentheat_evap = latent heat of evaporation                    [ J/kg ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker, Trevor McDougall &amp; Rainer Feistel      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%     See section 3.39 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_latentheat_evap_ct</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w">  </span><span class="n">c0</span><span class="w">  </span><span class="o">=</span><span class="w">  </span><span class="mf">2.499065844825125e6</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.544590633515099e-1</span><span class="p">,</span>
<span class="w">              </span><span class="n">c2</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.096800915831875e4</span><span class="p">,</span><span class="w"> </span><span class="n">c3</span><span class="w">  </span><span class="o">=</span><span class="w">  </span><span class="mf">1.665513670736000e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">c4</span><span class="w">  </span><span class="o">=</span><span class="w">  </span><span class="mf">4.589984751248335e1</span><span class="p">,</span><span class="w"> </span><span class="n">c5</span><span class="w">  </span><span class="o">=</span><span class="w">  </span><span class="mf">1.894281502222415e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">c6</span><span class="w">  </span><span class="o">=</span><span class="w">  </span><span class="mf">1.192559661490269e3</span><span class="p">,</span><span class="w"> </span><span class="n">c7</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">-6.631757848479068e3</span><span class="p">,</span>
<span class="w">              </span><span class="n">c8</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.104989199195898e2</span><span class="p">,</span><span class="w"> </span><span class="n">c9</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.207006482532330e3</span><span class="p">,</span>
<span class="w">              </span><span class="n">c10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.148710097513822e3</span><span class="p">,</span><span class="w"> </span><span class="n">c11</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">7.437431482069087e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">c12</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.519335841663499e3</span><span class="p">,</span><span class="w"> </span><span class="n">c13</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.186568375570869e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">c14</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">5.731307337366114e2</span><span class="p">,</span><span class="w"> </span><span class="n">c15</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.213387273240204e3</span><span class="p">,</span>
<span class="w">              </span><span class="n">c16</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.062383995581363e3</span><span class="p">,</span><span class="w"> </span><span class="n">c17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-6.399956483223386e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">c18</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.541083032068263e3</span><span class="p">,</span><span class="w"> </span><span class="n">c19</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">8.460780175632090e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">c20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.233571307223379e2</span><span class="p">,</span><span class="w"> </span><span class="n">c21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.031538422351553e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">c22</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">4.351585544019463e1</span><span class="p">,</span><span class="w"> </span><span class="n">c23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-8.062279018001309e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">c24</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">7.510134932437941e2</span><span class="p">,</span><span class="w"> </span><span class="n">c25</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.797443329095446e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">c26</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.389853928747630e1</span><span class="p">,</span><span class="w"> </span><span class="n">c27</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.021046205356775e2</span><span class="p">;</span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>

<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="p">);</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="o">/</span><span class="mf">40.0</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">c0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">c1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c4</span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">c3</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="n">c7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c12</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">c6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="n">c11</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="n">c17</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c24</span><span class="o">*</span><span class="n">y</span><span class="p">))</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">c10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="n">c16</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c23</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">c15</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c22</span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c21</span><span class="o">*</span><span class="n">x</span><span class="p">)))))</span>
<span class="w">               </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="n">c2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="n">c5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c8</span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="n">c9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">c13</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c18</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="n">c14</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">c19</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c25</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="n">c20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c26</span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c27</span><span class="o">*</span><span class="n">y</span><span class="p">))))));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_latentheat_evap_t                          latent heat of evaporation</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_latentheat_evap_t(SA,t)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates latent heat, or enthalpy, of evaporation at p = 0 (the</span>
<span class="cm">%  surface).  It is defined as a function of Absolute Salinity, SA, and</span>
<span class="cm">%  in-situ temperature, t, and is valid in the ranges 0 &lt; SA &lt; 40 g/kg</span>
<span class="cm">%  and 0 &lt; CT &lt; 42 deg C. The errors range between -0.4 and 0.6 J/kg.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  t   =  in-situ temperature (ITS-90)                            [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  latentheat_evap = latent heat of evaporation                    [ J/kg ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker, Trevor McDougall &amp; Rainer Feistel      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%     See section 3.39 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_latentheat_evap_t</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w">  </span><span class="n">ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_ct_from_pt</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_latentheat_evap_ct</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">% gsw_pot_rho_t_exact                                     potential density</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_pot_rho_t_exact(SA,t,p,p_ref)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density of seawater.  Note. This function outputs</span>
<span class="cm">%  potential density, not potential density anomaly; that is, 1000 kg/m^3</span>
<span class="cm">%  is not subtracted.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA     =  Absolute Salinity                                     [ g/kg ]</span>
<span class="cm">%  t      =  in-situ temperature (ITS-90)                         [ deg C ]</span>
<span class="cm">%  p      =  sea pressure                                          [ dbar ]</span>
<span class="cm">%            ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%  p_ref  =  reference pressure                                    [ dbar ]</span>
<span class="cm">%            ( i.e. reference absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  pot_rho_t_exact  =  potential density (not potential density anomaly)</span>
<span class="cm">%                                                                [ kg/m^3 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  David Jackett, Trevor McDougall and Paul Barker     [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See section 3.4 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_pot_rho_t_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p_ref</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_pt_from_t</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">p_ref</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">pt</span><span class="p">,</span><span class="n">p_ref</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">function pt = gsw_pt_from_entropy(SA,entropy)</span>

<span class="cm">% gsw_pt_from_entropy                          potential temperature with a</span>
<span class="cm">%                                       reference sea pressure of zero dbar</span>
<span class="cm">%                                                  as a function of entropy</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_pt_from_entropy(SA,entropy)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential temperature with reference pressure p_ref = 0 dbar</span>
<span class="cm">%  and with entropy as an input variable.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA       =  Absolute Salinity                                   [ g/kg ]</span>
<span class="cm">%  entropy  =  specific entropy                                   [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  pt   =  potential temperature                                  [ deg C ]</span>
<span class="cm">%          with reference sea pressure (p_ref) = 0 dbar.</span>
<span class="cm">%  Note. The reference sea pressure of the output, pt, is zero dbar.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See appendix  A.10 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall T. J. and S. J. Wotherspoon, 2013: A simple modification of</span>
<span class="cm">%   Newton&#39;s method to achieve convergence of order 1 + sqrt(2).  Applied</span>
<span class="cm">%   Mathematics Letters, 29, 20-25.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_pt_from_entropy</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">entropy</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">number_of_iterations</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">dentropy</span><span class="p">,</span><span class="w"> </span><span class="n">dentropy_dt</span><span class="p">,</span><span class="w"> </span><span class="n">ent_sa</span><span class="p">,</span><span class="w"> </span><span class="n">part1</span><span class="p">,</span><span class="w"> </span><span class="n">part2</span><span class="p">,</span><span class="w"> </span><span class="n">pt</span><span class="p">,</span><span class="w"> </span><span class="n">ptm</span><span class="p">,</span><span class="w"> </span><span class="n">pt_old</span><span class="p">;</span>

<span class="w">    </span><span class="n">part1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sa</span><span class="o">/</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sso</span><span class="p">;</span>
<span class="w">    </span><span class="n">part2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.05</span><span class="o">*</span><span class="n">part1</span><span class="p">;</span>
<span class="w">    </span><span class="n">ent_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_cp0</span><span class="o">/</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_t0</span><span class="p">)</span><span class="o">*</span><span class="n">part1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.01</span><span class="o">*</span><span class="n">part1</span><span class="p">);</span>
<span class="w">    </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">entropy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ent_sa</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">part2</span><span class="o">/</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_cp0</span><span class="p">);</span>
<span class="w">    </span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_t0</span><span class="o">*</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">    </span><span class="n">dentropy_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_cp0</span><span class="o">/</span><span class="p">((</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_t0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pt</span><span class="p">)</span><span class="o">*</span><span class="n">part2</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">number_of_iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">number_of_iterations</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">            </span><span class="n">number_of_iterations</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">pt_old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">;</span>
<span class="w">        </span><span class="n">dentropy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_entropy_from_pt</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">pt_old</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">entropy</span><span class="p">;</span>
<span class="w">        </span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt_old</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dentropy</span><span class="o">/</span><span class="n">dentropy_dt</span><span class="p">;</span>
<span class="w">        </span><span class="n">ptm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">pt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pt_old</span><span class="p">);</span>
<span class="w">        </span><span class="n">dentropy_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">gsw_gibbs_pt0_pt0</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ptm</span><span class="p">);</span>
<span class="w">        </span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt_old</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dentropy</span><span class="o">/</span><span class="n">dentropy_dt</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">pt</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_rho_first_derivatives_wrt_enthalpy                  first derivatives</span>
<span class="cm">%                                  specific volume with respect to enthalpy</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_rho_first_derivatives_wrt_enthalpy(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following two first-order derivatives of specific</span>
<span class="cm">%  volume (v),</span>
<span class="cm">%   (1) rho_SA, first-order derivative with respect to Absolute Salinity</span>
<span class="cm">%       at constant CT &amp; p.</span>
<span class="cm">%   (2) rho_h, first-order derivative with respect to SA &amp; CT at</span>
<span class="cm">%       constant p.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the using the computationally-efficient</span>
<span class="cm">%  expression for specific volume (Roquet et al., 2015).  There is an</span>
<span class="cm">%  alternative to calling this function, namely</span>
<span class="cm">%  gsw_rho_first_derivatives_wrt_enthalpy_CT_exact(SA,CT,p) which uses</span>
<span class="cm">%  the full Gibbs function (IOC et al., 2010).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  rho_SA =  The first derivative of rho with respect to</span>
<span class="cm">%              Absolute Salinity at constant CT &amp; p.    [ J/(kg (g/kg)^2) ]</span>
<span class="cm">%  rho_h  =  The first derivative of rho with respect to</span>
<span class="cm">%              SA and CT at constant p.                  [ J/(kg K(g/kg)) ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>

<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_rho_first_derivatives_wrt_enthalpy</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span>
<span class="w">                                                      </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">rho_sa</span><span class="p">,</span>
<span class="w">                                                      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">rho_h</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">rec_v2</span><span class="p">,</span><span class="w"> </span><span class="n">v_h</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">rho_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">rho_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">gsw_specvol_first_derivatives_wrt_enthalpy</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_sa</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_h</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rho_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">gsw_specvol_first_derivatives_wrt_enthalpy</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_sa</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rho_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">gsw_specvol_first_derivatives_wrt_enthalpy</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_h</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">rec_v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">gsw_specvol</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rho_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">rho_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_sa</span><span class="o">*</span><span class="n">rec_v2</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rho_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">rho_h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_h</span><span class="o">*</span><span class="n">rec_v2</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_rho_t_exact                                       density of seawater</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_rho_t_exact(SA,t,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates in-situ density of seawater from Absolute Salinity and</span>
<span class="cm">%  in-situ temperature.  Note that the output, rho, is density,</span>
<span class="cm">%  not density anomaly; that is, 1000 kg/m^3 is not subracted from it.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  t   =  in-situ temperature (ITS-90)                            [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  rho_t_exact  =  in-situ density (not density anomaly)         [ kg/m^3 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker, David Jackett &amp; Trevor McDougall       [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See section 2.8 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">% gsw_SA_from_rho                            Absolute Salinity from density</span>
<span class="cm">%                                                        (75-term equation)</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_SA_from_rho(rho,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the Absolute Salinity of a seawater sample, for given values</span>
<span class="cm">%  of its density, Conservative Temperature and sea pressure (in dbar).</span>
<span class="cm">%  This function uses the computationally-efficient 75-term expression for</span>
<span class="cm">%  specific volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  rho =  density of a seawater sample (e.g. 1026 kg/m^3).       [ kg/m^3 ]</span>
<span class="cm">%   Note. This input has not had 1000 kg/m^3 subtracted from it.</span>
<span class="cm">%     That is, it is &#39;density&#39;, not &#39;density anomaly&#39;.</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity.                                       [ g/kg ]</span>
<span class="cm">%   Note. This is expressed on the Reference-Composition Salinity</span>
<span class="cm">%     Scale of Millero et al. (2008).</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall &amp; Paul Barker                      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See section 2.5 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Millero, F.J., R. Feistel, D.G. Wright, and T.J. McDougall, 2008:</span>
<span class="cm">%   The composition of Standard Seawater and the definition of the</span>
<span class="cm">%   Reference-Composition Salinity Scale. Deep-Sea Res. I, 55, 50-72.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sa_from_rho</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">rho</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">no_iter</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">v_lab</span><span class="p">,</span><span class="w"> </span><span class="n">v_0</span><span class="p">,</span><span class="w"> </span><span class="n">v_50</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa</span><span class="p">,</span><span class="w"> </span><span class="n">sa_old</span><span class="p">,</span><span class="w"> </span><span class="n">delta_v</span><span class="p">,</span><span class="w"> </span><span class="n">sa_mean</span><span class="p">;</span>

<span class="w">    </span><span class="n">v_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="o">/</span><span class="n">rho</span><span class="p">;</span>
<span class="w">    </span><span class="n">v_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_specvol</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">v_50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_specvol</span><span class="p">(</span><span class="mf">50.0</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">50.0</span><span class="o">*</span><span class="p">(</span><span class="n">v_lab</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v_0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">v_50</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v_0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sa</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">50.0</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">cppGSW_INVALID_VALUE</span><span class="p">);</span>
<span class="w">    </span><span class="n">v_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">v_50</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v_0</span><span class="p">)</span><span class="o">/</span><span class="mf">50.0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">no_iter</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">no_iter</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">no_iter</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">sa_old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa</span><span class="p">;</span>
<span class="w">        </span><span class="n">delta_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_specvol</span><span class="p">(</span><span class="n">sa_old</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v_lab</span><span class="p">;</span>
<span class="w">        </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa_old</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">delta_v</span><span class="o">/</span><span class="n">v_sa</span><span class="p">;</span>
<span class="w">        </span><span class="n">sa_mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sa_old</span><span class="p">);</span>
<span class="w">        </span><span class="n">gsw_specvol_first_derivatives</span><span class="p">(</span><span class="n">sa_mean</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_sa</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">        </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa_old</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">delta_v</span><span class="o">/</span><span class="n">v_sa</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sa</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">50.0</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">cppGSW_INVALID_VALUE</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">sa</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sigma0                       potential density anomaly with reference</span>
<span class="cm">%                                 sea pressure of 0 dbar (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_sigma0(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density anomaly with reference pressure of 0 dbar,</span>
<span class="cm">%  this being this particular potential density minus 1000 kg/m^3.  This</span>
<span class="cm">%  function has inputs of Absolute Salinity and Conservative Temperature.</span>
<span class="cm">%  This function uses the computationally-efficient expression for</span>
<span class="cm">%  specific volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sigma0  =  potential density anomaly with                     [ kg/m^3 ]</span>
<span class="cm">%             respect to a reference pressure of 0 dbar,</span>
<span class="cm">%             that is, this potential density - 1000 kg/m^3.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (A.30.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sigma0</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">vp0</span><span class="p">,</span><span class="w"> </span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">;</span>

<span class="w">    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
<span class="w">    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="o">*</span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">    </span><span class="n">vp0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">v000</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v010</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v020</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v030</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v040</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v050</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">v060</span><span class="o">*</span><span class="n">xs</span><span class="p">)))))</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v110</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v120</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v130</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v140</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">v150</span><span class="o">*</span><span class="n">xs</span><span class="p">))))</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v200</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v210</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v220</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v230</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">v240</span><span class="o">*</span><span class="n">xs</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v300</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v310</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v320</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">v330</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v400</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v410</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">v420</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">v500</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">v510</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">v600</span><span class="o">*</span><span class="n">ys</span><span class="p">)))));</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">vp0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sound_speed                            sound speed (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_sound_speed(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the speed of sound in seawater.  This function has inputs of</span>
<span class="cm">%  Absolute Salinity and Conservative Temperature.  This function uses the</span>
<span class="cm">%  computationally-efficient expression for specific volume in terms of SA,</span>
<span class="cm">%  CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sound_speed  =  speed of sound in seawater                       [ m/s ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (2.17.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sound_speed</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">v_p</span><span class="p">,</span><span class="w"> </span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>

<span class="w">    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
<span class="w">    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="o">*</span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">*</span><span class="mf">1e-4</span><span class="p">;</span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_v</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">    </span><span class="n">v_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_c</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mf">10000.0</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">v</span><span class="o">*</span><span class="n">v</span><span class="o">/</span><span class="n">v_p</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sound_speed_t_exact                                       sound speed</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  sound_speed_t_exact = gsw_sound_speed_t_exact(SA,t,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the speed of sound in seawater.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  t   =  in-situ temperature (ITS-90)                            [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sound_speed_t_exact  =  speed of sound in seawater               [ m/s ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  David Jackett, Paul Barker and Trevor McDougall     [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (2.17.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sound_speed_t_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">g_tt</span><span class="p">,</span><span class="w"> </span><span class="n">g_tp</span><span class="p">;</span>

<span class="w">    </span><span class="n">g_tt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">g_tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">              </span><span class="n">sqrt</span><span class="p">(</span><span class="n">g_tt</span><span class="o">/</span><span class="p">(</span><span class="n">g_tp</span><span class="o">*</span><span class="n">g_tp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">g_tt</span><span class="o">*</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">))));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_SP_from_SK                   Practical Salinity from Knudsen Salinity</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_SP_from_SK(SK)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates Practical Salinity from Knudsen Salinity.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SK  =  Knudsen Salinity                        [parts per thousand, ppt]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  SP  =  Practical Salinity  (PSS-78)                         [ unitless ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%      See Appendix A.3 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sp_from_sk</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sk</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">gsw_sp_from_sk_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sk</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.03e0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_soncl</span><span class="o">/</span><span class="mf">1.805e0</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_sp_from_sk_value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0e0</span><span class="p">)</span>
<span class="w">        </span><span class="n">gsw_sp_from_sk_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cppGSW_INVALID_VALUE</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_sp_from_sk_value</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">% gsw_SP_from_SR                 Practical Salinity from Reference Salinity</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_SP_from_SR(SR)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates Practical Salinity from Reference Salinity.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SR  =  Reference Salinity                                       [ g/kg ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  SP  =  Practical Salinity  (PSS-78)                         [ unitless ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sp_from_sr</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sr</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="p">(</span><span class="n">sr</span><span class="o">/</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_ups</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_SP_salinometer       Practical Salinity from a laboratory salinometer</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_SP_salinometer(Rt,t)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates Practical Salinity SP from a salinometer, primarily using the</span>
<span class="cm">%  PSS-78 algorithm.  Note that the PSS-78 algorithm for Practical Salinity</span>
<span class="cm">%  is only valid in the range 2 &lt; SP &lt; 42.  If the PSS-78 algorithm</span>
<span class="cm">%  produces a Practical Salinity that is less than 2 then the Practical</span>
<span class="cm">%  Salinity is recalculated with a modified form of the Hill et al. (1986)</span>
<span class="cm">%  formula.  The modification of the Hill et al. (1986) expression is to</span>
<span class="cm">%  ensure that it is exactly consistent with PSS-78 at SP = 2.</span>
<span class="cm">%</span>
<span class="cm">%  A laboratory salinometer has the ratio of conductivities, Rt, as an</span>
<span class="cm">%  output, and the present function uses this conductivity ratio and the</span>
<span class="cm">%  temperature t of the salinometer bath as the two input variables.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  Rt  =  C(SP,t_68,0)/C(SP=35,t_68,0)                         [ unitless ]</span>
<span class="cm">%  t   =  temperature of the bath of the salinometer,</span>
<span class="cm">%         measured on the ITS-90 scale (ITS-90)                   [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  SP  =  Practical Salinity on the PSS-78 scale               [ unitless ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker, Trevor McDougall and Rich Pawlowicz    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  Fofonoff, P. and R.C. Millard Jr. 1983: Algorithms for computation of</span>
<span class="cm">%   fundamental properties of seawater. Unesco Tech. Pap. in Mar. Sci., 44,</span>
<span class="cm">%   53 pp.</span>
<span class="cm">%</span>
<span class="cm">%  Hill, K.D., T.M. Dauphinee &amp; D.J. Woods, 1986: The extension of the</span>
<span class="cm">%   Practical Salinity Scale 1978 to low salinities. IEEE J. Oceanic Eng.,</span>
<span class="cm">%   11, 109 - 112.</span>
<span class="cm">%</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%     See appendix E of this TEOS-10 Manual, and in particular,</span>
<span class="cm">%     Eqns. (E.2.1) and (E.2.6).</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sp_salinometer</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">rt</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t68</span><span class="p">,</span><span class="w"> </span><span class="n">ft68</span><span class="p">,</span><span class="w"> </span><span class="n">rtx</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="n">hill_ratio</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">sqrty</span><span class="p">,</span><span class="w"> </span><span class="n">part1</span><span class="p">,</span><span class="w"> </span><span class="n">part2</span><span class="p">,</span><span class="w"> </span><span class="n">sp_hill_raw</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rt</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NAN</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">t68</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="mf">1.00024</span><span class="p">;</span>
<span class="w">    </span><span class="n">ft68</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t68</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">15</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">t68</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">15</span><span class="p">));</span>
<span class="w">    </span><span class="n">rtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
<span class="w">    </span><span class="n">sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a0</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a3</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">a4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rtx</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rtx</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rtx</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rtx</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rtx</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="n">ft68</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b2</span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b3</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gspc</span><span class="p">.</span><span class="n">b4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">b5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rtx</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rtx</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rtx</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rtx</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rtx</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">hill_ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_hill_ratio_at_sp2</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400e0</span><span class="o">*</span><span class="n">rt</span><span class="p">;</span>
<span class="w">        </span><span class="n">sqrty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10e0</span><span class="o">*</span><span class="n">rtx</span><span class="p">;</span>
<span class="w">        </span><span class="n">part1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">1.5e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="n">part2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="o">*</span><span class="p">(</span><span class="mf">1e0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrty</span><span class="p">));</span>
<span class="w">        </span><span class="n">sp_hill_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">a0</span><span class="o">/</span><span class="n">part1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gspc</span><span class="p">.</span><span class="n">b0</span><span class="o">*</span><span class="n">ft68</span><span class="o">/</span><span class="n">part2</span><span class="p">;</span>
<span class="w">        </span><span class="n">sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hill_ratio</span><span class="o">*</span><span class="n">sp_hill_raw</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sp</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_specvol_anom_standard                    specific volume anomaly with</span>
<span class="cm">%                         reference of SA = SSO &amp; CT = 0 (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_specvol_anom_standard(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates specific volume anomaly from Absolute Salinity, Conservative</span>
<span class="cm">%  Temperature and pressure. It uses the computationally-efficient</span>
<span class="cm">%  expression for specific volume as a function of SA, CT and p (Roquet</span>
<span class="cm">%  et al., 2015).  The reference value to which the anomally is calculated</span>
<span class="cm">%  has an Absolute Salinity of SSO and Conservative Temperature equal to</span>
<span class="cm">%  0 degress C.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA     =  Absolute Salinity                                     [ g/kg ]</span>
<span class="cm">%  CT     =  Conservative Temperature (ITS-90)                    [ deg C ]</span>
<span class="cm">%  p      =  sea pressure                                          [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  specvol_anom  =  specific volume anomaly                      [ m^3/kg ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (3.7.3) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">% The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_specvol_anom_standard</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_specvol</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gsw_specvol_sso_0</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_specvol_first_derivatives                     first order derivatives</span>
<span class="cm">%                                     of specific volume (75-term equation)</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_specvol_first_derivatives(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following three first-order derivatives of specific</span>
<span class="cm">%  volume (v),</span>
<span class="cm">%   (1) v_SA, first-order derivative with respect to Absolute Salinity</span>
<span class="cm">%       at constant CT &amp; p.</span>
<span class="cm">%   (2) v_CT, first-order derivative with respect to CT at</span>
<span class="cm">%       constant SA &amp; p.</span>
<span class="cm">%   (3) v_P, first-order derivative with respect to P at constant SA</span>
<span class="cm">%       and CT.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the using the computationally-efficient</span>
<span class="cm">%  75-term expression for specific volume (Roquet et al., 2015).  There is</span>
<span class="cm">%  an alternative to calling this function, namely</span>
<span class="cm">%  gsw_specvol_first_derivatives_CT_exact(SA,CT,p) which uses the full</span>
<span class="cm">%  Gibbs function (IOC et al., 2010).</span>
<span class="cm">%</span>
<span class="cm">%  This 75-term equation has been fitted in a restricted range of parameter</span>
<span class="cm">%  space, and is most accurate inside the &quot;oceanographic funnel&quot; described</span>
<span class="cm">%  in McDougall et al. (2010).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  v_SA  =  The first derivative of specific volume with respect to</span>
<span class="cm">%           Absolute Salinity at constant CT &amp; p.     [ (m^3/kg)(g/kg)^-1 ]</span>
<span class="cm">%  v_CT  =  The first derivative of specific volume with respect to</span>
<span class="cm">%           CT at constant SA and p.                         [ m^3/(K kg) ]</span>
<span class="cm">%  v_P   =  The first derivative of specific volume with respect to</span>
<span class="cm">%           P at constant SA and CT.                        [ m^3/(Pa kg) ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_specvol_first_derivatives</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                             </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w">  </span><span class="n">v_ct_part</span><span class="p">,</span><span class="w"> </span><span class="n">v_p_part</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_part</span><span class="p">,</span><span class="w"> </span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>

<span class="w">    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
<span class="w">    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="o">*</span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">*</span><span class="mf">1e-4</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_sa_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_b</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">        </span><span class="o">*</span><span class="n">v_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">v_sa_part</span><span class="o">/</span><span class="n">xs</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_ct_part</span><span class="w"> </span><span class="o">=</span><span class="n">gsw_gsvco_a</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">        </span><span class="o">*</span><span class="n">v_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.025</span><span class="o">*</span><span class="n">v_ct_part</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_p_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_c</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">        </span><span class="o">*</span><span class="n">v_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-8</span><span class="o">*</span><span class="n">v_p_part</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_specvol_first_derivatives_wrt_enthalpy        first order derivatives</span>
<span class="cm">%                               of specific volume with respect to enthalpy</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_specvol_first_derivatives_wrt_enthalpy(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following two first-order derivatives of specific</span>
<span class="cm">%  volume (v),</span>
<span class="cm">%   (1) v_SA_wrt_h, first-order derivative with respect to Absolute Salinity</span>
<span class="cm">%       at constant h &amp; p.</span>
<span class="cm">%   (2) v_h, first-order derivative with respect to h at</span>
<span class="cm">%       constant SA &amp; p.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the using the computationally-efficient</span>
<span class="cm">%  75 term expression for specific volume (Roquet et al., 2015).  There is</span>
<span class="cm">%  an alternative to calling this function, namely</span>
<span class="cm">%  gsw_specvol_first_derivatives_wrt_enthalpy_CT_exact(SA,CT,p) which uses</span>
<span class="cm">%  the full Gibbs function (IOC et al., 2010).</span>
<span class="cm">%</span>
<span class="cm">%  This 75-term equation has been fitted in a restricted range of parameter</span>
<span class="cm">%  space, and is most accurate inside the &quot;oceanographic funnel&quot; described</span>
<span class="cm">%  in McDougall et al. (2010).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  v_SA_wrt_h  =  The first derivative of specific volume with respect to</span>
<span class="cm">%              Absolute Salinity at constant CT &amp; p.</span>
<span class="cm">%                                           [ (m^3/kg)(g/kg)^-1 (J/kg)^-1 ]</span>
<span class="cm">%  v_h  =  The first derivative of specific volume with respect to</span>
<span class="cm">%              SA and CT at constant p.               [ (m^3/kg)(J/kg)^-1 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_specvol_first_derivatives_wrt_enthalpy</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span>
<span class="w">                                                            </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_sa</span><span class="p">,</span>
<span class="w">                                                            </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_h</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">h_ct</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">h_sa</span><span class="p">,</span><span class="w"> </span><span class="n">rec_h_ct</span><span class="p">,</span><span class="w"> </span><span class="n">vct_ct</span><span class="p">,</span><span class="w"> </span><span class="n">vct_sa</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">gsw_specvol_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">vct_sa</span><span class="p">,</span><span class="o">&amp;</span><span class="n">vct_ct</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">        </span><span class="n">gsw_enthalpy_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_sa</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_ct</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">gsw_specvol_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">vct_ct</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">        </span><span class="n">gsw_enthalpy_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_ct</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">rec_h_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="o">/</span><span class="n">h_ct</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="o">*</span><span class="n">v_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vct_sa</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">vct_ct</span><span class="o">*</span><span class="n">h_sa</span><span class="p">)</span><span class="o">*</span><span class="n">rec_h_ct</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="o">*</span><span class="n">v_h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vct_ct</span><span class="o">*</span><span class="n">rec_h_ct</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_specvol_second_derivatives                   second order derivatives</span>
<span class="cm">%                                     of specific volume (75-term equation)</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_specvol_second_derivatives(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following five second-order derivatives of specific</span>
<span class="cm">%  volume (v),</span>
<span class="cm">%   (1) v_SA_SA, second-order derivative with respect to Absolute Salinity</span>
<span class="cm">%       at constant CT &amp; p.</span>
<span class="cm">%   (2) v_SA_CT, second-order derivative with respect to SA &amp; CT at</span>
<span class="cm">%       constant p.</span>
<span class="cm">%   (3) v_CT_CT, second-order derivative with respect to CT at constant SA</span>
<span class="cm">%       and p.</span>
<span class="cm">%   (4) v_SA_P, second-order derivative with respect to SA &amp; P at</span>
<span class="cm">%       constant CT.</span>
<span class="cm">%   (5) v_CT_P, second-order derivative with respect to CT &amp; P at</span>
<span class="cm">%       constant SA.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the using the computationally-efficient</span>
<span class="cm">%  75-term expression for specific volume (Roquet et al., 2015).  There is</span>
<span class="cm">%  an alternative to calling this function, namely</span>
<span class="cm">%  gsw_specvol_second_derivatives_CT_exact(SA,CT,p) which uses the full</span>
<span class="cm">%  Gibbs function (IOC et al., 2010).</span>
<span class="cm">%</span>
<span class="cm">%  Note that the 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  v_SA_SA  =  The second derivative of specific volume with respect to</span>
<span class="cm">%              Absolute Salinity at constant CT &amp; p.  [ (m^3/kg)(g/kg)^-2 ]</span>
<span class="cm">%  v_SA_CT  =  The second derivative of specific volume with respect to</span>
<span class="cm">%              SA and CT at constant p.           [ (m^3/kg)(g/kg)^-1 K^-1]</span>
<span class="cm">%  v_CT_CT  =  The second derivative of specific volume with respect to</span>
<span class="cm">%              CT at constant SA and p.                  [ (m^3/kg) K^-2) ]</span>
<span class="cm">%  v_SA_P  =  The second derivative of specific volume with respect to</span>
<span class="cm">%              SA and P at constant CT.                  [ (m^3/kg) Pa^-1 ]</span>
<span class="cm">%  v_CT_P  =  The second derivative of specific volume with respect to</span>
<span class="cm">%              CT and P at constant SA.             [ (m^3/kg) K^-1 Pa^-1 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_specvol_second_derivatives</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                                  </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_sa_sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_sa_ct</span><span class="p">,</span>
<span class="w">                                                  </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_ct_ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_sa_p</span><span class="p">,</span>
<span class="w">                                                  </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_ct_p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">v_ct_ct_part</span><span class="p">,</span><span class="w"> </span><span class="n">v_ct_p_part</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_ct_part</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_p_part</span><span class="p">,</span>
<span class="w">             </span><span class="n">v_sa_sa_part</span><span class="p">,</span><span class="w"> </span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">xs2</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>

<span class="w">    </span><span class="n">xs2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span>
<span class="w">    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">xs2</span><span class="p">);</span>
<span class="w">    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="o">*</span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">*</span><span class="mf">1e-4</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_sa_sa_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b000</span>
<span class="w">                     </span><span class="o">+</span><span class="w"> </span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b200</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b300</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b400</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b500</span><span class="o">*</span><span class="n">xs</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b010</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b210</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b310</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b410</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b020</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b220</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b320</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b030</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b230</span><span class="o">*</span><span class="n">xs2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b040</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b050</span><span class="o">*</span><span class="n">ys</span><span class="p">))))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b001</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b201</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b301</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b401</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b011</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b211</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b311</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b021</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b221</span><span class="o">*</span><span class="n">xs2</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b031</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b041</span><span class="o">*</span><span class="n">ys</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b002</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs2</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b202</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b302</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b012</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b212</span><span class="o">*</span><span class="n">xs2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b022</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b032</span><span class="o">*</span><span class="n">ys</span><span class="p">))</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b003</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b013</span><span class="o">*</span><span class="n">ys</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b004</span><span class="o">*</span><span class="n">z</span><span class="p">))))</span><span class="o">/</span><span class="n">xs2</span><span class="p">;</span>

<span class="w">        </span><span class="o">*</span><span class="n">v_sa_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">v_sa_sa_part</span><span class="o">/</span><span class="n">xs</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_sa_ct_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b010</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b110</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b210</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b310</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b410</span><span class="o">*</span><span class="n">xs</span><span class="p">)))</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b020</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b120</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b220</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b320</span><span class="o">*</span><span class="n">xs</span><span class="p">)))</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b030</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b130</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b230</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b040</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b140</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b050</span><span class="o">*</span><span class="n">ys</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b011</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b111</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b211</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b311</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b021</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b121</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b221</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b031</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b131</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b041</span><span class="o">*</span><span class="n">ys</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b012</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b112</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b212</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b022</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b122</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b032</span><span class="o">*</span><span class="n">ys</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b013</span><span class="o">*</span><span class="n">z</span><span class="p">)))</span><span class="o">/</span><span class="n">xs</span><span class="p">;</span>

<span class="w">        </span><span class="o">*</span><span class="n">v_sa_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.025</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">v_sa_ct_part</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_ct_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_ct_ct_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a010</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a110</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a210</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a310</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a410</span><span class="o">*</span><span class="n">xs</span><span class="p">)))</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a020</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a120</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a220</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a320</span><span class="o">*</span><span class="n">xs</span><span class="p">)))</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a030</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a130</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a230</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a040</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a140</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a050</span><span class="o">*</span><span class="n">ys</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a011</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a111</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a211</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a311</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a021</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a121</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a221</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a031</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a131</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a041</span><span class="o">*</span><span class="n">ys</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a012</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a112</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a212</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a022</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a122</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a032</span><span class="o">*</span><span class="n">ys</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a013</span><span class="o">*</span><span class="n">z</span><span class="p">));</span>

<span class="w">        </span><span class="o">*</span><span class="n">v_ct_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.025</span><span class="o">*</span><span class="mf">0.025</span><span class="o">*</span><span class="n">v_ct_ct_part</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa_p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_sa_p_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b001</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b101</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b201</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b301</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b401</span><span class="o">*</span><span class="n">xs</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b011</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b111</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b211</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b311</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b021</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b121</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b221</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b031</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b131</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b041</span><span class="o">*</span><span class="n">ys</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b002</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b102</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b202</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b302</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b012</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b112</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b212</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b022</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b122</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b032</span><span class="o">*</span><span class="n">ys</span><span class="p">)))</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b003</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b103</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">b013</span><span class="o">*</span><span class="n">ys</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">b004</span><span class="o">*</span><span class="n">z</span><span class="p">));</span>

<span class="w">        </span><span class="o">*</span><span class="n">v_sa_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-8</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">v_sa_p_part</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_ct_p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_ct_p_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a001</span>
<span class="w">                           </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a101</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a201</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a301</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a401</span><span class="o">*</span><span class="n">xs</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a011</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a111</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a211</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a311</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a021</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a121</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a221</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a031</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a131</span><span class="o">*</span><span class="n">xs</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a041</span><span class="o">*</span><span class="n">ys</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a002</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a102</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a202</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a302</span><span class="o">*</span><span class="n">xs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a012</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a112</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a212</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a022</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a122</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a032</span><span class="o">*</span><span class="n">ys</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="p">(</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a003</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a103</span><span class="o">*</span><span class="n">xs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gsvco</span><span class="p">.</span><span class="n">a013</span><span class="o">*</span><span class="n">ys</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">gsvco</span><span class="p">.</span><span class="n">a004</span><span class="o">*</span><span class="n">z</span><span class="p">));</span>

<span class="w">        </span><span class="o">*</span><span class="n">v_ct_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-8</span><span class="o">*</span><span class="mf">0.025</span><span class="o">*</span><span class="n">v_ct_p_part</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_specvol_second_derivatives_wrt_enthalpy      second order derivatives</span>
<span class="cm">%                               of volume specific with respect to enthalpy</span>
<span class="cm">%                                                        (75-term equation)</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_specvol_second_derivatives_wrt_enthalpy(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following three first-order derivatives of specific</span>
<span class="cm">%  volume (v) with respect to enthalpy,</span>
<span class="cm">%   (1) v_SA_SA_wrt_h, second-order derivative with respect to Absolute Salinity</span>
<span class="cm">%       at constant h &amp; p.</span>
<span class="cm">%   (2) v_SA_h, second-order derivative with respect to SA &amp; h at</span>
<span class="cm">%       constant p.</span>
<span class="cm">%   (3) v_h_h, second-order derivative with respect to h at</span>
<span class="cm">%       constant SA &amp; p.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the using the computationally-efficient</span>
<span class="cm">%  75 term expression for specific volume (Roquet et al., 2015).  There is</span>
<span class="cm">%  an alternative to calling this function, namely</span>
<span class="cm">%  gsw_specvol_second_derivatives_wrt_enthalpy_CT_exact(SA,CT,p) which uses</span>
<span class="cm">%  the full Gibbs function (IOC et al., 2010).</span>
<span class="cm">%</span>
<span class="cm">%  This 75-term equation has been fitted in a restricted range of parameter</span>
<span class="cm">%  space, and is most accurate inside the &quot;oceanographic funnel&quot; described</span>
<span class="cm">%  in McDougall et al. (2010).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  v_SA_SA_wrt_h = The second-order derivative of specific volume with</span>
<span class="cm">%                  respect to Absolute Salinity at constant h &amp; p.</span>
<span class="cm">%                                           [ (m^3/kg)(g/kg)^-2 (J/kg)^-1 ]</span>
<span class="cm">%  v_SA_h  = The second-order derivative of specific volume with respect to</span>
<span class="cm">%            SA and h at constant p.        [ (m^3/kg)(g/kg)^-1 (J/kg)^-1 ]</span>
<span class="cm">%  v_h_h   = The second-order derivative with respect to h at</span>
<span class="cm">%            constant SA &amp; p.                         [ (m^3/kg)(J/kg)^-2 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_specvol_second_derivatives_wrt_enthalpy</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span>
<span class="w">                                                            </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                                              </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_sa_sa</span><span class="p">,</span>
<span class="w">                                                              </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_sa_h</span><span class="p">,</span>
<span class="w">                                                              </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_h_h</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">h_ct</span><span class="p">,</span><span class="w"> </span><span class="n">h_ct_ct</span><span class="p">,</span><span class="w"> </span><span class="n">h_sa</span><span class="p">,</span><span class="w"> </span><span class="n">h_sa_ct</span><span class="p">,</span><span class="w"> </span><span class="n">h_sa_sa</span><span class="p">,</span><span class="w"> </span><span class="n">rec_h_ct</span><span class="p">,</span><span class="w"> </span><span class="n">v_h_h_part</span><span class="p">,</span>
<span class="w">              </span><span class="n">rec_h_ct2</span><span class="p">,</span><span class="w"> </span><span class="n">v_ct</span><span class="p">,</span><span class="w"> </span><span class="n">vct_ct_ct</span><span class="p">,</span><span class="w"> </span><span class="n">vct_sa_ct</span><span class="p">,</span><span class="w"> </span><span class="n">vct_sa_sa</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_h_part</span><span class="p">;</span>

<span class="w">    </span><span class="n">gsw_specvol_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v_ct</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">v_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="n">gsw_enthalpy_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_sa</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_ct</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="n">gsw_enthalpy_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_ct</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="n">gsw_specvol_second_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">vct_sa_sa</span><span class="p">,</span><span class="o">&amp;</span><span class="n">vct_sa_ct</span><span class="p">,</span>
<span class="w">                                                 </span><span class="o">&amp;</span><span class="n">vct_ct_ct</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="n">gsw_specvol_second_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">vct_sa_ct</span><span class="p">,</span><span class="o">&amp;</span><span class="n">vct_ct_ct</span><span class="p">,</span>
<span class="w">                                                 </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="n">gsw_specvol_second_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">vct_ct_ct</span><span class="p">,</span>
<span class="w">                                                 </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="n">gsw_enthalpy_second_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_sa_sa</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_sa_ct</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_ct_ct</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="n">gsw_enthalpy_second_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_sa_ct</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_ct_ct</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="n">gsw_enthalpy_second_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">h_ct_ct</span><span class="p">);</span>

<span class="w">    </span><span class="n">rec_h_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="o">/</span><span class="n">h_ct</span><span class="p">;</span>
<span class="w">    </span><span class="n">rec_h_ct2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rec_h_ct</span><span class="o">*</span><span class="n">rec_h_ct</span><span class="p">;</span>

<span class="w">    </span><span class="n">v_h_h_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">vct_ct_ct</span><span class="o">*</span><span class="n">h_ct</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">h_ct_ct</span><span class="o">*</span><span class="n">v_ct</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">rec_h_ct2</span><span class="o">*</span><span class="n">rec_h_ct</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_h_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">v_h_h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_h_h_part</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">v_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_sa_h_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">vct_sa_ct</span><span class="o">*</span><span class="n">h_ct</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v_ct</span><span class="o">*</span><span class="n">h_sa_ct</span><span class="p">)</span><span class="o">*</span><span class="n">rec_h_ct2</span>
<span class="w">                          </span><span class="o">-</span><span class="w"> </span><span class="n">h_sa</span><span class="o">*</span><span class="n">v_h_h_part</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">v_sa_h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_sa_h_part</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">            </span><span class="o">*</span><span class="n">v_sa_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vct_sa_sa</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">h_ct</span><span class="o">*</span><span class="p">(</span><span class="n">vct_sa_ct</span><span class="o">*</span><span class="n">h_sa</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="n">v_ct</span><span class="o">*</span><span class="n">h_sa_sa</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_ct</span><span class="o">*</span><span class="n">h_sa</span><span class="o">*</span><span class="n">h_sa_ct</span><span class="p">)</span><span class="o">*</span><span class="n">rec_h_ct2</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="n">h_sa</span><span class="o">*</span><span class="n">v_sa_h_part</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_Turner_Rsubrho              Turner angle &amp; Rsubrho (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_Turner_Rsubrho(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the Turner angle and the Rsubrho as a function of pressure</span>
<span class="cm">%  down a vertical water column.  These quantities express the relative</span>
<span class="cm">%  contributions of the vertical gradients of Conservative Temperature</span>
<span class="cm">%  and Absolute Salinity to the vertical stability (the square of the</span>
<span class="cm">%  Brunt-Vaisala Frequency squared, N^2).  Tu and Rsubrho are evaluated at</span>
<span class="cm">%  the mid pressure between the individual data points in the vertical.</span>
<span class="cm">%  This function uses computationally-efficient 75-term expression for</span>
<span class="cm">%  specific volume in terms of SA, CT and p (Roquet et al., 2015).  Note</span>
<span class="cm">%  that in the double-diffusive literature, papers concerned with the</span>
<span class="cm">%  &quot;diffusive&quot; form of double-diffusive convection often define the</span>
<span class="cm">%  stability ratio as the reciprocal of what is defined here as the</span>
<span class="cm">%  stability ratio.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  Tu       =  Turner angle, on the same (M-1)xN grid as p_mid.</span>
<span class="cm">%              Turner angle has units of:           [ degrees of rotation ]</span>
<span class="cm">%  Rsubrho  =  Stability Ratio, on the same (M-1)xN grid as p_mid.</span>
<span class="cm">%              Rsubrho is dimensionless.                       [ unitless ]</span>
<span class="cm">%  p_mid    =  mid pressure between the indivual points of the p grid.</span>
<span class="cm">%              That is, p_mid is on a (M-1)xN grid in the vertical.</span>
<span class="cm">%              p_mid has units of:                                 [ dbar ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall &amp; Paul Barker                      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqns. (3.15.1) and (3.16.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%   The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_turner_rsubrho</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">nz</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">tu</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">rsubrho</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">p_mid</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">dsa</span><span class="p">,</span><span class="w"> </span><span class="n">sa_mid</span><span class="p">,</span><span class="w"> </span><span class="n">dct</span><span class="p">,</span><span class="w"> </span><span class="n">ct_mid</span><span class="p">,</span><span class="w"> </span><span class="n">alpha_mid</span><span class="p">,</span><span class="w"> </span><span class="n">beta_mid</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nz</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nz</span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">dsa</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sa</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">        </span><span class="n">sa_mid</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5e0</span><span class="o">*</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sa</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">        </span><span class="n">dct</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ct</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ct</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">        </span><span class="n">ct_mid</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5e0</span><span class="o">*</span><span class="p">(</span><span class="n">ct</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ct</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">        </span><span class="n">p_mid</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5e0</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>

<span class="w">        </span><span class="n">gsw_specvol_alpha_beta</span><span class="p">(</span><span class="n">sa_mid</span><span class="p">,</span><span class="n">ct_mid</span><span class="p">,</span><span class="n">p_mid</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">alpha_mid</span><span class="p">,</span>
<span class="w">                                      </span><span class="o">&amp;</span><span class="n">beta_mid</span><span class="p">);</span>

<span class="w">        </span><span class="n">tu</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">rad2deg</span><span class="o">*</span><span class="n">atan2</span><span class="p">((</span><span class="n">alpha_mid</span><span class="o">*</span><span class="n">dct</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">beta_mid</span><span class="o">*</span><span class="n">dsa</span><span class="p">),</span>
<span class="w">                                          </span><span class="p">(</span><span class="n">alpha_mid</span><span class="o">*</span><span class="n">dct</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">beta_mid</span><span class="o">*</span><span class="n">dsa</span><span class="p">));</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dsa</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span>
<span class="w">            </span><span class="n">rsubrho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cppGSW_INVALID_VALUE</span><span class="p">;</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">rsubrho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">alpha_mid</span><span class="o">*</span><span class="n">dct</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">beta_mid</span><span class="o">*</span><span class="n">dsa</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_ntp_pt_vs_CT_ratio                    ratio of gradients of potential</span>
<span class="cm">%                             temperature and Conservative Temperature in a</span>
<span class="cm">%                            neutral tangent plane (in a locally-referenced</span>
<span class="cm">%                              potential density surface)(75-term equation)</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_ntp_pt_vs_CT_ratio(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the ratio of the two-dimensional gradient of potential</span>
<span class="cm">%  temperature versus that of Conservative Temperature, CT, along the</span>
<span class="cm">%  neutral tangent plane.  The potential temperature is the regular one</span>
<span class="cm">%  which has a reference sea pressure of 0 dbar.  Part of the calculation</span>
<span class="cm">%  uses the computationally-efficient 75-term expression for specific</span>
<span class="cm">%  volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one|s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  ntp_pt_vs_CT_ratio  =  The ratio of the spatial gradient of</span>
<span class="cm">%                         potential temperature versus that of</span>
<span class="cm">%                         Conservative Temperature in the</span>
<span class="cm">%                         neutral tangent plane (ntp).         [ unitless ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%    See Eqn. (A.14.5) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling, 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_ntp_pt_vs_CT_ratio</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">pt_SA</span><span class="p">,</span><span class="w"> </span><span class="n">pt_CT</span><span class="p">;</span>

<span class="w">   </span><span class="n">gsw_specvol_alpha_beta</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="n">CT</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">beta</span><span class="p">);</span>

<span class="w">   </span><span class="n">gsw_pt_first_derivatives</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pt_SA</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pt_CT</span><span class="p">);</span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">pt_CT</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pt_SA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">beta</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_rho_alpha_beta_CT_exact            in-situ density, thermal expansion</span>
<span class="cm">%                                  &amp; saline contraction coefficient from CT</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_rho_alpha_beta_CT_exact(SA,CT,p,</span>
<span class="cm">                                       *rho_CT_exact,</span>
<span class="cm">                                       *alpha_CT_exact,</span>
<span class="cm">                                       *beta_CT_exact)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates in-situ density, the appropiate thermal expansion coefficient</span>
<span class="cm">%  and the appropriate saline contraction coefficient of seawater from</span>
<span class="cm">%  Absolute Salinity and Conservative Temperature.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely</span>
<span class="cm">%  gsw_rho_alpha_beta(SA,CT,p), which uses the computationally-efficient</span>
<span class="cm">%  75-term expression for density in terms of SA, CT and p (Roquet et al.,</span>
<span class="cm">%  2015)</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%          ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  rho_CT_exact    =  in-situ density                            [ kg/m^3 ]</span>
<span class="cm">%  alpha_CT_exact  =  thermal expansion coefficient                 [ 1/K ]</span>
<span class="cm">%                     with respect to Conservative Temperature</span>
<span class="cm">%  beta_CT_exact   =  saline contraction coefficient               [ kg/g ]</span>
<span class="cm">%                     at constant Conservative Temperature</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%     See sections (2.8), (2.18) and (2.19) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">% The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_rho_alpha_beta_ct_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                            </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rho_CT_exact</span><span class="p">,</span>
<span class="w">                                            </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">alpha_CT_exact</span><span class="p">,</span>
<span class="w">                                            </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">beta_CT_exact</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_t_from_ct</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>

<span class="w">    </span><span class="n">rho_CT_exact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">alpha_CT_exact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_alpha_wrt_CT_t_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">beta_CT_exact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_beta_const_ct_t_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_thermobaric_CT_exact                          thermobaric coefficient</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_thermobaric_CT_exact(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the thermobaric coefficient of seawater with respect to</span>
<span class="cm">%  Conservative Temperature.  This routine calculates the thermobaric</span>
<span class="cm">%  coefficient with the full TEOS-10 Gibbs function expression for density.</span>
<span class="cm">%  This function uses finite differences to calculate the temperature and</span>
<span class="cm">%  pressure derivatives.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely gsw_thermobaric(SA,CT,p)</span>
<span class="cm">%  which uses the computationally efficient 75-term expression for specific</span>
<span class="cm">%  volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  thermobaric_CT_exact  =  thermobaric coefficient with       [ 1/(K Pa) ]</span>
<span class="cm">%                           respect to Conservative Temperature.</span>
<span class="cm">%  Note. The pressure derivative is taken with respect to</span>
<span class="cm">%    pressure in Pa not dbar.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqns. (3.8.2) and (P.2) of this TEOS-10 manual.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_thermobaric_ct_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">v_SA_P</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT_P</span><span class="p">,</span><span class="w"> </span><span class="n">v_SA</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT</span><span class="p">,</span><span class="w"> </span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="n">dummy1</span><span class="p">,</span><span class="w"> </span><span class="n">dummy2</span><span class="p">,</span><span class="w"> </span><span class="n">dummy3</span><span class="p">,</span><span class="w"> </span><span class="n">rho</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SA</span><span class="p">;</span>

<span class="w">    </span><span class="n">rho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_rho_ct_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>

<span class="w">    </span><span class="n">gsw_specvol_first_derivatives_CT_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">v_SA</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT</span><span class="p">,</span><span class="w"> </span><span class="n">dummy</span><span class="p">);</span>

<span class="w">    </span><span class="n">gsw_specvol_second_derivatives_CT_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">dummy1</span><span class="p">,</span>
<span class="w">                                              </span><span class="n">dummy2</span><span class="p">,</span><span class="w"> </span><span class="n">dummy3</span><span class="p">,</span><span class="w"> </span><span class="n">v_SA_P</span><span class="p">,</span>
<span class="w">                                              </span><span class="n">v_CT_P</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">v_CT_P</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">v_CT</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">v_SA</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_SA_P</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_internal_energy_second_derivatives              second derivatives of</span>
<span class="cm">%                                       specific interal energy of seawater</span>
<span class="cm">%                                                        (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_internal_energy_second_derivatives(SA,CT,p,</span>
<span class="cm">                                                &amp;u_SA_SA,</span>
<span class="cm">                                                &amp;u_SA_CT,</span>
<span class="cm">                                                &amp;u_CT_CT,</span>
<span class="cm">                                                &amp;u_SA_P,</span>
<span class="cm">                                                &amp;u_CT_P)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following five second-order derivatives of</span>
<span class="cm">%  internal energy,</span>
<span class="cm">%  (1) u_SA_SA, second order derivative with respect to Absolute Salinity</span>
<span class="cm">%      at constant CT &amp; p.</span>
<span class="cm">%  (2) u_SA_CT, second order derivative with respect to SA &amp; CT at</span>
<span class="cm">%      constant p.</span>
<span class="cm">%  (3) u_CT_CT, second order derivative with respect to CT at constant</span>
<span class="cm">%      SA &amp; p.</span>
<span class="cm">%  (4) u_SA_P, second-order derivative with respect to SA &amp; P at</span>
<span class="cm">%      constant CT.</span>
<span class="cm">%  (5) u_CT_P, second-order derivative with respect to CT &amp; P at</span>
<span class="cm">%      constant SA.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the using the computationally-efficient</span>
<span class="cm">%  75-term expression for specific volume (Roquet et al., 2015).  There is</span>
<span class="cm">%  an alternative to calling this function, namely</span>
<span class="cm">%  gsw_internal_energy_second_derivatives_CT_exact(SA,CT,p) which uses the</span>
<span class="cm">%  full Gibbs function (IOC et al., 2010).</span>
<span class="cm">%</span>
<span class="cm">%  Note that the 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one|s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature                                [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  u_SA_SA =  The second derivative of internal energy with respect to</span>
<span class="cm">%             Absolute Salinity at constant CT &amp; p.     [ (J/kg)(g/kg)^-2 ]</span>
<span class="cm">%  u_SA_CT =  The second derivative of internal energy with respect to</span>
<span class="cm">%             SA &amp; CT at constant p.                [ (J/kg)(g/kg)^-1 K^-1]</span>
<span class="cm">%  u_CT_CT =  The second derivative of internal energy with respect to</span>
<span class="cm">%             CT at constant SA and p.                      [ (J/kg) K^-2 ]</span>
<span class="cm">%  u_SA_P  =  The second derivative of internal energy with respect to</span>
<span class="cm">%             SA &amp; P at constant CT.              [ (J/kg)(g/kg)^-1 Pa^-1 ]</span>
<span class="cm">%  u_CT_P  =  The second derivative of internal energy with respect to</span>
<span class="cm">%             CT &amp; P at constant SA.                  [ (J/kg) K^-1 Pa^-1 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_internal_energy_second_derivatives</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span>
<span class="w">                                                      </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                                        </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_SA_SA</span><span class="p">,</span>
<span class="w">                                                        </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_SA_CT</span><span class="p">,</span>
<span class="w">                                                        </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_CT_CT</span><span class="p">,</span>
<span class="w">                                                        </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_SA_P</span><span class="p">,</span>
<span class="w">                                                        </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_CT_P</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">h_SA_SA</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">h_SA_CT</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">h_CT_CT</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_SA_SA</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">v_SA_CT</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">v_CT_CT</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">v_SA_P</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">v_CT_P</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SA</span><span class="p">;</span>

<span class="w">    </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">db2pa</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_p0</span><span class="p">);</span>

<span class="w">    </span><span class="n">gsw_enthalpy_second_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">CT</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">h_SA_SA</span><span class="p">,</span><span class="w"> </span><span class="n">h_SA_CT</span><span class="p">,</span><span class="w"> </span><span class="n">h_CT_CT</span><span class="p">);</span>
<span class="w">    </span><span class="n">gsw_specvol_second_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">CT</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">v_SA_SA</span><span class="p">,</span><span class="w"> </span><span class="n">v_SA_CT</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT_CT</span><span class="p">,</span><span class="w"> </span><span class="n">v_SA_P</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT_P</span><span class="p">);</span>

<span class="w">    </span><span class="n">u_SA_SA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">h_SA_SA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="n">v_SA_SA</span><span class="p">;</span>

<span class="w">    </span><span class="n">u_SA_CT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">h_SA_CT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="n">v_SA_CT</span><span class="p">;</span>

<span class="w">    </span><span class="n">u_CT_CT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">h_CT_CT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="n">v_CT_CT</span><span class="p">;</span>

<span class="w">    </span><span class="n">u_SA_P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="n">v_SA_P</span><span class="p">;</span>

<span class="w">    </span><span class="n">u_CT_P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="n">v_CT_P</span><span class="p">;</span>

<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">h_SA_SA</span><span class="p">;</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">h_SA_CT</span><span class="p">;</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">h_CT_CT</span><span class="p">;</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">v_SA_SA</span><span class="p">;</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">v_SA_CT</span><span class="p">;</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">v_CT_CT</span><span class="p">;</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">v_SA_P</span><span class="p">;</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">v_CT_P</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sound_speed_ct_exact                                      sound speed</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_sound_speed_ct_exact(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the speed of sound in seawater from Absolute Salinity and</span>
<span class="cm">%  Conservative Temperature and pressure.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely gsw_sound_speed(SA,CT,p)</span>
<span class="cm">%  which uses the computationally efficient 75-term expression for specific</span>
<span class="cm">%  volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sound_speed_CT_exact  =  speed of sound in seawater              [ m/s ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  David Jackett, Paul Barker and Trevor McDougall     [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (2.17.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sound_speed_ct_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_t_from_ct</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="n">CT</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">gsw_sound_speed_t_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_internal_energy_first_derivatives_CT_exact       first derivatives of</span>
<span class="cm">%                                       specific interal energy of seawater</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_internal_energy_first_derivatives_CT_exact(SA,CT,p,</span>
<span class="cm">                                                         &amp;u_SA,</span>
<span class="cm">                                                         &amp;u_CT,</span>
<span class="cm">                                                         &amp;u_P)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the first order derivates of specific internal energy of</span>
<span class="cm">%  seawater.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely</span>
<span class="cm">%  gsw_internal_energy_first_derivatives(SA,CT,p), which uses the</span>
<span class="cm">%  computationally efficient polynomial for specific volume in terms of</span>
<span class="cm">%  SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature                                [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  u_SA = The first derivative of internal energy with respect to</span>
<span class="cm">%           Absolute Salinity at constant CT &amp; p.</span>
<span class="cm">%                                          [ (J/kg)(g/kg)^-1 ] i.e. [ J/g ]</span>
<span class="cm">%  u_CT = The first derivative of internal energy with respect to</span>
<span class="cm">%           Conservative Temperature at constant SA &amp; p.    [ (J/kg) K^-1 ]</span>
<span class="cm">%  u_P = The first derivative of internal energy with respect to</span>
<span class="cm">%           pressure at constant SA &amp; CT.                  [ (J/kg) Pa^-1 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_internal_energy_first_derivatives_ct_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_SA</span><span class="p">,</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_CT</span><span class="p">,</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_P</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">v_SA</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT</span><span class="p">,</span><span class="w"> </span><span class="n">v_P</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">h_SA</span><span class="p">,</span><span class="w"> </span><span class="n">h_CT</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SA</span><span class="p">;</span>

<span class="w">    </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">db2pa</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_p0</span><span class="p">;</span>

<span class="w">    </span><span class="n">gsw_enthalpy_first_derivatives_ct_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">h_SA</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">h_CT</span><span class="p">);</span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_specvol_CT_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">CT</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">gsw_specvol_first_derivatives_CT_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">v_SA</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT</span><span class="p">,</span><span class="w"> </span><span class="n">v_P</span><span class="p">);</span>

<span class="w">    </span><span class="n">u_SA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h_SA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_SA</span><span class="p">;</span>

<span class="w">    </span><span class="n">u_CT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h_CT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_CT</span><span class="p">;</span>

<span class="w">    </span><span class="n">u_P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_P</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_t_from_entropy                                    in-situ temperature</span>
<span class="cm">%                                                  as a function of entropy</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_t_from_entropy(SA,entropy,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates in-situ temperature with entropy as an input variable.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA       =  Absolute Salinity                                   [ g/kg ]</span>
<span class="cm">%  entropy  =  specific entropy                                [ J/(kg*K) ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  t   =  in-situ temperature (ITS-90)                            [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See appendix  A.10 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_t_from_entropy</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">entropy</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">p0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_pt_from_entropy</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="n">entropy</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">gsw_pt_from_t</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">pt</span><span class="p">,</span><span class="w"> </span><span class="n">p0</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">% gsw_sigma0_pt0_exact                           potential density anomaly,</span>
<span class="cm">%                                 being potential density minus 1000 kg/m^3</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_sigma0_pt0_exact(SA,pt0)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density anomaly with reference sea pressure of</span>
<span class="cm">%  zero (0) dbar.  The temperature input to this function is potential</span>
<span class="cm">%  temperature referenced to zero dbar.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA   =  Absolute Salinity                                       [ g/kg ]</span>
<span class="cm">%  pt0  =  potential temperature with respect to a</span>
<span class="cm">%          reference sea pressure of 0 dbar (ITS-90)              [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sigma0_pt0_exact  =  potential density anomaly with           [ kg/m^3 ]</span>
<span class="cm">%                       respect to a reference pressure of 0 dbar,</span>
<span class="cm">%                       that is, potential density minus 1000 kg/m^3.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall &amp; Paul Barker                      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (3.6.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sigma0_pt0_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pt0</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SA</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">pt0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_CT_from_rho_exact               Conservative Temperature from density</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_CT_from_rho_exact(rho,SA,p, *CT, *CT_multiple)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the Conservative Temperature of a seawater sample, for given</span>
<span class="cm">%  values of its density, Absolute Salinity and sea pressure (in dbar).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely gsw_CT_from_rho(rho,SA,p),</span>
<span class="cm">%  which uses the computationally efficient 75-term expression for specific</span>
<span class="cm">%  volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  rho  =  density of a seawater sample (e.g. 1026 kg/m^3)       [ kg/m^3 ]</span>
<span class="cm">%   Note. This input has not had 1000 kg/m^3 subtracted from it.</span>
<span class="cm">%     That is, it is |density|, not |density anomaly|.</span>
<span class="cm">%  SA   =  Absolute Salinity                                       [ g/kg ]</span>
<span class="cm">%  p    =  sea pressure                                            [ dbar ]</span>
<span class="cm">%          ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  CT  =  Conservative Temperature                                [ deg C ]</span>
<span class="cm">%  CT_multiple  =  Conservative Temperature                       [ deg C ]</span>
<span class="cm">%    Note that at low salinities, in brackish water, there are two possible</span>
<span class="cm">%      temperatures for a single density.  This programme will output both</span>
<span class="cm">%      valid solutions.  To see this second solution the user must call the</span>
<span class="cm">%      programme with two outputs (i.e. [CT,CT_multiple]), if there is only</span>
<span class="cm">%      one possible solution and the programme has been called with two</span>
<span class="cm">%      outputs the second variable will be set to NaN.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall &amp; Paul Barker                      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_ct_from_rho_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">rho</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                                     </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">CT</span><span class="p">,</span>
<span class="w">                                                     </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">CT_multiple</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t_multiple</span><span class="p">;</span>

<span class="w">    </span><span class="n">gsw_t_from_rho_exact</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t_multiple</span><span class="p">);</span>

<span class="w">    </span><span class="n">CT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_ct_from_t</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">CT_multiple</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_ct_from_t</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">t_multiple</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_cabbeling_CT_exact                              cabbeling coefficient</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_cabbeling_CT_exact(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the cabbeling coefficient of seawater with respect to</span>
<span class="cm">%  Conservative Temperature.  This routine calculates the cabbeling</span>
<span class="cm">%  coefficient with the full TEOS-10 Gibbs function expression for specific</span>
<span class="cm">%  volume.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely gsw_cabbeling(SA,CT,p)</span>
<span class="cm">%  which uses the computationally efficient 75-term expression for specific</span>
<span class="cm">%  volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  cabbeling  =  cabbeling coefficient with respect to            [ 1/K^2 ]</span>
<span class="cm">%                Conservative Temperature.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqns. (3.9.2) and (P.4) of this TEOS-10 manual.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_cabbeling_ct_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">v_SA</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT</span><span class="p">,</span><span class="w"> </span><span class="n">dummy1</span><span class="p">,</span><span class="w"> </span><span class="n">rho</span><span class="p">,</span><span class="w"> </span><span class="n">alpha_CT</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">v_SA_SA</span><span class="p">,</span><span class="w"> </span><span class="n">v_SA_CT</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT_CT</span><span class="p">,</span><span class="w"> </span><span class="n">dummy2</span><span class="p">,</span><span class="w"> </span><span class="n">dummy3</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">alpha_SA</span><span class="p">,</span><span class="w"> </span><span class="n">beta_SA</span><span class="p">,</span><span class="w"> </span><span class="n">alpha_on_beta</span><span class="p">;</span>

<span class="w">    </span><span class="n">gsw_specvol_first_derivatives_CT_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="n">CT</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">v_SA</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT</span><span class="p">,</span><span class="w"> </span><span class="n">dummy1</span><span class="p">);</span>

<span class="w">    </span><span class="n">gsw_specvol_second_derivatives_CT_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="n">CT</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">v_SA_SA</span><span class="p">,</span><span class="w"> </span><span class="n">v_SA_CT</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT_CT</span><span class="p">,</span><span class="w"> </span><span class="n">dummy2</span><span class="p">,</span><span class="w"> </span><span class="n">dummy3</span><span class="p">);</span>

<span class="w">    </span><span class="n">rho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_rho_ct_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="n">CT</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>

<span class="w">    </span><span class="n">alpha_CT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">v_CT_CT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">v_CT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_CT</span><span class="p">));</span>

<span class="w">    </span><span class="n">alpha_SA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">v_SA_CT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_SA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_CT</span><span class="p">);</span>

<span class="w">    </span><span class="n">beta_SA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">v_SA_SA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">v_SA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_SA</span><span class="p">));</span>

<span class="w">    </span><span class="n">alpha_on_beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_alpha_on_beta_CT_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="n">CT</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">alpha_CT</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">alpha_on_beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">alpha_SA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha_on_beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">beta_SA</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sigma3_CT_exact                        potential density anomaly with</span>
<span class="cm">%                                       reference sea pressure of 3000 dbar</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_sigma3_CT_exact(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density anomaly with reference pressure of 3000</span>
<span class="cm">%  dbar, this being this particular potential density minus 1000 kg/m^3.</span>
<span class="cm">%  This function has inputs of Absolute Salinity and Conservative</span>
<span class="cm">%  Temperature.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely gsw_sigma3(SA,CT,p),</span>
<span class="cm">%  which uses the computationally efficient 75-term expression for specific</span>
<span class="cm">%  volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sigma3_CT_exact  =  potential density anomaly with            [ kg/m^3 ]</span>
<span class="cm">%                      respect to a reference pressure of 3000 dbar,</span>
<span class="cm">%                      that is, this potential density - 1000 kg m^-3.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall &amp; Paul Barker                      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (A.30.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sigma3_ct_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_t_from_ct</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="mf">3000.0</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="mf">3000.0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_rho_CT_exact                                          in-situ density</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_rho_CT_exact(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates in-situ density from Absolute Salinity and Conservative</span>
<span class="cm">%  Temperature.</span>
<span class="cm">%</span>
<span class="cm">%  Note that potential density with respect to reference pressure, p_ref,</span>
<span class="cm">%  is obtained by calling this function with the pressure argument being</span>
<span class="cm">%  p_ref (i.e. &quot;gsw_rho_CT_exact(SA,CT,p_ref)&quot;).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely gsw_rho(SA,CT,p),</span>
<span class="cm">%  which uses the computationally efficient 75-term expression for density</span>
<span class="cm">%  in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature                                [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  rho_CT_exact  =  in-situ density                              [ kg/m^3 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (2.8.2) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">% The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_rho_ct_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_t_from_ct</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_isopycnal_slope_ratio               ratio of the slopes of isopycnals</span>
<span class="cm">%                                      on the SA-CT diagram for p and p_ref</span>
<span class="cm">%                                                        (75-term equation)</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_isopycnal_slope_ratio(SA,CT,p,p_ref)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the ratio of alpha/beta at pressure, p, to that at reference</span>
<span class="cm">%  pressure, p_ref.  This function uses the computationally-efficient</span>
<span class="cm">%  75-term expression for specific volume in terms of SA, CT and p</span>
<span class="cm">%  (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one|s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%  pr  =  reference pressure                                       [ dbar ]</span>
<span class="cm">%         ( i.e. absolute reference pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  isopycnal_slope_ratio</span>
<span class="cm">%               =  The ratio of alpha/beta evaluated at        [ unitless ]</span>
<span class="cm">%                  pressure, p, to that at reference pressure, p_ref.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall, Paul Barker &amp; David Jackett       [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%    See Eqn. (3.17.2) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_isopycnal_slope_ratio</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">p_ref</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">dummy1</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">alpha</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">beta</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">;</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">dummy2</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">alpha_pref</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">beta_pref</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">;</span>

<span class="w">   </span><span class="n">gsw_specvol_alpha_beta</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">dummy1</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="p">);</span>
<span class="w">   </span><span class="n">gsw_specvol_alpha_beta</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p_ref</span><span class="p">,</span><span class="w"> </span><span class="n">dummy2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha_pref</span><span class="p">,</span><span class="w"> </span><span class="n">beta_pref</span><span class="p">);</span>

<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">beta_pref</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">alpha_pref</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">beta</span><span class="p">;</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">slope_ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">v3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v4</span><span class="p">;</span>

<span class="w">   </span><span class="k">delete</span><span class="w"> </span><span class="n">dummy1</span><span class="p">;</span>
<span class="w">   </span><span class="k">delete</span><span class="w"> </span><span class="n">alpha</span><span class="p">;</span>
<span class="w">   </span><span class="k">delete</span><span class="w"> </span><span class="n">beta</span><span class="p">;</span>
<span class="w">   </span><span class="k">delete</span><span class="w"> </span><span class="n">dummy2</span><span class="p">;</span>
<span class="w">   </span><span class="k">delete</span><span class="w"> </span><span class="n">alpha_pref</span><span class="p">;</span>
<span class="w">   </span><span class="k">delete</span><span class="w"> </span><span class="n">beta_pref</span><span class="p">;</span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">slope_ratio</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">% gsw_spiciness0                                    spiciness at p = 0 dbar</span>
<span class="cm">%                                                        (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_spiciness0(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates spiciness from Absolute Salinity and Conservative</span>
<span class="cm">%  Temperature at a pressure of 0 dbar, as described by McDougall and</span>
<span class="cm">%  Krzysik (2015).  This routine is based on the computationally-efficient</span>
<span class="cm">%  expression for specific volume in terms of SA, CT and p (Roquet et al.,</span>
<span class="cm">%  2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  spiciness0  =  spiciness referenced to a pressure of 0 dbar,</span>
<span class="cm">%                 i.e. the surface                               [ kg/m^3 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Oliver Krzysik and Trevor McDougall                 [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., and O.A. Krzysik, 2015: Spiciness. Journal of Marine</span>
<span class="cm">%   Research, 73, 141-152.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_spiciness0</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">spiciness0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w">  </span><span class="n">s01</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.22982898371678e1</span><span class="p">,</span><span class="w">      </span><span class="n">s02</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.35727873628866e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s03</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.87353650994010e1</span><span class="p">,</span><span class="w">      </span><span class="n">s04</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.61360047373455e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s05</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.76112762286425e1</span><span class="p">,</span><span class="w">      </span><span class="n">s06</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.27086671461257e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s07</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.00820111041594e1</span><span class="p">,</span><span class="w">      </span><span class="n">s08</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.87969717584045e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s09</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.13747111959674e1</span><span class="p">,</span><span class="w">      </span><span class="n">s10</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">6.07377192990680e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.37514033570187e1</span><span class="p">,</span><span class="w">      </span><span class="n">s12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.51171878953574e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s13</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.63310989721504e2</span><span class="p">,</span><span class="w">      </span><span class="n">s14</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-8.83222751638095e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-6.41725302237048e2</span><span class="p">,</span><span class="w">      </span><span class="n">s16</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.79732530789261e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.49466901993728e2</span><span class="p">,</span><span class="w">      </span><span class="n">s18</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.26691295035416e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s19</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.66389243708181e1</span><span class="p">,</span><span class="w">      </span><span class="n">s20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.93170905757579e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s21</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.76053907144524e2</span><span class="p">,</span><span class="w">      </span><span class="n">s22</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">8.27634318120224e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.02156220126926e1</span><span class="p">,</span><span class="w">      </span><span class="n">s24</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.82973336590803e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s25</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-5.06206828083959e2</span><span class="p">,</span><span class="w">      </span><span class="n">s26</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">6.69626565169529e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s27</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.02851235050766e2</span><span class="p">,</span><span class="w">      </span><span class="n">s28</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.96345285604621e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s29</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-5.74040806713526e2</span><span class="p">,</span><span class="w">      </span><span class="n">s30</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">7.03285905478333e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.97870298879716e2</span><span class="p">,</span><span class="w">      </span><span class="n">s32</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.88340373735118e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-8.29188936089122e1</span><span class="p">,</span><span class="w">      </span><span class="n">s34</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.87602137195354e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s35</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.27096944425793e2</span><span class="p">,</span><span class="w">      </span><span class="n">s36</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.11671167892147e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s37</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.15140919876285e1</span><span class="p">,</span><span class="w">      </span><span class="n">s38</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.16458864953602e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s39</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.50029730802344e2</span><span class="p">,</span><span class="w">      </span><span class="n">s40</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.76293848660589e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s41</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">6.47247424373200e1</span><span class="p">,</span><span class="w">      </span><span class="n">s42</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.47159994408867e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.23533339449055e1</span><span class="p">,</span><span class="w">      </span><span class="n">s44</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">5.30648562097667</span><span class="p">,</span>
<span class="w">              </span><span class="n">s45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.82051249177948e1</span><span class="p">,</span><span class="w">      </span><span class="n">s46</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.33184351090495e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s47</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-6.22909903460368</span><span class="p">,</span><span class="w">        </span><span class="n">s48</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.55975464301446</span><span class="p">,</span>
<span class="w">              </span><span class="n">s49</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">6.61877073960113</span><span class="p">;</span>

<span class="w">    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
<span class="w">    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="o">*</span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">    </span><span class="n">spiciness0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s01</span>
<span class="w">                  </span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s02</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s03</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s04</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s05</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s06</span><span class="o">+</span><span class="n">s07</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                       </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s08</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s09</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s10</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s11</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s12</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s13</span><span class="o">+</span><span class="n">s14</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s15</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s16</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s17</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s18</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s19</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s20</span><span class="o">+</span><span class="n">s21</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s22</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s23</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s24</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s25</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s26</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s27</span><span class="o">+</span><span class="n">s28</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s29</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s30</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s31</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s32</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s33</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s34</span><span class="o">+</span><span class="n">s35</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s36</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s37</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s38</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s39</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s40</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s41</span><span class="o">+</span><span class="n">s42</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s43</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s44</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s45</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s46</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s47</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s48</span><span class="o">+</span><span class="n">s49</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))))))));</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">spiciness0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_spiciness1                                 spiciness at p = 1000 dbar</span>
<span class="cm">%                                                        (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_spiciness1(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates spiciness from Absolute Salinity and Conservative</span>
<span class="cm">%  Temperature at a pressure of 1000 dbar, as described by McDougall and</span>
<span class="cm">%  Krzysik (2015).  This routine is based on the computationally-efficient</span>
<span class="cm">%  expression for specific volume in terms of SA, CT and p (Roquet et al.,</span>
<span class="cm">%  2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  spiciness1  =  spiciness referenced to a pressure of 1000 dbar</span>
<span class="cm">%                                                                [ kg/m^3 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Oliver Krzysik and Trevor McDougall                 [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., and O.A. Krzysik, 2015: Spiciness. Journal of Marine</span>
<span class="cm">%   Research, 73, 141-152.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_spiciness1</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">spiciness1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w">  </span><span class="n">s01</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.19874584868912e1</span><span class="p">,</span><span class="w">      </span><span class="n">s02</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.33517268529408e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s03</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.18352211648107e1</span><span class="p">,</span><span class="w">      </span><span class="n">s04</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.01491744114173e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s05</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.70004204355132e1</span><span class="p">,</span><span class="w">      </span><span class="n">s06</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.78831543226261e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s07</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.76337834294554e1</span><span class="p">,</span><span class="w">      </span><span class="n">s08</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.87838842773396e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s09</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.14531420554522e1</span><span class="p">,</span><span class="w">      </span><span class="n">s10</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.14679705198796e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.04398864750692e1</span><span class="p">,</span><span class="w">      </span><span class="n">s12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.70796428950487e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s13</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.36783833820955e2</span><span class="p">,</span><span class="w">      </span><span class="n">s14</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.36834317044850e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-6.41753415180701e2</span><span class="p">,</span><span class="w">      </span><span class="n">s16</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.33701981685590</span><span class="p">,</span>
<span class="w">              </span><span class="n">s17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.75289327948412e2</span><span class="p">,</span><span class="w">      </span><span class="n">s18</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.42666160657536e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s19</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.17062400799114e1</span><span class="p">,</span><span class="w">      </span><span class="n">s20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.28131490440865e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s21</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.39564245068468e2</span><span class="p">,</span><span class="w">      </span><span class="n">s22</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">8.27747934506435e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.50901590694775e1</span><span class="p">,</span><span class="w">      </span><span class="n">s24</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.87473907262029e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s25</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.00227341144928e2</span><span class="p">,</span><span class="w">      </span><span class="n">s26</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">6.48307189919433e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s27</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.16433334701578e2</span><span class="p">,</span><span class="w">      </span><span class="n">s28</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.48273032774305e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s29</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-5.74545648799754e2</span><span class="p">,</span><span class="w">      </span><span class="n">s30</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">4.50446431127421e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.30714981343772e2</span><span class="p">,</span><span class="w">      </span><span class="n">s32</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.15958389253065e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-8.60635313930106e1</span><span class="p">,</span><span class="w">      </span><span class="n">s34</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.22978455069097e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s35</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">9.18287282626261e1</span><span class="p">,</span><span class="w">      </span><span class="n">s36</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.12120473062203e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s37</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.21528216973820e1</span><span class="p">,</span><span class="w">      </span><span class="n">s38</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">9.19013417923270e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s39</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.24400776026014e2</span><span class="p">,</span><span class="w">      </span><span class="n">s40</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">4.08512871163839e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s41</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.91127352213516e1</span><span class="p">,</span><span class="w">      </span><span class="n">s42</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.10508021853093e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.24790035899152e1</span><span class="p">,</span><span class="w">      </span><span class="n">s44</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.91029016556786</span><span class="p">,</span>
<span class="w">              </span><span class="n">s45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.45362719385412e1</span><span class="p">,</span><span class="w">      </span><span class="n">s46</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.96136194246355e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s47</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.06035474689088</span><span class="p">,</span><span class="w">        </span><span class="n">s48</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-5.36884688614009</span><span class="p">,</span>
<span class="w">              </span><span class="n">s49</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">4.43247303092448</span><span class="p">;</span>

<span class="w">    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
<span class="w">    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="o">*</span><span class="mf">0.025</span><span class="p">;</span>

<span class="w">    </span><span class="n">spiciness1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s01</span>
<span class="w">                       </span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s02</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s03</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s04</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s05</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s06</span><span class="o">+</span><span class="n">s07</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                       </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s08</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s09</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s10</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s11</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s12</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s13</span><span class="o">+</span><span class="n">s14</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                  </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s15</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s16</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s17</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s18</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s19</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s20</span><span class="o">+</span><span class="n">s21</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s22</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s23</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s24</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s25</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s26</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s27</span><span class="o">+</span><span class="n">s28</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s29</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s30</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s31</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s32</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s33</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s34</span><span class="o">+</span><span class="n">s35</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s36</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s37</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s38</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s39</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s40</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s41</span><span class="o">+</span><span class="n">s42</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s43</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s44</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s45</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s46</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s47</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s48</span><span class="o">+</span><span class="n">s49</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))))))));</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">spiciness1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_spiciness2                                 spiciness at p = 2000 dbar</span>
<span class="cm">%                                                        (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_spiciness2(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates spiciness from Absolute Salinity and Conservative</span>
<span class="cm">%  Temperature at a pressure of 2000 dbar, as described by McDougall and</span>
<span class="cm">%  Krzysik (2015).  This routine is based on the computationally-efficient</span>
<span class="cm">%  expression for specific volume in terms of SA, CT and p (Roquet et al.,</span>
<span class="cm">%  2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  spiciness2  =  spiciness referenced to a pressure of 2000 dbar</span>
<span class="cm">%                                                                [ kg/m^3 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Oliver Krzysik and Trevor McDougall                 [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., and O.A. Krzysik, 2015: Spiciness. Journal of Marine</span>
<span class="cm">%   Research, 73, 141-152.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_spiciness2</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">spiciness2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w">  </span><span class="n">s01</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.17327320732265e1</span><span class="p">,</span><span class="w">      </span><span class="n">s02</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.31200235147912e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s03</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.49574345782503e1</span><span class="p">,</span><span class="w">      </span><span class="n">s04</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.41678075247398e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s05</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.61654631402053e1</span><span class="p">,</span><span class="w">      </span><span class="n">s06</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.22582164667710e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s07</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.45092623982509e1</span><span class="p">,</span><span class="w">      </span><span class="n">s08</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.87776645983195e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s09</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.13902307672447e1</span><span class="p">,</span><span class="w">      </span><span class="n">s10</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.69777467534459</span><span class="p">,</span>
<span class="w">              </span><span class="n">s11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-5.69630115740438</span><span class="p">,</span><span class="w">        </span><span class="n">s12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.97586359017987e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s13</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.07507460387751e2</span><span class="p">,</span><span class="w">      </span><span class="n">s14</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-5.58234404964787e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-6.41708068766557e2</span><span class="p">,</span><span class="w">      </span><span class="n">s16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.53494801286161e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.86755437385364e1</span><span class="p">,</span><span class="w">      </span><span class="n">s18</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.52406930795842e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s19</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">4.23888258264105e1</span><span class="p">,</span><span class="w">      </span><span class="n">s20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.60118811141438e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s21</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">9.67497898053989e1</span><span class="p">,</span><span class="w">      </span><span class="n">s22</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">8.27674355478637e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s23</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">5.27561234412133e-1</span><span class="p">,</span><span class="w">     </span><span class="n">s24</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.87440206992396e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s25</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.83295392345171e2</span><span class="p">,</span><span class="w">      </span><span class="n">s26</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">5.14485994597635e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s27</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.29975755062696e2</span><span class="p">,</span><span class="w">      </span><span class="n">s28</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.36526588377456e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s29</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-5.74911728972948e2</span><span class="p">,</span><span class="w">      </span><span class="n">s30</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.91175851862772e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.59347231968841e2</span><span class="p">,</span><span class="w">      </span><span class="n">s32</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.33884725744938e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.87744010546157e1</span><span class="p">,</span><span class="w">      </span><span class="n">s34</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-6.04757235443685e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s35</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">5.27869695599657e1</span><span class="p">,</span><span class="w">      </span><span class="n">s36</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.12517758478878e2</span><span class="p">,</span>
<span class="w">              </span><span class="n">s37</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.24351794740528e1</span><span class="p">,</span><span class="w">      </span><span class="n">s38</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">6.53904308937490e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s39</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.44804080763788e1</span><span class="p">,</span><span class="w">      </span><span class="n">s40</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">3.93874257887364e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s41</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.49425448888996e1</span><span class="p">,</span><span class="w">      </span><span class="n">s42</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.62350721656367e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.25936844276669e1</span><span class="p">,</span><span class="w">      </span><span class="n">s44</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.44035700301595</span><span class="p">,</span>
<span class="w">              </span><span class="n">s45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.05079633683795e1</span><span class="p">,</span><span class="w">      </span><span class="n">s46</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.51515796259082e1</span><span class="p">,</span>
<span class="w">              </span><span class="n">s47</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-7.06609886460683</span><span class="p">,</span><span class="w">        </span><span class="n">s48</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.48043337052968</span><span class="p">,</span>
<span class="w">              </span><span class="n">s49</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.10066653978515</span><span class="p">;</span>

<span class="w">    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
<span class="w">    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="o">*</span><span class="mf">0.025</span><span class="p">;</span>

<span class="w">    </span><span class="n">spiciness2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s01</span>
<span class="w">                       </span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s02</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s03</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s04</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s05</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s06</span><span class="o">+</span><span class="n">s07</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                       </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s08</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s09</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s10</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s11</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s12</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s13</span><span class="o">+</span><span class="n">s14</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s15</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s16</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s17</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s18</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s19</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s20</span><span class="o">+</span><span class="n">s21</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s22</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s23</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s24</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s25</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s26</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s27</span><span class="o">+</span><span class="n">s28</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s29</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s30</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s31</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s32</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s33</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s34</span><span class="o">+</span><span class="n">s35</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s36</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s37</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s38</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s39</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s40</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s41</span><span class="o">+</span><span class="n">s42</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))</span>
<span class="w">                        </span><span class="o">+</span><span class="n">xs</span><span class="o">*</span><span class="p">(</span><span class="n">s43</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s44</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s45</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s46</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s47</span><span class="o">+</span><span class="n">ys</span><span class="o">*</span><span class="p">(</span><span class="n">s48</span><span class="o">+</span><span class="n">s49</span><span class="o">*</span><span class="n">ys</span><span class="p">)))))))))));</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">spiciness2</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_CT_second_derivatives                           second derivatives of</span>
<span class="cm">%                                                  Conservative Temperature</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_CT_second_derivatives(SA,pt)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following three, second-order derivatives of Conservative</span>
<span class="cm">%  Temperature</span>
<span class="cm">%   (1) CT_SA_SA, the second derivative with respect to Absolute Salinity</span>
<span class="cm">%       at constant potential temperature (with p_ref = 0 dbar),</span>
<span class="cm">%   (2) CT_SA_pt, the derivative with respect to potential temperature</span>
<span class="cm">%       (the regular potential temperature which is referenced to 0 dbar)</span>
<span class="cm">%       and Absolute Salinity, and</span>
<span class="cm">%   (3) CT_pt_pt, the second derivative with respect to potential</span>
<span class="cm">%       temperature (the regular potential temperature which is referenced</span>
<span class="cm">%       to 0 dbar) at constant Absolute Salinity.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  pt  =  potential temperature (ITS-90)                          [ deg C ]</span>
<span class="cm">%         (whose reference pressure is 0 dbar)</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  CT_SA_SA  =  The second derivative of Conservative Temperature with</span>
<span class="cm">%               respect to Absolute Salinity at constant potential</span>
<span class="cm">%               temperature (the regular potential temperature which</span>
<span class="cm">%               has reference sea pressure of 0 dbar).</span>
<span class="cm">%               CT_SA_SA has units of:                     [ K/((g/kg)^2) ]</span>
<span class="cm">%  CT_SA_pt  =  The derivative of Conservative Temperature with</span>
<span class="cm">%               respect to potential temperature (the regular one with</span>
<span class="cm">%               p_ref = 0 dbar) and Absolute Salinity.</span>
<span class="cm">%               CT_SA_pt has units of:                        [ 1/(g/kg) ]</span>
<span class="cm">%  CT_pt_pt  =  The second derivative of Conservative Temperature with</span>
<span class="cm">%               respect to potential temperature (the regular one with</span>
<span class="cm">%               p_ref = 0 dbar) at constant SA.</span>
<span class="cm">%               CT_pt_pt has units of:                              [ 1/K ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (1st September, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%    See appendix A.12 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_ct_second_derivatives</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">pt</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ct_sa_sa</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ct_sa_pt</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ct_pt_pt</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w">  </span><span class="n">ct_pt_l</span><span class="p">,</span><span class="w"> </span><span class="n">ct_pt_u</span><span class="p">,</span><span class="w"> </span><span class="n">ct_sa_l</span><span class="p">,</span><span class="w"> </span><span class="n">ct_sa_u</span><span class="p">,</span><span class="w"> </span><span class="n">pt_l</span><span class="p">,</span><span class="w"> </span><span class="n">pt_u</span><span class="p">,</span><span class="w"> </span><span class="n">sa_l</span><span class="p">,</span><span class="w"> </span><span class="n">sa_u</span><span class="p">,</span>
<span class="w">              </span><span class="n">dsa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-3</span><span class="p">,</span><span class="w"> </span><span class="n">dpt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-2</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ct_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">sa_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dsa</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="n">sa_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">        </span><span class="n">sa_u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dsa</span><span class="p">;</span>
<span class="w">        </span><span class="n">gsw_ct_first_derivatives</span><span class="p">(</span><span class="n">sa_l</span><span class="p">,</span><span class="n">pt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ct_sa_l</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">        </span><span class="n">gsw_ct_first_derivatives</span><span class="p">(</span><span class="n">sa_u</span><span class="p">,</span><span class="n">pt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ct_sa_u</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">        </span><span class="o">*</span><span class="n">ct_sa_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ct_sa_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ct_sa_l</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sa_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sa_l</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ct_sa_pt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">ct_pt_pt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">pt_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dpt</span><span class="p">;</span>
<span class="w">        </span><span class="n">pt_u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dpt</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ct_sa_pt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">ct_pt_pt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">gsw_ct_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">pt_l</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ct_sa_l</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ct_pt_l</span><span class="p">);</span>
<span class="w">            </span><span class="n">gsw_ct_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">pt_u</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ct_sa_u</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ct_pt_u</span><span class="p">);</span>
<span class="w">            </span><span class="o">*</span><span class="n">ct_sa_pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ct_sa_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ct_sa_l</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pt_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pt_l</span><span class="p">);</span>
<span class="w">            </span><span class="o">*</span><span class="n">ct_pt_pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ct_pt_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ct_pt_l</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pt_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pt_l</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ct_sa_pt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">ct_pt_pt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">gsw_ct_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">pt_l</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ct_sa_l</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">            </span><span class="n">gsw_ct_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">pt_u</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ct_sa_u</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">            </span><span class="o">*</span><span class="n">ct_sa_pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ct_sa_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ct_sa_l</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pt_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pt_l</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ct_sa_pt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">ct_pt_pt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">gsw_ct_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">pt_l</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ct_pt_l</span><span class="p">);</span>
<span class="w">            </span><span class="n">gsw_ct_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">pt_u</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ct_pt_u</span><span class="p">);</span>
<span class="w">            </span><span class="o">*</span><span class="n">ct_pt_pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ct_pt_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ct_pt_l</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pt_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pt_l</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_geo_strf_dyn_height                            dynamic height anomaly</span>
<span class="cm">%                                                        (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_geo_strf_dyn_height(SA,CT,p,p_ref)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates dynamic height anomaly as the integral of specific volume</span>
<span class="cm">%  anomaly from the pressure p of the bottle to the reference pressure</span>
<span class="cm">%  p_ref.</span>
<span class="cm">%</span>
<span class="cm">%  Hence, geo_strf_dyn_height is the dynamic height anomaly with respect</span>
<span class="cm">%  to a given reference pressure.  This is the geostrophic streamfunction</span>
<span class="cm">%  for the difference between the horizontal velocity at the pressure</span>
<span class="cm">%  concerned, p, and the horizontal velocity at p_ref.  Dynamic height</span>
<span class="cm">%  anomaly is the geostrophic streamfunction in an isobaric surface.  The</span>
<span class="cm">%  reference values used for the specific volume anomaly are</span>
<span class="cm">%  SSO = 35.16504 g/kg and CT = 0 deg C.  This function calculates</span>
<span class="cm">%  specific volume anomaly using the computationally efficient</span>
<span class="cm">%  expression for specific volume of Roquet et al. (2015).</span>
<span class="cm">%</span>
<span class="cm">%  This function evaluates the pressure integral of specific volume using</span>
<span class="cm">%  SA and CT interpolated using the MRST-PCHIP method of Barker and</span>
<span class="cm">%  McDougall (2020).  This &quot;curve fitting&quot; method uses a Piecewise Cubic</span>
<span class="cm">%  Hermite Interpolating Polynomial to produce a smooth curve with minimal</span>
<span class="cm">%  artificial watermasses between the observed data points.</span>
<span class="cm">%</span>
<span class="cm">%  Note that the 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  For dynamical oceanography we may</span>
<span class="cm">%  take the 75-term rational function expression for specific volume as</span>
<span class="cm">%  essentially reflecting the full accuracy of TEOS-10.  The GSW library</span>
<span class="cm">%  function &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to</span>
<span class="cm">%  test if some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA    =  Absolute Salinity                                      [ g/kg ]</span>
<span class="cm">%  CT    =  Conservative Temperature (ITS-90)                     [ deg C ]</span>
<span class="cm">%  p     =  sea pressure                                           [ dbar ]</span>
<span class="cm">%           ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%  p_ref =  reference pressure                                     [ dbar ]</span>
<span class="cm">%           ( i.e. reference absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  geo_strf_dyn_height  =  dynamic height anomaly               [ m^2/s^2 ]</span>
<span class="cm">%   Note. If p_ref exceeds the pressure of the deepest bottle on a</span>
<span class="cm">%     vertical profile, the dynamic height anomaly for each bottle</span>
<span class="cm">%     on the whole vertical profile is returned as NaN.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  Barker, P.M., and T.J. McDougall, 2020: Two interpolation methods using</span>
<span class="cm">%   multiply-rotated piecewise cubic hermite interpolating polynomials.</span>
<span class="cm">%   J. Atmosph. Ocean. Tech., 37, pp. 605-619.</span>
<span class="cm">%   doi: 10.1175/JTECH-D-19-0211.1.</span>
<span class="cm">%</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (3.7.3) and section 3.27 of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling, 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_geo_strf_dyn_height</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="n">p_ref</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">n_levels</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">dyn_height</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">n_levels</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">n_levels</span><span class="p">,</span>
<span class="w">         </span><span class="n">p_cnt</span><span class="p">,</span><span class="w"> </span><span class="n">top_pad</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">nz</span><span class="p">,</span><span class="w"> </span><span class="n">ibottle</span><span class="p">,</span><span class="w"> </span><span class="n">ipref</span><span class="p">,</span>
<span class="w">         </span><span class="n">np_max</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="p">,</span><span class="w"> </span><span class="n">ibpr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">iidata</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">dp_min</span><span class="p">,</span><span class="w"> </span><span class="n">dp_max</span><span class="p">,</span><span class="w"> </span><span class="n">p_min</span><span class="p">,</span><span class="w"> </span><span class="n">p_max</span><span class="p">,</span><span class="w"> </span><span class="n">max_dp_i</span><span class="p">,</span>
<span class="w">             </span><span class="o">*</span><span class="n">b</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">b_av</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">dp</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">dp_i</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">sa_i</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ct_i</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span>
<span class="w">              </span><span class="o">*</span><span class="n">p_i</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">geo_strf_dyn_height0</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">max_dp_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">nz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_levels</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="n">dp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">nz</span><span class="p">];</span>
<span class="w">    </span><span class="n">dp_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">11000.0</span><span class="p">;</span>
<span class="w">    </span><span class="n">dp_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-11000.0</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nz</span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dp_min</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="n">dp_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dp_max</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="n">dp_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dp_min</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">dp</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">p_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="n">p_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">nz</span><span class="mi">-1</span><span class="p">];</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_ref</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">p_max</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">dp</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">ipref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ibottle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ibottle</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nz</span><span class="p">;</span><span class="w"> </span><span class="n">ibottle</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">ibottle</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p_ref</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ipref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ibottle</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">dp_max</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max_dp_i</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">ipref</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">nz</span><span class="p">];</span>
<span class="w">        </span><span class="n">b_av</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="o">+</span><span class="n">nz</span><span class="p">;</span>
<span class="w">        </span><span class="n">geo_strf_dyn_height0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b_av</span><span class="o">+</span><span class="n">nz</span><span class="p">;</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nz</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_specvol_anom_standard</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">ct</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="n">b_av</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nz</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b_av</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">db2pa</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nz</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span>
<span class="w">                                              </span><span class="o">-</span><span class="w"> </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nz</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="n">dyn_height</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="w">                                 </span><span class="o">-</span><span class="w"> </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">ipref</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">iidata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">nz</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">dp_max</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max_dp_i</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">ipref</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">sa_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">nz</span><span class="o">+</span><span class="mi">1</span><span class="p">)];</span>
<span class="w">            </span><span class="n">ct_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa_i</span><span class="o">+</span><span class="n">nz</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="n">p_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">nz</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_min</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nz</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">sa_i</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">                    </span><span class="n">ct_i</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">                    </span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="n">sa_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">                </span><span class="n">ct_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">                </span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                </span><span class="n">ibpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipref</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="w">                </span><span class="n">p_cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nz</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">p_cnt</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="n">iidata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">memmove</span><span class="p">(</span><span class="n">sa_i</span><span class="p">,</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">nz</span><span class="o">*</span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="w">                </span><span class="n">memmove</span><span class="p">(</span><span class="n">ct_i</span><span class="p">,</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="w"> </span><span class="n">nz</span><span class="o">*</span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="w">                </span><span class="n">memmove</span><span class="p">(</span><span class="n">p_i</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">nz</span><span class="o">*</span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="w">                </span><span class="n">ibpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipref</span><span class="p">;</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nz</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                   </span><span class="n">iidata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">                </span><span class="n">p_cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nz</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">np_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">rint</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">nz</span><span class="mi">-1</span><span class="p">]</span><span class="o">/</span><span class="n">max_dp_i</span><span class="o">+</span><span class="mf">0.5</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_i</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">p_i</span><span class="p">;</span>
<span class="w">            </span><span class="n">p_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">np_max</span><span class="p">];</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_min</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_ref</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p_min</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                    </span><span class="n">gsw_p_sequence</span><span class="p">(</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p_ref</span><span class="p">,</span><span class="n">max_dp_i</span><span class="p">,</span><span class="w"> </span><span class="n">p_i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">np</span><span class="p">);</span>
<span class="w">                    </span><span class="n">ibpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">;</span>
<span class="w">                    </span><span class="n">p_cnt</span><span class="o">++</span><span class="p">;</span>
<span class="w">                    </span><span class="n">gsw_p_sequence</span><span class="p">(</span><span class="n">p_ref</span><span class="p">,</span><span class="n">p_min</span><span class="p">,</span><span class="n">max_dp_i</span><span class="p">,</span><span class="w"> </span><span class="n">p_i</span><span class="o">+</span><span class="n">p_cnt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">np</span><span class="p">);</span>
<span class="w">                    </span><span class="n">p_cnt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">np</span><span class="p">;</span>
<span class="w">                    </span><span class="n">top_pad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_cnt</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                    </span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_min</span><span class="p">;</span>
<span class="w">                    </span><span class="n">top_pad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">                    </span><span class="n">p_cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_min</span><span class="p">;</span>
<span class="w">                </span><span class="n">top_pad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">                </span><span class="n">p_cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ibottle</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ibottle</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nz</span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="n">ibottle</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">iidata</span><span class="p">[</span><span class="n">ibottle</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_cnt</span><span class="mi">-1</span><span class="p">;</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">ibottle</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p_ref</span><span class="p">)</span><span class="w"> </span><span class="n">ibpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_cnt</span><span class="mi">-1</span><span class="p">;</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">ibottle</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p_ref</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">ibottle</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">p_ref</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">gsw_p_sequence</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">ibottle</span><span class="p">],</span><span class="n">p_ref</span><span class="p">,</span><span class="n">max_dp_i</span><span class="p">,</span><span class="w"> </span><span class="n">p_i</span><span class="o">+</span><span class="n">p_cnt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">np</span><span class="p">);</span>
<span class="w">                    </span><span class="n">p_cnt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">np</span><span class="p">;</span>
<span class="w">                    </span><span class="n">ibpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_cnt</span><span class="mi">-1</span><span class="p">;</span>
<span class="w">                    </span><span class="n">gsw_p_sequence</span><span class="p">(</span><span class="n">p_ref</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="n">ibottle</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">max_dp_i</span><span class="p">,</span><span class="n">p_i</span><span class="o">+</span><span class="n">p_cnt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">np</span><span class="p">);</span>
<span class="w">                    </span><span class="n">p_cnt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">np</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">gsw_p_sequence</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">ibottle</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="n">ibottle</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">max_dp_i</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">p_i</span><span class="o">+</span><span class="n">p_cnt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">np</span><span class="p">);</span>
<span class="w">                    </span><span class="n">p_cnt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">np</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">iidata</span><span class="p">[</span><span class="n">nz</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_cnt</span><span class="mi">-1</span><span class="p">;</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">nz</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p_ref</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="n">ibpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_cnt</span><span class="mi">-1</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>

<span class="w">            </span><span class="n">sa_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">p_cnt</span><span class="p">];</span>
<span class="w">            </span><span class="n">ct_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa_i</span><span class="o">+</span><span class="n">p_cnt</span><span class="p">;</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">top_pad</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">gsw_linear_interp_sa_ct</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span>
<span class="w">                                                </span><span class="n">p_i</span><span class="p">,</span><span class="n">top_pad</span><span class="mi">-1</span><span class="p">,</span><span class="n">sa_i</span><span class="p">,</span><span class="n">ct_i</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">gsw_rr68_interp_sa_ct</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">p_i</span><span class="o">+</span><span class="n">top_pad</span><span class="mi">-1</span><span class="p">,</span><span class="n">p_cnt</span><span class="o">-</span><span class="n">top_pad</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">sa_i</span><span class="o">+</span><span class="n">top_pad</span><span class="mi">-1</span><span class="p">,</span><span class="n">ct_i</span><span class="o">+</span><span class="n">top_pad</span><span class="mi">-1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">p_cnt</span><span class="p">];</span>
<span class="w">        </span><span class="n">b_av</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="o">+</span><span class="n">p_cnt</span><span class="p">;</span>
<span class="w">        </span><span class="n">dp_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b_av</span><span class="o">+</span><span class="n">p_cnt</span><span class="p">;</span>
<span class="w">        </span><span class="n">geo_strf_dyn_height0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp_i</span><span class="o">+</span><span class="n">p_cnt</span><span class="p">;</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">p_cnt</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_specvol_anom_standard</span><span class="p">(</span><span class="n">sa_i</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">ct_i</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">dp_i</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">];</span>
<span class="w">                </span><span class="n">b_av</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">p_cnt</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b_av</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="o">*</span><span class="n">dp_i</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">p_cnt</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span>
<span class="w">                                              </span><span class="o">-</span><span class="w"> </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nz</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">           </span><span class="n">dyn_height</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">iidata</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
<span class="w">                                  </span><span class="o">-</span><span class="w"> </span><span class="n">geo_strf_dyn_height0</span><span class="p">[</span><span class="n">ibpr</span><span class="p">])</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">db2pa</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">b</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iidata</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">iidata</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sa_i</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">sa_i</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_i</span><span class="p">)</span><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">p_i</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">dp</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">dyn_height</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************</span>
<span class="cm">=======</span>
<span class="cm">method: gsw_p_sequence(p1, p2, max_dp_i, *pseq, *nps)</span>
<span class="cm">=======</span>
<span class="cm">******************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_p_sequence</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p2</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">max_dp_i</span><span class="p">,</span>
<span class="w">                              </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">pseq</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">nps</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="n">pstep</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>

<span class="w">    </span><span class="n">dp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p1</span><span class="p">;</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ceil</span><span class="p">(</span><span class="n">dp</span><span class="o">/</span><span class="n">max_dp_i</span><span class="p">);</span>
<span class="w">    </span><span class="n">pstep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp</span><span class="o">/</span><span class="n">n</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nps</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">       </span><span class="o">*</span><span class="n">nps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>

<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="n">pseq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p2</span><span class="o">-</span><span class="n">pstep</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="mi">-1</span><span class="o">-</span><span class="n">i</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">% gsw_pt_second_derivatives     second derivatives of potential temperature</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  [pt_SA_SA, pt_SA_CT, pt_CT_CT] = gsw_pt_second_derivatives(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following three second-order derivatives of potential</span>
<span class="cm">%  temperature (the regular potential temperature which has a reference</span>
<span class="cm">%  sea pressure of 0 dbar),</span>
<span class="cm">%   (1) pt_SA_SA, the second derivative with respect to Absolute Salinity</span>
<span class="cm">%       at constant Conservative Temperature,</span>
<span class="cm">%   (2) pt_SA_CT, the derivative with respect to Conservative Temperature</span>
<span class="cm">%       and Absolute Salinity, and</span>
<span class="cm">%   (3) pt_CT_CT, the second derivative with respect to Conservative</span>
<span class="cm">%       Temperature at constant Absolute Salinity.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">%  SA &amp; CT need to have the same dimensions.</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  pt_SA_SA  =  The second derivative of potential temperature (the</span>
<span class="cm">%               regular potential temperature which has reference sea</span>
<span class="cm">%               pressure of 0 dbar) with respect to Absolute Salinity</span>
<span class="cm">%               at constant Conservative Temperature.</span>
<span class="cm">%               pt_SA_SA has units of:                     [ K/((g/kg)^2) ]</span>
<span class="cm">%  pt_SA_CT  =  The derivative of potential temperature with respect</span>
<span class="cm">%               to Absolute Salinity and Conservative Temperature.</span>
<span class="cm">%               pt_SA_CT has units of:                         [ 1/(g/kg) ]</span>
<span class="cm">%  pt_CT_CT  =  The second derivative of potential temperature (the</span>
<span class="cm">%               regular one with p_ref = 0 dbar) with respect to</span>
<span class="cm">%               Conservative Temperature at constant SA.</span>
<span class="cm">%               pt_CT_CT has units of:                              [ 1/K ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%    See Eqns. (A.12.9) and (A.12.10) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_pt_second_derivatives</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">pt_sa_sa</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">pt_sa_ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">pt_ct_ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">ct_l</span><span class="p">,</span><span class="w"> </span><span class="n">ct_u</span><span class="p">,</span><span class="w"> </span><span class="n">pt_ct_l</span><span class="p">,</span><span class="w"> </span><span class="n">pt_ct_u</span><span class="p">,</span><span class="w"> </span><span class="n">pt_sa_l</span><span class="p">,</span><span class="w"> </span><span class="n">pt_sa_u</span><span class="p">,</span><span class="w"> </span><span class="n">sa_l</span><span class="p">,</span><span class="w"> </span><span class="n">sa_u</span><span class="p">,</span>
<span class="w">             </span><span class="n">dct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-2</span><span class="p">,</span><span class="w"> </span><span class="n">dsa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-3</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pt_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">sa_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dsa</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span>
<span class="w">            </span><span class="n">sa_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">        </span><span class="n">sa_u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dsa</span><span class="p">;</span>
<span class="w">        </span><span class="n">gsw_pt_first_derivatives</span><span class="p">(</span><span class="n">sa_l</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt_sa_l</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">        </span><span class="n">gsw_pt_first_derivatives</span><span class="p">(</span><span class="n">sa_u</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt_sa_u</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">        </span><span class="o">*</span><span class="n">pt_sa_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pt_sa_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pt_sa_l</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sa_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sa_l</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pt_sa_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">pt_ct_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ct_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dct</span><span class="p">;</span>
<span class="w">        </span><span class="n">ct_u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dct</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">pt_sa_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">pt_ct_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">gsw_pt_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct_l</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt_sa_l</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt_ct_l</span><span class="p">);</span>
<span class="w">            </span><span class="n">gsw_pt_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct_u</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt_sa_u</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt_ct_u</span><span class="p">);</span>
<span class="w">            </span><span class="o">*</span><span class="n">pt_sa_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pt_sa_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pt_sa_l</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ct_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ct_l</span><span class="p">);</span>
<span class="w">            </span><span class="o">*</span><span class="n">pt_ct_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pt_ct_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pt_ct_l</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ct_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ct_l</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">pt_sa_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">pt_ct_ct</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">gsw_pt_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct_l</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt_sa_l</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">            </span><span class="n">gsw_pt_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct_u</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt_sa_u</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">            </span><span class="o">*</span><span class="n">pt_sa_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pt_sa_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pt_sa_l</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ct_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ct_l</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">pt_sa_ct</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">pt_ct_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">gsw_pt_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct_l</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt_ct_l</span><span class="p">);</span>
<span class="w">            </span><span class="n">gsw_pt_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct_u</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt_ct_u</span><span class="p">);</span>
<span class="w">            </span><span class="o">*</span><span class="n">pt_ct_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pt_ct_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pt_ct_l</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ct_u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ct_l</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">=======</span>
<span class="cm">method:</span>
<span class="cm">gsw_refine_grid_for_dh(*p,p_ref,nz,dp,*p_i,ni_max,*p_indices,*p_ref_ind_ptr)</span>
<span class="cm">======</span>
<span class="cm">****************************************************************************/</span>
<span class="kt">int</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_refine_grid_for_dh</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p_ref</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">nz</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">dp</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">p_i</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">ni_max</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">p_indices</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">p_ref_ind_ptr</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">iuniform</span><span class="p">,</span><span class="w"> </span><span class="n">iorig</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">p_next</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">p_tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.001</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dp</span><span class="p">;</span>

<span class="w">    </span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="n">p_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="n">p_ref_ind_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_ref</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p_tol</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">p_ref_ind_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">iuniform</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">iorig</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">ni_max</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">iorig</span><span class="o">&lt;</span><span class="n">nz</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">p_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">iuniform</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">p_ref_ind_ptr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p_ref</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">p_next</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p_ref</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">iorig</span><span class="p">])</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_ref</span><span class="p">;</span>
<span class="w">            </span><span class="o">*</span><span class="n">p_ref_ind_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_ref</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">iorig</span><span class="p">])</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">p_indices</span><span class="p">[</span><span class="n">iorig</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">                </span><span class="n">iorig</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_ref</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">p_next</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p_tol</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">iuniform</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_next</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">iorig</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p_tol</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_next</span><span class="p">;</span>
<span class="w">            </span><span class="n">iuniform</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">iorig</span><span class="p">];</span>
<span class="w">            </span><span class="n">p_indices</span><span class="p">[</span><span class="n">iorig</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_next</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">iorig</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p_tol</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">iuniform</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">iorig</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ni_max</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_rho_first_derivatives                SA, CT and p partial derivatives</span>
<span class="cm">%                                             of density (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_rho_first_derivatives(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the three (3) partial derivatives of in-situ density with</span>
<span class="cm">%  respect to Absolute Salinity, Conservative Temperature and pressure.</span>
<span class="cm">%  Note that the pressure derivative is done with respect to pressure in</span>
<span class="cm">%  Pa, not dbar.  This function uses the computationally-efficient</span>
<span class="cm">%  expression for specific volume in terms of SA, CT and p (Roquet et al.,</span>
<span class="cm">%  2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  rho_SA  =  partial derivative of density           [ (kg/m^3)(g/kg)^-1 ]</span>
<span class="cm">%                 with respect to Absolute Salinity</span>
<span class="cm">%  rho_CT  =  partial derivative of density                  [ kg/(m^3 K) ]</span>
<span class="cm">%                 with respect to Conservative Temperature</span>
<span class="cm">%  rho_P   =  partial derivative of density                 [ kg/(m^3 Pa) ]</span>
<span class="cm">%                 with respect to pressure in Pa</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See appendix A.20 and appendix K of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">% The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_rho_first_derivatives</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">drho_dsa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">drho_dct</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">drho_dp</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">rho2</span><span class="p">,</span><span class="w"> </span><span class="n">v_ct</span><span class="p">,</span><span class="w"> </span><span class="n">v_p</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa</span><span class="p">,</span><span class="w"> </span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>

<span class="w">    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
<span class="w">    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="o">*</span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">*</span><span class="mf">1e-4</span><span class="p">;</span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_v</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">    </span><span class="n">rho2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">drho_dsa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_b</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">        </span><span class="o">*</span><span class="n">drho_dsa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">rho2</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">*</span><span class="n">v_sa</span><span class="o">/</span><span class="n">xs</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">drho_dct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_a</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">        </span><span class="o">*</span><span class="n">drho_dct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">rho2</span><span class="o">*</span><span class="mf">0.025</span><span class="o">*</span><span class="n">v_ct</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">drho_dp</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_c</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">        </span><span class="o">*</span><span class="n">drho_dp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-4</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">pa2db</span><span class="o">*-</span><span class="n">rho2</span><span class="o">*</span><span class="n">v_p</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sigma0_ct_exact                        potential density anomaly with</span>
<span class="cm">%                                         reference sea pressure of 0 dbar.</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_sigma0_ct_exact(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density anomaly with reference pressure of 0 dbar,</span>
<span class="cm">%  this being this particular potential density minus 1000 kg/m^3.  This</span>
<span class="cm">%  function has inputs of Absolute Salinity and Conservative Temperature.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely gsw_sigma0(SA,CT,p),</span>
<span class="cm">%  which uses the computationally efficient 75-term expression for specific</span>
<span class="cm">%  volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sigma0_CT_exact  =  potential density anomaly with            [ kg/m^3 ]</span>
<span class="cm">%                      respect to a reference pressure of 0 dbar,</span>
<span class="cm">%                      that is, this potential density - 1000 kg/m^3.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall &amp; Paul Barker                      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (A.30.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sigma0_ct_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">pt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_pt_from_ct</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">);</span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">gsw_sigma0_pt0_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">pt0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_rho_second_derivatives_wrt_enthalpy                second derivatives</span>
<span class="cm">%                        of rho with respect to enthalpy (75-term equation)</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_rho_second_derivatives_wrt_enthalpy(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following three second-order derivatives of rho with</span>
<span class="cm">%  respect to enthalpy,</span>
<span class="cm">%   (1) rho_SA_SA, second-order derivative with respect to Absolute Salinity</span>
<span class="cm">%       at constant h &amp; p.</span>
<span class="cm">%   (2) rho_SA_h, second-order derivative with respect to SA &amp; h at</span>
<span class="cm">%       constant p.</span>
<span class="cm">%   (3) rho_h_h, second-order derivative with respect to h at</span>
<span class="cm">%       constant SA &amp; p.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the using the computationally-efficient</span>
<span class="cm">%  expression for specific volume (Roquet et al., 2015).  There is an</span>
<span class="cm">%  alternative to calling this function, namely</span>
<span class="cm">%  gsw_rho_second_derivatives_wrt_enthalpy_CT_exact(SA,CT,p) which uses</span>
<span class="cm">%  the full Gibbs function (IOC et al., 2010).</span>
<span class="cm">%</span>
<span class="cm">%  This 75-term equation has been fitted in a restricted range of parameter</span>
<span class="cm">%  space, and is most accurate inside the &quot;oceanographic funnel&quot; described</span>
<span class="cm">%  in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  rho_SA_SA = The second-order derivative of rho with respect to</span>
<span class="cm">%              Absolute Salinity at constant h &amp; p.     [ J/(kg (g/kg)^2) ]</span>
<span class="cm">%  rho_SA_h  = The second-order derivative of rho with respect to</span>
<span class="cm">%              SA and h at constant p.                   [ J/(kg K(g/kg)) ]</span>
<span class="cm">%  rho_h_h   = The second-order derivative of rho with respect to h at</span>
<span class="cm">%              constant SA &amp; p</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_rho_second_derivatives_wrt_enthalpy</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span>
<span class="w">                                                      </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                                      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">rho_sa_sa</span><span class="p">,</span>
<span class="w">                                                      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">rho_sa_h</span><span class="p">,</span>
<span class="w">                                                      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">rho_h_h</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w">  </span><span class="n">rec_v</span><span class="p">,</span><span class="w"> </span><span class="n">rec_v2</span><span class="p">,</span><span class="w"> </span><span class="n">rec_v3</span><span class="p">,</span><span class="w"> </span><span class="n">v_h</span><span class="p">,</span><span class="w"> </span><span class="n">v_h_h</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_h</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_sa</span><span class="p">,</span>
<span class="w">              </span><span class="o">*</span><span class="n">pv_sa</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">pv_h</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">pv_sa_sa</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">pv_sa_h</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">pv_h_h</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">    </span><span class="n">pv_sa</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">rho_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">rho_sa_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v_sa</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">pv_h</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">rho_sa_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">rho_h_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w">  </span><span class="o">&amp;</span><span class="n">v_h</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">    </span><span class="n">gsw_specvol_first_derivatives_wrt_enthalpy</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">pv_sa</span><span class="p">,</span><span class="n">pv_h</span><span class="p">);</span>

<span class="w">    </span><span class="n">pv_sa_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">rho_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v_sa_sa</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">pv_sa_h</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">rho_sa_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v_sa_h</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">pv_h_h</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">rho_h_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v_h_h</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">    </span><span class="n">gsw_specvol_second_derivatives_wrt_enthalpy</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">pv_sa_sa</span><span class="p">,</span><span class="n">pv_sa_h</span><span class="p">,</span><span class="n">pv_h_h</span><span class="p">);</span>

<span class="w">    </span><span class="n">rec_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="o">/</span><span class="n">gsw_specvol</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">rec_v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rec_v</span><span class="o">*</span><span class="n">rec_v</span><span class="p">;</span>
<span class="w">    </span><span class="n">rec_v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rec_v2</span><span class="o">*</span><span class="n">rec_v</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rho_sa_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="o">*</span><span class="n">rho_sa_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_sa_sa</span><span class="o">*</span><span class="n">rec_v2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">v_sa</span><span class="o">*</span><span class="n">v_sa</span><span class="o">*</span><span class="n">rec_v3</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rho_sa_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="o">*</span><span class="n">rho_sa_h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_sa_h</span><span class="o">*</span><span class="n">rec_v2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">v_sa</span><span class="o">*</span><span class="n">v_h</span><span class="o">*</span><span class="n">rec_v3</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rho_h_h</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="o">*</span><span class="n">rho_h_h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_h_h</span><span class="o">*</span><span class="n">rec_v2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">v_h</span><span class="o">*</span><span class="n">v_h</span><span class="o">*</span><span class="n">rec_v3</span><span class="p">;</span>

<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">==========================================================================</span>
<span class="cm">method: gsw_util_interp1q_int (x, iy, x_i)</span>
<span class="cm">==========================================================================</span>
<span class="cm">  Returns the value of the 1-D method iy (integer) at the points of column</span>
<span class="cm">  vector x_i using linear interpolation. The vector x specifies the</span>
<span class="cm">  coordinates of the underlying interval.</span>
<span class="cm">  result(y_i)</span>
<span class="cm">==========================================================================</span>
<span class="cm">*************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_util_interp1q_int</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nx</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">iy</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">nxi</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">x_i</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">y_i</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">in_rng</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">j</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">k</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">r</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">jrev</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ki</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">imax_x</span><span class="p">,</span><span class="w"> </span><span class="n">imin_x</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">ii</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">xi</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">xxi</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">max_x</span><span class="p">,</span><span class="w"> </span><span class="n">min_x</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nx</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">nxi</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="n">min_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="n">imin_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imax_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nx</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">min_x</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">min_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">            </span><span class="n">imin_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">max_x</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">max_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">            </span><span class="n">imax_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">in_rng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[</span><span class="n">nxi</span><span class="p">];</span>
<span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">in_rng</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">nxi</span><span class="o">*</span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nxi</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">min_x</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">y_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iy</span><span class="p">[</span><span class="n">imin_x</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">max_x</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">y_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iy</span><span class="p">[</span><span class="n">imax_x</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">in_rng</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="n">n</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in_rng</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">in_rng</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">y_i</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">xi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<span class="w">    </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">];</span>
<span class="w">    </span><span class="n">ki</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="o">+</span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ki</span><span class="o">+</span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">m</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">xxi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">m</span><span class="p">];</span>
<span class="w">    </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">];</span>
<span class="w">    </span><span class="n">jrev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">+</span><span class="n">m</span><span class="p">;</span>
<span class="w">    </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nxi</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in_rng</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">xi</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_i</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">            </span><span class="n">ki</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">            </span><span class="n">ii</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in_rng</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">in_rng</span><span class="p">;</span>
<span class="w">    </span><span class="n">gsw_util_sort_dbl</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nx</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">       </span><span class="n">xxi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">xxi</span><span class="p">[</span><span class="n">nx</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xi</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="n">gsw_util_sort_dbl</span><span class="p">(</span><span class="n">xxi</span><span class="p">,</span><span class="w"> </span><span class="n">nx</span><span class="o">+</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nx</span><span class="o">+</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">jrev</span><span class="p">[</span><span class="n">j</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jrev</span><span class="p">[</span><span class="n">nx</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="mi">-1</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]]);</span>
<span class="w">        </span><span class="n">y_i</span><span class="p">[</span><span class="n">ki</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iy</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">iy</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">iy</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span><span class="o">*</span><span class="n">u</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">j</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">xxi</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">xxi</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">k</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">xi</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">xi</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">y_i</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">==========================================================================</span>
<span class="cm">method: gsw_util_linear_interp (x, y, x_i)</span>
<span class="cm">==========================================================================</span>
<span class="cm">  Returns the values of the methods y{ny} at the points of column</span>
<span class="cm">  vector x_i using linear interpolation. The vector x specifies the</span>
<span class="cm">  coordinates of the underlying interval, and the matrix y specifies</span>
<span class="cm">  the method values at each x coordinate. Note that y has dimensions</span>
<span class="cm">  nx x ny and y_i has dimensions nxi x ny.</span>
<span class="cm">  This method was adapted from Matlabs interp1q.</span>
<span class="cm">  result(y_i)</span>
<span class="cm">==========================================================================</span>
<span class="cm">*************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_util_linear_interp</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nx</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">ny</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">nxi</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">x_i</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">y_i</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">in_rng</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">j</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">k</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">r</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">jrev</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ki</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span>
<span class="w">          </span><span class="n">imax_x</span><span class="p">,</span><span class="w"> </span><span class="n">imin_x</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">ii</span><span class="p">,</span><span class="w"> </span><span class="n">jy</span><span class="p">,</span><span class="w"> </span><span class="n">jy0</span><span class="p">,</span><span class="w"> </span><span class="n">jyi0</span><span class="p">,</span><span class="w"> </span><span class="n">r0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">xi</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">xxi</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">max_x</span><span class="p">,</span><span class="w"> </span><span class="n">min_x</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nx</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">nxi</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ny</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">min_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="n">imin_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imax_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nx</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">min_x</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">min_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">            </span><span class="n">imin_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">max_x</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">max_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">            </span><span class="n">imax_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">in_rng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[</span><span class="n">nxi</span><span class="p">];</span>
<span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">in_rng</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">nxi</span><span class="o">*</span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nxi</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">min_x</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">jy</span><span class="o">=</span><span class="n">jy0</span><span class="o">=</span><span class="n">jyi0</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">jy</span><span class="o">&lt;</span><span class="n">ny</span><span class="p">;</span><span class="w"> </span><span class="n">jy</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">jy0</span><span class="o">+=</span><span class="n">nx</span><span class="p">,</span><span class="w"> </span><span class="n">jyi0</span><span class="o">+=</span><span class="n">nxi</span><span class="p">)</span>
<span class="w">                </span><span class="n">y_i</span><span class="p">[</span><span class="n">jyi0</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">jy0</span><span class="o">+</span><span class="n">imin_x</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">max_x</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">jy</span><span class="o">=</span><span class="n">jy0</span><span class="o">=</span><span class="n">jyi0</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">jy</span><span class="o">&lt;</span><span class="n">ny</span><span class="p">;</span><span class="w"> </span><span class="n">jy</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">jy0</span><span class="o">+=</span><span class="n">nx</span><span class="p">,</span><span class="w"> </span><span class="n">jyi0</span><span class="o">+=</span><span class="n">nxi</span><span class="p">)</span>
<span class="w">                </span><span class="n">y_i</span><span class="p">[</span><span class="n">jyi0</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">jy0</span><span class="o">+</span><span class="n">imax_x</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">in_rng</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="n">n</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in_rng</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">in_rng</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">y_i</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">xi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<span class="w">    </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">];</span>
<span class="w">    </span><span class="n">ki</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="o">+</span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ki</span><span class="o">+</span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">m</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">xxi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">m</span><span class="p">];</span>
<span class="w">    </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">];</span>
<span class="w">    </span><span class="n">jrev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">+</span><span class="n">m</span><span class="p">;</span>
<span class="w">    </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nxi</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in_rng</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">xi</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_i</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">            </span><span class="n">ki</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">            </span><span class="n">ii</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in_rng</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">in_rng</span><span class="p">;</span>
<span class="w">    </span><span class="n">gsw_util_sort_dbl</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="n">memmove</span><span class="p">(</span><span class="n">xxi</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">nx</span><span class="o">*</span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="w">    </span><span class="n">memmove</span><span class="p">(</span><span class="n">xxi</span><span class="o">+</span><span class="n">nx</span><span class="p">,</span><span class="w"> </span><span class="n">xi</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">*</span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="w">    </span><span class="n">gsw_util_sort_dbl</span><span class="p">(</span><span class="n">xxi</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">jrev</span><span class="p">[</span><span class="n">j</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jrev</span><span class="p">[</span><span class="n">nx</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">jy</span><span class="o">=</span><span class="n">jy0</span><span class="o">=</span><span class="n">jyi0</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">jy</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ny</span><span class="p">;</span><span class="w"> </span><span class="n">jy</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">jy0</span><span class="o">+=</span><span class="n">nx</span><span class="p">,</span><span class="w"> </span><span class="n">jyi0</span><span class="o">+=</span><span class="n">nxi</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]]);</span>
<span class="w">            </span><span class="n">r0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jy0</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">            </span><span class="n">y_i</span><span class="p">[</span><span class="n">jyi0</span><span class="o">+</span><span class="n">ki</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">r0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">r0</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">r0</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">j</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">xxi</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">xxi</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">k</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">xi</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">xi</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">y_i</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*************************************************************************</span>
<span class="cm">=================================================</span>
<span class="cm">method: gsw_util_pchip_interp(*x,*y,n,*xi,*yi,ni)</span>
<span class="cm">=================================================</span>
<span class="cm">   Piecewise-Hermite algorithm from</span>
<span class="cm">   https://en.wikipedia.org/wiki/Cubic_Hermite_spline</span>
<span class="cm">   Extrapolation to points outside the range is done by setting those</span>
<span class="cm">   points to the corresponding end values.</span>
<span class="cm">   The input x must be monotonically increasing; the interpolation points,</span>
<span class="cm">   xi, may be in any order, but the algorithm will be faster if they are</span>
<span class="cm">   monotonic, increasing or decreasing.</span>
<span class="cm">   Returns 0 on success, 1 if it fails because there are fewer than 2 points,</span>
<span class="cm">   2 if it fails because x is not increasing.</span>
<span class="cm">   Consistent with other GSW-C code at present, the memory allocations</span>
<span class="cm">   are assumed to succeed.</span>
<span class="cm">*************************************************************************/</span>
<span class="kt">int</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_util_pchip_interp</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">xi</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">yi</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">ni</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">tt</span><span class="p">,</span><span class="w"> </span><span class="n">ttt</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">dx</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j0</span><span class="p">,</span><span class="w"> </span><span class="n">j1</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">h00</span><span class="p">,</span><span class="w"> </span><span class="n">h10</span><span class="p">,</span><span class="w"> </span><span class="n">h01</span><span class="p">,</span><span class="w"> </span><span class="n">h11</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<span class="w">    </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_pchip_derivs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">d</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">j0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">ni</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">xx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j0</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">j0</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">j0</span><span class="o">--</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">xx</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j0</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">j0</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">j0</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">xx</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j0</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j1</span><span class="p">])</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j0</span><span class="p">];</span>
<span class="w">            </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">xx</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j0</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">dx</span><span class="p">;</span>
<span class="w">            </span><span class="n">tt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="w">            </span><span class="n">ttt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="w">            </span><span class="n">h00</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ttt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">tt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="n">h10</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">(</span><span class="n">ttt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">tt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="w">            </span><span class="n">h01</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">-2</span><span class="o">*</span><span class="n">ttt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">tt</span><span class="p">);</span>
<span class="w">            </span><span class="n">h11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ttt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tt</span><span class="p">);</span>
<span class="w">            </span><span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">j0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">h00</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d</span><span class="p">[</span><span class="n">j0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">h10</span><span class="w"> </span><span class="o">+</span>
<span class="w">                      </span><span class="n">y</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">h01</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">h11</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">xx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="mi">-1</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">       </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">d</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_specvol_alpha_beta                 specific volume, thermal expansion</span>
<span class="cm">%                       &amp; saline contraction coefficient (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_specvol_alpha_beta(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates specific volume, the appropiate thermal expansion coefficient</span>
<span class="cm">%  and the appropriate saline contraction coefficient of seawater from</span>
<span class="cm">%  Absolute Salinity and Conservative Temperature.  This function uses the</span>
<span class="cm">%  computationally-efficient expression for specific volume in terms of</span>
<span class="cm">%  SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  specvol =  specific volume                                      [ m/kg ]</span>
<span class="cm">%  alpha   =  thermal expansion coefficient                         [ 1/K ]</span>
<span class="cm">%             with respect to Conservative Temperature</span>
<span class="cm">%  beta    =  saline (i.e. haline) contraction                     [ kg/g ]</span>
<span class="cm">%             coefficient at constant Conservative Temperature</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See appendix A.20 and appendix K of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">% The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_specvol_alpha_beta</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                       </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">specvol</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">alpha</span><span class="p">,</span>
<span class="w">                                       </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w">  </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">v_ct</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_part</span><span class="p">,</span><span class="w"> </span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>

<span class="w">    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
<span class="w">    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">rec_db2pa</span><span class="p">;</span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_v</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">specvol</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="o">*</span><span class="n">specvol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_a</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">        </span><span class="o">*</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.025</span><span class="o">*</span><span class="n">v_ct</span><span class="o">/</span><span class="n">v</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">beta</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_sa_part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gsvco_b</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">        </span><span class="o">*</span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_sa_part</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="o">/</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="n">xs</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_SP_from_Sstar              Practical Salinity from Preformed Salinity</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_SP_from_Sstar(Sstar,p,long,lat)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates Practical Salinity from Preformed Salinity.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  Sstar  =  Preformed Salinity                                    [ g/kg ]</span>
<span class="cm">%  p      =  sea pressure                                          [ dbar ]</span>
<span class="cm">%            ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%  long   =  longitude in decimal degrees                    [ 0 ... +360 ]</span>
<span class="cm">%                                                     or  [ -180 ... +180 ]</span>
<span class="cm">%  lat    =  latitude in decimal degrees north              [ -90 ... +90 ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  SP        =  Practical Salinity  (PSS-78)                   [ unitless ]</span>
<span class="cm">%  in_ocean  =  0, if long and lat are a long way from the ocean</span>
<span class="cm">%            =  1, if long and lat are in the ocean</span>
<span class="cm">%  Note. This flag is only set when the observation is well and truly on</span>
<span class="cm">%    dry land; often the warning flag is not set until one is several</span>
<span class="cm">%    hundred kilometres inland from the coast.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  David Jackett, Trevor McDougall and Paul Barker     [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, F.J. Millero, R. Pawlowicz and</span>
<span class="cm">%   P.M. Barker, 2012: A global algorithm for estimating Absolute Salinity.</span>
<span class="cm">%   Ocean Science, 8, 1123-1134.</span>
<span class="cm">%   http://www.ocean-sci.net/8/1123/2012/os-8-1123-2012.pdf</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sp_from_sstar</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sstar</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">lon</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">lat</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">saar</span><span class="p">,</span><span class="w"> </span><span class="n">sp_baltic</span><span class="p">;</span>

<span class="w">    </span><span class="n">sp_baltic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_sp_from_sa_baltic</span><span class="p">(</span><span class="n">sstar</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp_baltic</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">cppGSW_ERROR_LIMIT</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">sp_baltic</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="n">saar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_saar</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">saar</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">cppGSW_INVALID_VALUE</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">saar</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">sstar</span><span class="o">/</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_ups</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.35e0</span><span class="o">*</span><span class="n">saar</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_cabbeling                                       cabbeling coefficient</span>
<span class="cm">%                                                        (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_cabbeling(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the cabbeling coefficient of seawater with respect to</span>
<span class="cm">%  Conservative Temperature.  This function uses the computationally-</span>
<span class="cm">%  efficient expression for specific volume in terms of SA, CT and p</span>
<span class="cm">%  (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that the 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  cabbeling  =  cabbeling coefficient with respect to            [ 1/K^2 ]</span>
<span class="cm">%                Conservative Temperature.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqns. (3.9.2) and (P.4) of this TEOS-10 manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_cabbeling</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">alpha_ct</span><span class="p">,</span><span class="w"> </span><span class="n">alpha_on_beta</span><span class="p">,</span><span class="w"> </span><span class="n">alpha_sa</span><span class="p">,</span><span class="w"> </span><span class="n">beta_sa</span><span class="p">,</span><span class="w"> </span><span class="n">rho</span><span class="p">,</span>
<span class="w">             </span><span class="n">v_sa</span><span class="p">,</span><span class="w"> </span><span class="n">v_ct</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_sa</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_ct</span><span class="p">,</span><span class="w"> </span><span class="n">v_ct_ct</span><span class="p">;</span>

<span class="w">    </span><span class="n">gsw_specvol_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_sa</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_ct</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">gsw_specvol_second_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_sa_sa</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_sa_ct</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_ct_ct</span><span class="p">,</span>
<span class="w">                                             </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="n">rho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_rho</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">alpha_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho</span><span class="o">*</span><span class="p">(</span><span class="n">v_ct_ct</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rho</span><span class="o">*</span><span class="n">v_ct</span><span class="o">*</span><span class="n">v_ct</span><span class="p">);</span>
<span class="w">    </span><span class="n">alpha_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho</span><span class="o">*</span><span class="p">(</span><span class="n">v_sa_ct</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rho</span><span class="o">*</span><span class="n">v_sa</span><span class="o">*</span><span class="n">v_ct</span><span class="p">);</span>
<span class="w">    </span><span class="n">beta_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">rho</span><span class="o">*</span><span class="p">(</span><span class="n">v_sa_sa</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rho</span><span class="o">*</span><span class="n">v_sa</span><span class="o">*</span><span class="n">v_sa</span><span class="p">);</span>
<span class="w">    </span><span class="n">alpha_on_beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_alpha_on_beta</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">alpha_ct</span><span class="w"> </span><span class="o">+</span>
<span class="w">              </span><span class="n">alpha_on_beta</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">alpha_sa</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha_on_beta</span><span class="o">*</span><span class="n">beta_sa</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_thermobaric                thermobaric coefficient (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_thermobaric(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the thermobaric coefficient of seawater with respect to</span>
<span class="cm">%  Conservative Temperature.  This routine is based on the</span>
<span class="cm">%  computationally-efficient expression for specific volume in terms of</span>
<span class="cm">%  SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  thermobaric  =  thermobaric coefficient with                [ 1/(K Pa) ]</span>
<span class="cm">%                  respect to Conservative Temperature.</span>
<span class="cm">%  Note. The pressure derivative is taken with respect to</span>
<span class="cm">%    pressure in Pa not dbar.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqns. (3.8.2) and (P.2) of this TEOS-10 manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_thermobaric</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">v_ct</span><span class="p">,</span><span class="w"> </span><span class="n">v_ct_p</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_p</span><span class="p">;</span>

<span class="w">    </span><span class="n">gsw_specvol_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_sa</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_ct</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">gsw_specvol_second_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_sa_p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_ct_p</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_rho</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">v_ct_p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">v_ct</span><span class="o">/</span><span class="n">v_sa</span><span class="p">)</span><span class="o">*</span><span class="n">v_sa_p</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_rho_second_derivatives                             second derivatives</span>
<span class="cm">%                                                 of rho (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_rho_second_derivatives(SA,CT,p)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following five second-order derivatives of rho,</span>
<span class="cm">%   (1) rho_SA_SA, second-order derivative with respect to Absolute</span>
<span class="cm">%       Salinity at constant CT &amp; p.</span>
<span class="cm">%   (2) rho_SA_CT, second-order derivative with respect to SA &amp; CT at</span>
<span class="cm">%       constant p.</span>
<span class="cm">%   (3) rho_CT_CT, second-order derivative with respect to CT at</span>
<span class="cm">%       constant SA &amp; p.</span>
<span class="cm">%   (4) rho_SA_P, second-order derivative with respect to SA &amp; P at</span>
<span class="cm">%       constant CT.</span>
<span class="cm">%   (5) rho_CT_P, second-order derivative with respect to CT &amp; P at</span>
<span class="cm">%       constant SA.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the using the computationally-efficient</span>
<span class="cm">%  expression for specific volume (Roquet et al., 2015).  There is an</span>
<span class="cm">%  alternative to calling this function, namely</span>
<span class="cm">%  gsw_rho_second_derivatives_CT_exact(SA,CT,p) which uses the full Gibbs</span>
<span class="cm">%  function (IOC et al., 2010).</span>
<span class="cm">%</span>
<span class="cm">%  This 75-term equation has been fitted in a restricted range of parameter</span>
<span class="cm">%  space, and is most accurate inside the &quot;oceanographic funnel&quot; described</span>
<span class="cm">%  in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  rho_SA_SA = The second-order derivative of rho with respect to</span>
<span class="cm">%              Absolute Salinity at constant CT &amp; p.  [ (kg/m^3)(g/kg)^-2 ]</span>
<span class="cm">%  rho_SA_CT = The second-order derivative of rho with respect to</span>
<span class="cm">%              SA and CT at constant p.          [ (kg/m^3)(g/kg)^-1 K^-1 ]</span>
<span class="cm">%  rho_CT_CT = The second-order derivative of rho with respect to CT at</span>
<span class="cm">%              constant SA &amp; p                            [ (kg/m^3) K^-2 ]</span>
<span class="cm">%  rho_SA_P  = The second-order derivative with respect to SA &amp; P at</span>
<span class="cm">%              constant CT.                     [ (kg/m^3)(g/kg)^-1 Pa^-1 ]</span>
<span class="cm">%  rho_CT_P  = The second-order derivative with respect to CT &amp; P at</span>
<span class="cm">%              constant SA.                         [ (kg/m^3) K^-1 Pa^-1 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_rho_second_derivatives</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">rho_sa_sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">rho_sa_ct</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">rho_ct_ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">rho_sa_p</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">rho_ct_p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">rec_v</span><span class="p">,</span><span class="w"> </span><span class="n">rec_v2</span><span class="p">,</span><span class="w"> </span><span class="n">rec_v3</span><span class="p">,</span><span class="w"> </span><span class="n">v_ct</span><span class="p">,</span><span class="w"> </span><span class="n">v_ct_ct</span><span class="p">,</span><span class="w"> </span><span class="n">v_ct_p</span><span class="p">,</span><span class="w"> </span><span class="n">v_p</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa</span><span class="p">,</span>
<span class="w">             </span><span class="n">v_sa_ct</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_p</span><span class="p">,</span><span class="w"> </span><span class="n">v_sa_sa</span><span class="p">;</span>

<span class="w">    </span><span class="n">gsw_specvol_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_sa</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_ct</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_p</span><span class="p">);</span>
<span class="w">    </span><span class="n">gsw_specvol_second_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_sa_sa</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_sa_ct</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_ct_ct</span><span class="p">,</span>
<span class="w">                                             </span><span class="o">&amp;</span><span class="n">v_sa_p</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v_ct_p</span><span class="p">);</span>

<span class="w">    </span><span class="n">rec_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">gsw_specvol</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">rec_v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">rec_v</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">rec_v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rec_v2</span><span class="o">*</span><span class="n">rec_v</span><span class="p">;</span>

<span class="w">    </span><span class="o">*</span><span class="n">rho_sa_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_sa_sa</span><span class="o">*</span><span class="n">rec_v2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">v_sa</span><span class="o">*</span><span class="n">v_sa</span><span class="o">*</span><span class="n">rec_v3</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="n">rho_sa_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_sa_ct</span><span class="o">*</span><span class="n">rec_v2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">v_sa</span><span class="o">*</span><span class="n">v_ct</span><span class="o">*</span><span class="n">rec_v3</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="n">rho_ct_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_ct_ct</span><span class="o">*</span><span class="n">rec_v2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">v_ct</span><span class="o">*</span><span class="n">v_ct</span><span class="o">*</span><span class="n">rec_v3</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="n">rho_sa_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_sa_p</span><span class="o">*</span><span class="n">rec_v2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">v_sa</span><span class="o">*</span><span class="n">v_p</span><span class="o">*</span><span class="n">rec_v3</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="n">rho_ct_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_ct_p</span><span class="o">*</span><span class="n">rec_v2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">v_ct</span><span class="o">*</span><span class="n">v_p</span><span class="o">*</span><span class="n">rec_v3</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_pt_first_derivatives       first derivatives of potential temperature</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  [pt_SA, pt_CT] = gsw_pt_first_derivatives(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following two partial derivatives of potential</span>
<span class="cm">%  temperature (the regular potential temperature whose reference sea</span>
<span class="cm">%  pressure is 0 dbar)</span>
<span class="cm">%  (1) pt_SA, the derivative with respect to Absolute Salinity at</span>
<span class="cm">%       constant Conservative Temperature, and</span>
<span class="cm">%  (2) pt_CT, the derivative with respect to Conservative Temperature at</span>
<span class="cm">%       constant Absolute Salinity.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  pt_SA =  The derivative of potential temperature with respect to</span>
<span class="cm">%           Absolute Salinity at constant Conservative Temperature.</span>
<span class="cm">%                                                               [ K/(g/kg)]</span>
<span class="cm">%  pt_CT =  The derivative of potential temperature with respect to</span>
<span class="cm">%           Conservative Temperature at constant Absolute Salinity.</span>
<span class="cm">%           pt_CT is dimensionless.                            [ unitless ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%    See Eqns. (A.12.6), (A.12.3), (P.6) and (P.8) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_pt_first_derivatives</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">pt_sa</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">pt_ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">abs_pt</span><span class="p">,</span><span class="w"> </span><span class="n">ct_pt</span><span class="p">,</span><span class="w"> </span><span class="n">ct_sa</span><span class="p">,</span><span class="w"> </span><span class="n">pt</span><span class="p">,</span><span class="w"> </span><span class="n">pr0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>

<span class="w">    </span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_pt_from_ct</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">);</span>
<span class="w">    </span><span class="n">abs_pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_t0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pt</span><span class="p">);</span>
<span class="w">    </span><span class="n">ct_pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">abs_pt</span><span class="o">*</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">pt</span><span class="p">,</span><span class="n">pr0</span><span class="p">))</span><span class="o">/</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_cp0</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pt_sa</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ct_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">pt</span><span class="p">,</span><span class="n">pr0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span>
<span class="w">                    </span><span class="n">abs_pt</span><span class="o">*</span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">pt</span><span class="p">,</span><span class="n">pr0</span><span class="p">))</span><span class="o">/</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_cp0</span><span class="p">;</span>

<span class="w">        </span><span class="o">*</span><span class="n">pt_sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ct_sa</span><span class="o">/</span><span class="n">ct_pt</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pt_ct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="o">*</span><span class="n">pt_ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="o">/</span><span class="n">ct_pt</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sigma2_ct_exact                        potential density anomaly with</span>
<span class="cm">%                                       reference sea pressure of 2000 dbar</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_sigma2_ct_exact(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density anomaly with reference pressure of 2000</span>
<span class="cm">%  dbar, this being this particular potential density minus 1000 kg/m^3.</span>
<span class="cm">%  This function has inputs of Absolute Salinity and Conservative</span>
<span class="cm">%  Temperature.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely gsw_sigma2(SA,CT,p),</span>
<span class="cm">%  which uses the computationally efficient 75-term expression for specific</span>
<span class="cm">%  volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sigma2_CT_exact  =  potential density anomaly with            [ kg/m^3 ]</span>
<span class="cm">%                      respect to a reference pressure of 2000 dbar,</span>
<span class="cm">%                      that is, this potential density - 1000 kg/m^3.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall &amp; Paul Barker                      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (A.30.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sigma2_ct_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_t_from_ct</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="mf">2000.0</span><span class="p">);</span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="mf">2000.0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**************************************************************************</span>
<span class="cm">% gsw_sigma4_ct_exact                        potential density anomaly with</span>
<span class="cm">%                                       reference sea pressure of 4000 dbar</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_sigma4_ct_exact(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density anomaly with reference pressure of 4000</span>
<span class="cm">%  dbar, this being this particular potential density minus 1000 kg/m^3.</span>
<span class="cm">%  This function has inputs of Absolute Salinity and Conservative</span>
<span class="cm">%  Temperature.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely gsw_sigma4(SA,CT,p),</span>
<span class="cm">%  which uses the computationally efficient 75-term expression for specific</span>
<span class="cm">%  volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sigma4_CT_exact  =  potential density anomaly with            [ kg/m^3 ]</span>
<span class="cm">%                      respect to a reference pressure of 4000 dbar,</span>
<span class="cm">%                      that is, this potential density - 1000 kg/m^3.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall &amp; Paul Barker                      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (A.30.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">*/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sigma4_ct_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_t_from_ct</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="mf">4000.0</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="mf">4000.0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sigma1_CT_exact                        potential density anomaly with</span>
<span class="cm">%                                       reference sea pressure of 1000 dbar</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_sigma1_CT_exact(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density anomaly with reference pressure of 1000</span>
<span class="cm">%  dbar, this being this particular potential density minus 1000 kg/m^3.</span>
<span class="cm">%  This function has inputs of Absolute Salinity and Conservative</span>
<span class="cm">%  Temperature.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  There is an</span>
<span class="cm">%  alternative to calling this function, namely gsw_sigma1(SA,CT,p),</span>
<span class="cm">%  which uses the computationally efficient 75-term expression for specific</span>
<span class="cm">%  volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sigma1_CT_exact  =  potential density anomaly with            [ kg/m^3 ]</span>
<span class="cm">%                      respect to a reference pressure of 1000 dbar,</span>
<span class="cm">%                      that is, this potential density - 1000 kg/m^3.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall &amp; Paul Barker                      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (A.30.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sigma1_ct_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_t_from_ct</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">);</span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_t_from_rho_exact                     in-situ temperature from density</span>
<span class="cm">% =========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_t_from_rho_exact(rho,SA,p, *t, *t_multiple)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the in-situ temperature of a seawater sample, for given</span>
<span class="cm">%  values of its density, Absolute Salinity and sea pressure (in dbar).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  rho  =  density of a seawater sample (e.g. 1026 kg/m^3)       [ kg/m^3 ]</span>
<span class="cm">%   Note. This input has not had 1000 kg m^-3 subtracted from it.</span>
<span class="cm">%     That is, it is |density|, not |density anomaly|.</span>
<span class="cm">%  SA   =  Absolute Salinity                                       [ g/kg ]</span>
<span class="cm">%  p    =  sea pressure                                            [ dbar ]</span>
<span class="cm">%          ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  t  =  in-situ temperature  (ITS-90)                            [ deg C ]</span>
<span class="cm">%  t_multiple  =  in-situ temperature  (ITS-90)                   [ deg C ]</span>
<span class="cm">%    Note that at low salinities, in brackish water, there are two possible</span>
<span class="cm">%      temperatures for a single density.  This programme will output both</span>
<span class="cm">%      valid solutions.  To see this second solution the user must call the</span>
<span class="cm">%      programme with two outputs (i.e. [t,t_multiple]), if there is only</span>
<span class="cm">%      one possible solution and the programme has been called with two</span>
<span class="cm">%      outputs the second variable will be set to NaN.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall &amp; Paul Barker                      [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., and S.J. Wotherspoon, 2014: A simple modification of</span>
<span class="cm">%   Newton|s method to achieve convergence of order 1 + sqrt(2).  Applied</span>
<span class="cm">%   Mathematics Letters, 29, 20-25.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_t_from_rho_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">rho</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">t</span><span class="p">,</span>
<span class="w">                                                    </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">t_multiple</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">rho_40</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">SA</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">42.0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">       </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NAN</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">else</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SA</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">-1.5</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">12000.0</span><span class="p">)</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NAN</span><span class="p">;</span>

<span class="w">    </span><span class="n">rho_40</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="mf">40.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rho</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rho_40</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">rho_40</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NAN</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sa</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NAN</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NAN</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">rho_40</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NAN</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_multiple</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NAN</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t_max_rho</span><span class="p">,</span><span class="w"> </span><span class="n">max_rho</span><span class="p">,</span><span class="w"> </span><span class="n">v_t_t</span><span class="p">,</span><span class="w"> </span><span class="n">rho_t_t</span><span class="p">,</span><span class="w"> </span><span class="n">deriv_lin</span><span class="p">,</span><span class="w"> </span><span class="n">discrim</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">v_t</span><span class="p">,</span><span class="w"> </span><span class="n">rho_t</span><span class="p">,</span><span class="w"> </span><span class="n">t_old</span><span class="p">,</span><span class="w"> </span><span class="n">t_upper</span><span class="p">,</span><span class="w"> </span><span class="n">t_freezing</span><span class="p">;</span>

<span class="w">    </span><span class="n">t_max_rho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_t_maxdensity_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">max_rho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">t_max_rho</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">v_t_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">t_max_rho</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">rho_t_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_t_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho</span><span class="p">;</span><span class="w">   </span><span class="c1">//This is approximate</span>

<span class="w">    </span><span class="n">deriv_lin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho_40</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">max_rho</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">40.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t_max_rho</span><span class="p">;</span>
<span class="w">    </span><span class="n">discrim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">deriv_lin</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">deriv_lin</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho_t_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">max_rho</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rho</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">discrim</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">discrim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>

<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_max_rho</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">max_rho</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="o">-</span><span class="n">deriv_lin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">discrim</span><span class="p">));</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">iter</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">        </span><span class="n">rho_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho</span><span class="p">;</span><span class="w">        </span><span class="c1">// This is approximate</span>

<span class="w">        </span><span class="n">v_t_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">        </span><span class="n">rho_t_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_t_t</span><span class="w"> </span><span class="o">*</span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="n">rho</span><span class="p">;</span><span class="w">      </span><span class="c1">//This is approximate</span>

<span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho_t</span><span class="p">;</span>
<span class="w">        </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="n">rho_t_t</span><span class="p">;</span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rho</span><span class="p">;</span>
<span class="w">        </span><span class="n">discrim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">discrim</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">discrim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">        </span><span class="n">t_old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="w">        </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_old</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">discrim</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">t_upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>

<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t_max_rho</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t_upper</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">iter</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">v_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">        </span><span class="n">rho_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho</span><span class="p">;</span><span class="w">           </span><span class="c1">//This is approximate</span>

<span class="w">        </span><span class="n">v_t_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">        </span><span class="n">rho_t_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">v_t_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho</span><span class="p">;</span><span class="w">       </span><span class="c1">//This is approximate</span>

<span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho_t</span><span class="p">;</span>
<span class="w">        </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho_t_t</span><span class="p">;</span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_rho_t_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rho</span><span class="p">;</span>
<span class="w">        </span><span class="n">discrim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">discrim</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">discrim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">        </span><span class="n">t_old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="w">        </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_old</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">discrim</span><span class="p">));</span><span class="w"> </span><span class="c1">//Note the sign change of the sqrt term</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">t_multiple</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>

<span class="w">    </span><span class="n">t_freezing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_t_freezing</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t_upper</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">t_freezing</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">t_upper</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">t_max_rho</span><span class="p">)</span><span class="w"> </span><span class="n">t_upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NAN</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t_multiple</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">t_max_rho</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">t_multiple</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">t_max_rho</span><span class="p">)</span><span class="w"> </span><span class="n">t_multiple</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NAN</span><span class="p">;</span>

<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_upper</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_enthalpy_first_derivatives_wrt_t_exact           first derivatives of</span>
<span class="cm">%                                                                  enthalpy</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_enthalpy_first_derivatives_wrt_t_exact(SA,t,p,</span>
<span class="cm">                                                      &amp;h_SA_wrt_t,</span>
<span class="cm">                                                      &amp;h_T_wrt_t,</span>
<span class="cm">                                                      &amp;h_P_wrt_t)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the following three derivatives of specific enthalpy, h.</span>
<span class="cm">%  These derivatives are done with respect to in-situ temperature t (in the</span>
<span class="cm">%  case of h_T_wrt_t) or at constant in-situ tempertature (in the cases of</span>
<span class="cm">%  h_SA_wrt_t and h_P_wrt_t).</span>
<span class="cm">%   (1) h_SA_wrt_t, the derivative with respect to Absolute Salinity at</span>
<span class="cm">%       constant t and p.</span>
<span class="cm">%   (2) h_T_wrt_t, derivative with respect to in-situ temperature t at</span>
<span class="cm">%       constant SA and p.</span>
<span class="cm">%   (3) h_P_wrt_t, derivative with respect to pressure P (in Pa) at constant</span>
<span class="cm">%       SA and t.  This output has the same dimensions as specific volume,</span>
<span class="cm">%       but is not equal to specific volume.</span>
<span class="cm">%</span>
<span class="cm">%  Note that this function uses the full Gibbs function.  This function</span>
<span class="cm">%  avoids the Nan that would exist in h_sub_SA at SA=0 if it were</span>
<span class="cm">%  evaluated in the straightforward way from the gibbs function (as in the</span>
<span class="cm">%  commented line 111 of the code below).</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  t   =  in-situ temperature (ITS-90)                            [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  h_SA_wrt_t =  The first derivative of specific enthalpy with respect to</span>
<span class="cm">%                Absolute Salinity at constant t and p.</span>
<span class="cm">%                                            [ J/(kg (g/kg))]  i.e. [ J/g ]</span>
<span class="cm">%  h_T_wrt_t  =  The first derivative of specific enthalpy with respect to</span>
<span class="cm">%                in-situ temperature, t, at constant SA and p. [ J/(kg K) ]</span>
<span class="cm">%</span>
<span class="cm">%  h_P_wrt_t  =  The first derivative of specific enthalpy with respect to</span>
<span class="cm">%                pressure P (in Pa) at constant SA and t.        [ m^3/kg ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org.</span>
<span class="cm">%</span>
<span class="cm">%  This software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_enthalpy_first_derivatives_wrt_t_exact</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span>
<span class="w">                                                         </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span>
<span class="w">                                                         </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">h_SA_wrt_t</span><span class="p">,</span>
<span class="w">                                                         </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">h_T_wrt_t</span><span class="p">,</span>
<span class="w">                                                         </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">h_P_wrt_t</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">gibbs_SA_T</span><span class="p">,</span><span class="w"> </span><span class="n">g08_SA_T</span><span class="p">,</span><span class="w"> </span><span class="n">gibbs_SA</span><span class="p">,</span><span class="w"> </span><span class="n">g08_SA</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SA</span><span class="p">;</span>

<span class="w">   </span><span class="n">h_T_wrt_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_cp_t_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">   </span><span class="n">h_P_wrt_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_specvol_t_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_t0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gsw_gibbs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>

<span class="w">   </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sa</span><span class="p">;</span>
<span class="w">   </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="w">   </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">   </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">rec_db2pa</span><span class="p">;</span><span class="w"> </span><span class="c1">//1e-4; Note.The input pressure (p) is sea pressure in units of dbar.</span>

<span class="w">   </span><span class="n">g08_SA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8645.36753595126</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-6620.98308089678</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">769.588305957198</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-193.0648640214916</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">31.6816345533648</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">5.24960313181984</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-7296.43987145382</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">8103.20462414788</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">2175.341332000392</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-274.2290036817964</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">197.4670779425016</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-68.5590309679152</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">9.98788038278032</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">)))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">90.6734234051316</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-5458.34205214835</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">980.14153344888</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">2247.60742726704</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">340.1237483177863</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">220.542973797483</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">180.142097805543</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-219.1676534131548</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">-16.32775915649044</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">120.7020447884644</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">598.378809221703</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-156.8822727844005</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">204.1334828179377</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">10.23755797323846</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-1480.222530425046</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-525.876123559641</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">249.57717834054571</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">88.449193048287</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-129.1994027934126</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">1149.174198007428</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-162.5751787551336</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">76.9195462169742</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-30.0682112585625</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1380.9597954037708</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">2.626801985426835</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">703.695562834065</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)))))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">1187.3715515697959</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">1458.233059470092</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-687.913805923122</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">249.375342232496</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-63.313928772146</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">14.09317606630898</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">))))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">1760.062705994408</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-450.535298526802</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">182.8520895502518</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-43.3206481750622</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.26033941694366</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-595.457483974374</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">149.452282277512</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">72.9745838003176</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">1388.489628266536</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-409.779283929806</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">227.123395681188</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">22.2565468652826</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-1721.528607567954</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">674.819060538734</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-356.629112415276</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">88.4080716616</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">15.84003094423364</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)))));</span>

<span class="w">   </span><span class="n">gibbs_SA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">g08_SA</span><span class="p">;</span>

<span class="w">   </span><span class="n">g08_SA_T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1187.3715515697959</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">1458.233059470092</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-687.913805923122</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">249.375342232496</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-63.313928772146</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">14.09317606630898</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">))))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-1480.222530425046</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">2175.341332000392</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-980.14153344888</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">220.542973797483</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-548.4580073635929</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">592.4012338275047</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-274.2361238716608</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">49.9394019139016</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">)))</span><span class="w"> </span><span class="o">-</span>
<span class="w">        </span><span class="mf">90.6734234051316</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-525.876123559641</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">249.57717834054571</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">88.449193048287</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-258.3988055868252</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">2298.348396014856</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-325.1503575102672</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">153.8390924339484</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-90.2046337756875</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4142.8793862113125</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">10.50720794170734</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2814.78225133626</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">))))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">3520.125411988816</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-1351.605895580406</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">731.4083582010072</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-216.60324087531103</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">25.56203650166196</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-2381.829935897496</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">597.809129110048</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">291.8983352012704</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">4165.4688847996085</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-1229.337851789418</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">681.370187043564</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">66.7696405958478</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-3443.057215135908</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">1349.638121077468</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="mf">-713.258224830552</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">176.8161433232</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">31.68006188846728</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">))));</span>

<span class="w">   </span><span class="n">gibbs_SA_T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_sfac</span><span class="w"> </span><span class="o">*</span><span class="mf">0.025</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">g08_SA_T</span><span class="p">;</span>

<span class="w">   </span><span class="n">h_SA_wrt_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gibbs_SA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_t0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gibbs_SA_T</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_internal_energy_first_derivatives       first derivatives of specific</span>
<span class="cm">%                             interal energy of seawater (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE: gsw_internal_energy_first_derivatives(SA,CT,p,&amp;u_SA,</span>
<span class="cm">                                                &amp;u_CT, &amp;u_P)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates the first order derivates of specific internal energy of</span>
<span class="cm">%  seawater using the computationally-efficient expression for specific</span>
<span class="cm">%  volume in terms of SA, CT and p (Roquet et al., 2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that the 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one|s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature                                [ deg C ]</span>
<span class="cm">%  p   =  sea pressure                                             [ dbar ]</span>
<span class="cm">%         ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  u_SA = The first derivative of internal energy with respect to</span>
<span class="cm">%           Absolute Salinity at constant CT &amp; p.</span>
<span class="cm">%                                          [ (J/kg)(g/kg)^-1 ] i.e. [ J/g ]</span>
<span class="cm">%  u_CT = The first derivative of internal energy with respect to</span>
<span class="cm">%           Conservative Temperature at constant SA &amp; p.    [ (J/kg) K^-1 ]</span>
<span class="cm">%  u_P = The first derivative of internal energy with respect to</span>
<span class="cm">%           pressure at constant SA &amp; CT.                  [ (J/kg) Pa^-1 ]</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Trevor McDougall and Paul Barker.                   [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_internal_energy_first_derivatives</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">SA</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span>
<span class="w">                                                      </span><span class="kt">double</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_SA</span><span class="p">,</span>
<span class="w">                                                      </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_CT</span><span class="p">,</span>
<span class="w">                                                      </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_P</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">h_SA</span><span class="p">,</span><span class="w"> </span><span class="n">h_CT</span><span class="p">,</span><span class="w"> </span><span class="n">v_SA</span><span class="p">,</span><span class="w"> </span><span class="n">v_CT</span><span class="p">,</span><span class="w"> </span><span class="n">v_P</span><span class="p">,</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SA</span><span class="p">;</span>

<span class="w">    </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gtc</span><span class="p">.</span><span class="n">db2pa</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gtc</span><span class="p">.</span><span class="n">gsw_p0</span><span class="p">);</span>

<span class="w">    </span><span class="n">gsw_enthalpy_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">h_SA</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">h_CT</span><span class="p">);</span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsw_specvol</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">gsw_specvol_first_derivatives</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">CT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v_SA</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v_CT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v_P</span><span class="p">);</span>

<span class="w">    </span><span class="n">u_SA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h_SA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_SA</span><span class="p">);</span>

<span class="w">    </span><span class="n">u_CT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h_CT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_CT</span><span class="p">);</span>

<span class="w">    </span><span class="n">u_P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_P</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sigma1                       potential density anomaly with reference</span>
<span class="cm">%                              sea pressure of 1000 dbar (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_sigma1(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density anomaly with reference pressure of 1000</span>
<span class="cm">%  dbar, this being this particular potential density minus 1000 kg/m^3.</span>
<span class="cm">%  This function has inputs of Absolute Salinity and Conservative</span>
<span class="cm">%  Temperature.  This function uses the computationally-efficient</span>
<span class="cm">%  expression for specific volume in terms of SA, CT and p (Roquet et al.,</span>
<span class="cm">%  2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sigma1  =  potential density anomaly with                     [ kg/m^3 ]</span>
<span class="cm">%             respect to a reference pressure of 1000 dbar,</span>
<span class="cm">%             that is, this potential density - 1000 kg/m^3.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (A.30.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sigma1</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_rho</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="mf">1000.0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sigma2                       potential density anomaly with reference</span>
<span class="cm">%                              sea pressure of 2000 dbar (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_sigma2(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density anomaly with reference pressure of 2000</span>
<span class="cm">%  dbar, this being this particular potential density minus 1000 kg/m^3.</span>
<span class="cm">%  Temperature.  This function uses the computationally-efficient</span>
<span class="cm">%  expression for specific volume in terms of SA, CT and p (Roquet et al.,</span>
<span class="cm">%  2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sigma2  =  potential density anomaly with                     [ kg/m^3 ]</span>
<span class="cm">%             respect to a reference pressure of 2000 dbar,</span>
<span class="cm">%             that is, this potential density - 1000 kg/m^3.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (A.30.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sigma2</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_rho</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="mf">2000.0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sigma3                       potential density anomaly with reference</span>
<span class="cm">%                              sea pressure of 3000 dbar (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_sigma3(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density anomaly with reference pressure of 3000</span>
<span class="cm">%  dbar, this being this particular potential density minus 1000 kg/m^3.</span>
<span class="cm">%  Temperature.  This function uses the computationally-efficient</span>
<span class="cm">%  expression for specific volume in terms of SA, CT and p (Roquet et al.,</span>
<span class="cm">%  2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sigma3  =  potential density anomaly with                     [ kg/m^3 ]</span>
<span class="cm">%             respect to a reference pressure of 3000 dbar,</span>
<span class="cm">%             that is, this potential density - 1000 kg/m^3.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (A.30.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sigma3</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_rho</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="mf">3000.0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_sigma4                       potential density anomaly with reference</span>
<span class="cm">%                              sea pressure of 4000 dbar (75-term equation)</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_sigma4(SA,CT)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Calculates potential density anomaly with reference pressure of 4000</span>
<span class="cm">%  dbar, this being this particular potential density minus 1000 kg/m^3.</span>
<span class="cm">%  Temperature.  This function uses the computationally-efficient</span>
<span class="cm">%  expression for specific volume in terms of SA, CT and p (Roquet et al.,</span>
<span class="cm">%  2015).</span>
<span class="cm">%</span>
<span class="cm">%  Note that this 75-term equation has been fitted in a restricted range of</span>
<span class="cm">%  parameter space, and is most accurate inside the &quot;oceanographic funnel&quot;</span>
<span class="cm">%  described in McDougall et al. (2003).  The GSW library function</span>
<span class="cm">%  &quot;gsw_infunnel(SA,CT,p)&quot; is avaialble to be used if one wants to test if</span>
<span class="cm">%  some of one&#39;s data lies outside this &quot;funnel&quot;.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA  =  Absolute Salinity                                        [ g/kg ]</span>
<span class="cm">%  CT  =  Conservative Temperature (ITS-90)                       [ deg C ]</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  sigma4  =  potential density anomaly with                     [ kg/m^3 ]</span>
<span class="cm">%             respect to a reference pressure of 4000 dbar,</span>
<span class="cm">%             that is, this potential density - 1000 kg/m^3.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall                    [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% REFERENCES:</span>
<span class="cm">%  IOC, SCOR and IAPSO, 2010: The international thermodynamic equation of</span>
<span class="cm">%   seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="cm">%   Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="cm">%   UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="cm">%    See Eqn. (A.30.1) of this TEOS-10 Manual.</span>
<span class="cm">%</span>
<span class="cm">%  McDougall, T.J., D.R. Jackett, D.G. Wright and R. Feistel, 2003:</span>
<span class="cm">%   Accurate and computationally efficient algorithms for potential</span>
<span class="cm">%   temperature and density of seawater.  J. Atmosph. Ocean. Tech., 20,</span>
<span class="cm">%   pp. 730-741.</span>
<span class="cm">%</span>
<span class="cm">%  Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="cm">%   polynomial expressions for the density and specifc volume of seawater</span>
<span class="cm">%   using the TEOS-10 standard. Ocean Modelling., 90, pp. 29-43.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">double</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_sigma4</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsw_rho</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="mf">4000.0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">% gsw_rr68_interp_SA_CT              Reiniger and Ross (1968) interpolation</span>
<span class="cm">%                                                          to p_i on a cast</span>
<span class="cm">%==========================================================================</span>
<span class="cm">%</span>
<span class="cm">% USAGE:</span>
<span class="cm">%  gsw_rr68_interp_SA_CT(SA,CT,p,p_i)</span>
<span class="cm">%</span>
<span class="cm">% DESCRIPTION:</span>
<span class="cm">%  Interpolate Absolute Salinity and Conservative Temperature values to</span>
<span class="cm">%  arbitrary pressures using the Reiniger and Ross (1968) interpolation</span>
<span class="cm">%  scheme.</span>
<span class="cm">%  Note that this interpolation scheme requires at least four observed</span>
<span class="cm">%  bottles on the cast.</span>
<span class="cm">%  Any interpolated bottles that have pressures shallower than the</span>
<span class="cm">%  shallowest observed bottle are set equal to the shallowest observed</span>
<span class="cm">%  bottle.</span>
<span class="cm">%</span>
<span class="cm">% INPUT:</span>
<span class="cm">%  SA   =  Absolute Salinity                                  [ g/kg ]</span>
<span class="cm">%  CT   =  Conservative Temperature (ITS-90)                 [ deg C ]</span>
<span class="cm">%  p    =  sea pressure                                       [ dbar ]</span>
<span class="cm">%           ( i.e. absolute pressure - 10.1325 dbar )</span>
<span class="cm">%  p_i  =  pressures to interpolate to.</span>
<span class="cm">%</span>
<span class="cm">% OUTPUT:</span>
<span class="cm">%  SA_i = interpolated SA values at pressures p_i.</span>
<span class="cm">%  CT_i = interpolated CT values at pressures p_i.</span>
<span class="cm">%</span>
<span class="cm">% AUTHOR:</span>
<span class="cm">%  Paul Barker and Trevor McDougall             [ help@teos-10.org ]</span>
<span class="cm">%</span>
<span class="cm">% VERSION NUMBER: 3.06.12 (25th May, 2020)</span>
<span class="cm">%</span>
<span class="cm">% References</span>
<span class="cm">%  Reiniger, R.F. and C.K. Ross, 1968: A method of interpolation with</span>
<span class="cm">%   application to oceanographic data. Deep-Sea Res., 15, 185-193.</span>
<span class="cm">%</span>
<span class="cm">%  The software is available from http://www.TEOS-10.org</span>
<span class="cm">%</span>
<span class="cm">%==========================================================================</span>
<span class="cm">***************************************************************************/</span>
<span class="kt">void</span><span class="w"> </span><span class="n">TeosSea</span><span class="o">::</span><span class="n">gsw_rr68_interp_sa_ct</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">sa</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ct</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span>
<span class="w">                                       </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">p_i</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">mp_i</span><span class="p">,</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">sa_i</span><span class="p">,</span>
<span class="w">                                       </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ct_i</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">nshallow</span><span class="p">,</span><span class="w"> </span><span class="n">ncentral</span><span class="p">,</span><span class="w"> </span><span class="n">ndeep</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ip</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ip_i</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span>
<span class="w">         </span><span class="o">*</span><span class="n">ip_ishallow</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ip_icentral</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ip_ideep</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">shallow</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">central</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">deep</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ip_shallow</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ip_central</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ip_deep</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">dp</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">p_ii</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ct_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cppGSW_INVALID_VALUE</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">dp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">mp</span><span class="p">];</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">mp</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]))</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">dp</span><span class="p">;</span>
<span class="w">            </span><span class="n">ct_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cppGSW_INVALID_VALUE</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">shallow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">mp_i</span><span class="p">];</span>
<span class="w">    </span><span class="n">central</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shallow</span><span class="o">+</span><span class="n">mp_i</span><span class="p">;</span>
<span class="w">    </span><span class="n">deep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">central</span><span class="o">+</span><span class="n">mp_i</span><span class="p">;</span>
<span class="w">    </span><span class="n">nshallow</span><span class="o">=</span><span class="n">ncentral</span><span class="o">=</span><span class="n">ndeep</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">shallow</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">mp_i</span><span class="o">*</span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">mp_i</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">nshallow</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="n">shallow</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">mp</span><span class="mi">-2</span><span class="p">])</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ncentral</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="n">central</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">mp</span><span class="mi">-2</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">mp</span><span class="mi">-1</span><span class="p">])</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ndeep</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="n">deep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">nshallow</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">ncentral</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">ndeep</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shallow</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">shallow</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">dp</span><span class="p">;</span>
<span class="w">        </span><span class="n">ct_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cppGSW_INVALID_VALUE</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">mp</span><span class="o">+</span><span class="n">mp_i</span><span class="p">];</span>
<span class="w">    </span><span class="n">ip_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ip</span><span class="o">+</span><span class="n">mp</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">mp</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ip</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">mp_i</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ip_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="n">ip_ishallow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">nshallow</span><span class="o">+</span><span class="n">ncentral</span><span class="o">+</span><span class="n">ndeep</span><span class="p">];</span>
<span class="w">    </span><span class="n">ip_icentral</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ip_ishallow</span><span class="o">+</span><span class="n">nshallow</span><span class="p">;</span>
<span class="w">    </span><span class="n">ip_ideep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ip_icentral</span><span class="o">+</span><span class="n">ncentral</span><span class="p">;</span>
<span class="w">    </span><span class="n">ip_shallow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">nshallow</span><span class="o">+</span><span class="n">ncentral</span><span class="o">+</span><span class="n">ndeep</span><span class="p">)];</span>
<span class="w">    </span><span class="n">ip_central</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ip_shallow</span><span class="o">+</span><span class="n">nshallow</span><span class="p">;</span>
<span class="w">    </span><span class="n">ip_deep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ip_central</span><span class="o">+</span><span class="n">ncentral</span><span class="p">;</span>
<span class="w">    </span><span class="n">p_ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ip_deep</span><span class="o">+</span><span class="n">ndeep</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">mp_i</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">central</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ip_icentral</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ip_i</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">            </span><span class="n">j</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">ncentral</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">p_ii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_i</span><span class="p">[</span><span class="n">ip_icentral</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="n">gsw_util_interp1q_int</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">ncentral</span><span class="p">,</span><span class="n">p_ii</span><span class="p">,</span><span class="n">ip_central</span><span class="p">);</span>
<span class="w">    </span><span class="n">gsw_rr68_interp_section</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">mp</span><span class="p">,</span><span class="n">ncentral</span><span class="p">,</span><span class="n">ip_central</span><span class="p">,</span><span class="n">ip_icentral</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">p_i</span><span class="p">,</span><span class="n">sa_i</span><span class="p">,</span><span class="n">ct_i</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">mp_i</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shallow</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ip_ishallow</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ip_i</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">            </span><span class="n">j</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">nshallow</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">p_ii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_i</span><span class="p">[</span><span class="n">ip_ishallow</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="n">gsw_util_interp1q_int</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">nshallow</span><span class="p">,</span><span class="n">p_ii</span><span class="p">,</span><span class="n">ip_shallow</span><span class="p">);</span>
<span class="w">    </span><span class="n">gsw_rr68_interp_section</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">mp</span><span class="p">,</span><span class="n">nshallow</span><span class="p">,</span><span class="n">ip_shallow</span><span class="p">,</span><span class="n">ip_ishallow</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">p_i</span><span class="p">,</span><span class="n">sa_i</span><span class="p">,</span><span class="n">ct_i</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">mp_i</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">deep</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ip_ideep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ip_i</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">            </span><span class="n">j</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">ndeep</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">p_ii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_i</span><span class="p">[</span><span class="n">ip_ideep</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">    </span><span class="n">gsw_util_interp1q_int</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">ndeep</span><span class="p">,</span><span class="n">p_ii</span><span class="p">,</span><span class="n">ip_deep</span><span class="p">);</span>
<span class="w">    </span><span class="n">gsw_rr68_interp_section</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">mp</span><span class="p">,</span><span class="n">ndeep</span><span class="p">,</span><span class="n">ip_deep</span><span class="p">,</span><span class="n">ip_ideep</span><span class="p">,</span><span class="n">p_i</span><span class="p">,</span><span class="n">sa_i</span><span class="p">,</span><span class="n">ct_i</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">mp_i</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="n">mp</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">sa_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sa</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<span class="w">                </span><span class="n">ct_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ip_shallow</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">ip_shallow</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ip_ishallow</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">ip_ishallow</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ip</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">ip</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shallow</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">shallow</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Seabot2 Team, ENSTA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>